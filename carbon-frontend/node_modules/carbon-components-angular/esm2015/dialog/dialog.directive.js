/**
 *
 * carbon-angular v0.0.0 | dialog.directive.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Directive, Input, Output, EventEmitter, ElementRef, ViewContainerRef, HostBinding } from "@angular/core";
import { DialogService } from "./dialog.service";
import { CloseReasons } from "./dialog-config.interface";
import { EventService } from "carbon-components-angular/utils";
/**
 * A generic directive that can be inherited from to create dialogs (for example, a tooltip or popover)
 *
 * This class contains the relevant initialization code, specific templates, options, and additional inputs
 * should be specified in the derived class.
 *
 * NOTE: All child classes should add `DialogService` as a provider, otherwise they will lose context that
 * the service relies on.
 */
export class DialogDirective {
    /**
     * Creates an instance of DialogDirective.
     * @param elementRef
     * @param viewContainerRef
     * @param dialogService
     * @param eventService
     */
    constructor(elementRef, viewContainerRef, dialogService, eventService) {
        this.elementRef = elementRef;
        this.viewContainerRef = viewContainerRef;
        this.dialogService = dialogService;
        this.eventService = eventService;
        /**
         * Title for the dialog
         */
        this.title = "";
        /**
         * Defines how the Dialog is triggered.(Hover and click behave the same on mobile - both respond to a single tap).
         * Do not add focusable elements if trigger is `hover` or `mouseenter`.
         */
        this.trigger = "click";
        /**
         * Defines how the Dialog close event is triggered.
         *
         * [See here](https://developer.mozilla.org/en-US/docs/Web/API/Element/mouseleave_event)
         * for more on the difference between `mouseleave` and `mouseout`.
         *
         * Defaults to `click` when `trigger` is set to `click`.
         */
        this.closeTrigger = "mouseleave";
        /**
         * Placement of the dialog, usually relative to the element the directive is on.
         */
        this.placement = "left";
        /**
         * Spacing between the dialog and it's triggering element
         */
        this.gap = 0;
        /**
         * Set to `true` to open the dialog next to the triggering component
         */
        this.appendInline = false;
        /**
         * Optional data for templates
         */
        this.data = {};
        this.isOpen = false;
        /**
         * This prevents the dialog from being toggled
         */
        this.disabled = false;
        /**
         * Emits an event when the dialog is closed
         */
        this.onClose = new EventEmitter();
        /**
         * Emits an event when the dialog is opened
         */
        this.onOpen = new EventEmitter();
        /**
         * Emits an event when the state of `isOpen` changes. Allows `isOpen` to be double bound
         */
        this.isOpenChange = new EventEmitter();
        this.role = "button";
        this.hasPopup = true;
    }
    get ariaOwns() {
        return this.isOpen ? this.dialogConfig.compID : null;
    }
    ngOnChanges(changes) {
        // set the config object (this can [and should!] be added to in child classes depending on what they need)
        this.dialogConfig = {
            title: this.title,
            content: this.ibmDialog,
            placement: this.placement,
            parentRef: this.elementRef,
            gap: this.gap,
            trigger: this.trigger,
            closeTrigger: this.closeTrigger,
            shouldClose: this.shouldClose || (() => true),
            appendInline: this.appendInline,
            wrapperClass: this.wrapperClass,
            data: this.data,
            offset: this.offset,
            disabled: this.disabled
        };
        if (changes.isOpen) {
            if (changes.isOpen.currentValue) {
                this.open();
            }
            else {
                this.close({
                    reason: CloseReasons.programmatic
                });
            }
        }
        // Run any code a child class may need.
        this.onDialogChanges(changes);
        this.updateConfig();
    }
    /**
     * Sets the config object and binds events for hovering or clicking before
     * running code from child class.
     */
    ngOnInit() {
        // fix for safari hijacking clicks
        this.dialogService.singletonClickListen();
        const element = this.elementRef.nativeElement;
        this.eventService.on(element, "keydown", (event) => {
            // "Esc" is an IE specific value
            if (event.target === this.dialogConfig.parentRef.nativeElement &&
                (event.key === "Tab" || event.key === "Tab" && event.shiftKey) ||
                event.key === "Escape" || event.key === "Esc") {
                this.close({
                    reason: CloseReasons.interaction,
                    target: event.target
                });
            }
        });
        // bind events for hovering or clicking the host
        if (this.trigger === "hover" || this.trigger === "mouseenter") {
            this.eventService.on(element, "mouseenter", this.open.bind(this));
            this.eventService.on(element, this.closeTrigger, (event) => {
                this.close({
                    reason: CloseReasons.interaction,
                    target: event.target
                });
            });
            this.eventService.on(element, "focus", this.open.bind(this));
            this.eventService.on(element, "blur", (event) => {
                this.close({
                    reason: CloseReasons.interaction,
                    target: event.target
                });
            });
        }
        else {
            this.eventService.on(element, "click", (event) => {
                this.toggle({
                    reason: CloseReasons.interaction,
                    target: event.target
                });
            });
            this.eventService.on(element, "keydown", (event) => {
                // "Spacebar" is an IE specific value
                if (event.key === "Enter" || event.key === " " || event.key === "Spacebar") {
                    setTimeout(() => {
                        this.open();
                    });
                }
            });
        }
        DialogDirective.dialogCounter++;
        this.dialogConfig.compID = "dialog-" + DialogDirective.dialogCounter;
        // run any code a child class may need
        this.onDialogInit();
        this.updateConfig();
    }
    /**
     * When the host dies, kill the popover.
     * - Useful for use in a modal or similar.
     */
    ngOnDestroy() {
        this.close({
            reason: CloseReasons.destroyed
        });
    }
    /**
     * Helper method to call dialogService 'open'.
     * - Enforce accessibility by updating an aria attr for nativeElement.
     */
    open() {
        // don't allow dialogs to be opened if they're already open
        if (this.dialogRef || this.disabled) {
            return;
        }
        // actually open the dialog, emit events, and set the open state
        this.dialogRef = this.dialogService.open(this.viewContainerRef, this.dialogConfig);
        this.isOpen = true;
        this.onOpen.emit();
        this.isOpenChange.emit(true);
        // Handles emitting all the close events to clean everything up
        // Also enforce accessibility on close by updating an aria attr on the nativeElement.
        this.dialogRef.instance.close.subscribe((meta) => {
            if (!this.dialogRef) {
                return;
            }
            if (this.dialogConfig.shouldClose && this.dialogConfig.shouldClose(meta)) {
                // close the dialog, emit events, and clear out the open states
                this.dialogService.close(this.dialogRef);
                this.dialogRef = null;
                this.isOpen = false;
                this.onClose.emit();
                this.isOpenChange.emit(false);
            }
        });
        return this.dialogRef;
    }
    /**
     * Helper method to toggle the open state of the dialog
     */
    toggle(meta = { reason: CloseReasons.interaction }) {
        if (!this.isOpen) {
            this.open();
        }
        else {
            this.close(meta);
        }
    }
    /**
     * Helper method to close the dialogRef.
     */
    close(meta = { reason: CloseReasons.interaction }) {
        if (this.dialogRef) {
            setTimeout(() => {
                this.dialogRef.instance.doClose(meta);
            });
        }
    }
    /**
     * Empty method for child classes to override and specify additional init steps.
     * Run after DialogDirective completes it's ngOnInit.
     */
    onDialogInit() { }
    /**
     * Empty method for child to override and specify additional on changes steps.
     * run after DialogDirective completes it's ngOnChanges.
     */
    onDialogChanges(_changes) { }
    updateConfig() { }
}
DialogDirective.dialogCounter = 0;
DialogDirective.decorators = [
    { type: Directive, args: [{
                selector: "[ibmDialog]",
                exportAs: "ibmDialog",
                providers: [
                    DialogService
                ]
            },] }
];
/** @nocollapse */
DialogDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: ViewContainerRef },
    { type: DialogService },
    { type: EventService }
];
DialogDirective.propDecorators = {
    title: [{ type: Input }],
    ibmDialog: [{ type: Input }],
    trigger: [{ type: Input }],
    closeTrigger: [{ type: Input }],
    placement: [{ type: Input }],
    offset: [{ type: Input }],
    wrapperClass: [{ type: Input }],
    gap: [{ type: Input }],
    appendInline: [{ type: Input }],
    data: [{ type: Input }],
    isOpen: [{ type: Input }, { type: HostBinding, args: ["attr.aria-expanded",] }],
    disabled: [{ type: Input }],
    shouldClose: [{ type: Input }],
    onClose: [{ type: Output }],
    onOpen: [{ type: Output }],
    isOpenChange: [{ type: Output }],
    role: [{ type: HostBinding, args: ["attr.role",] }],
    hasPopup: [{ type: HostBinding, args: ["attr.aria-haspopup",] }],
    ariaOwns: [{ type: HostBinding, args: ["attr.aria-owns",] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvZGlhbG9nLyIsInNvdXJjZXMiOlsiZGlhbG9nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ04sU0FBUyxFQUNULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUdaLFVBQVUsRUFFVixnQkFBZ0IsRUFFaEIsV0FBVyxFQUdYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQWEsWUFBWSxFQUFnQixNQUFNLDJCQUEyQixDQUFDO0FBQ2xGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUcvRDs7Ozs7Ozs7R0FRRztBQVFILE1BQU0sT0FBTyxlQUFlO0lBc0YzQjs7Ozs7O09BTUc7SUFDSCxZQUNXLFVBQXNCLEVBQ3RCLGdCQUFrQyxFQUNsQyxhQUE0QixFQUM1QixZQUEwQjtRQUgxQixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsaUJBQVksR0FBWixZQUFZLENBQWM7UUEvRnJDOztXQUVHO1FBQ00sVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUtwQjs7O1dBR0c7UUFDTSxZQUFPLEdBQXFDLE9BQU8sQ0FBQztRQUM3RDs7Ozs7OztXQU9HO1FBQ00saUJBQVksR0FBOEIsWUFBWSxDQUFDO1FBQ2hFOztXQUVHO1FBQ00sY0FBUyxHQUFHLE1BQU0sQ0FBQztRQVM1Qjs7V0FFRztRQUNNLFFBQUcsR0FBRyxDQUFDLENBQUM7UUFDakI7O1dBRUc7UUFDTSxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUM5Qjs7V0FFRztRQUNNLFNBQUksR0FBRyxFQUFFLENBQUM7UUFFeUIsV0FBTSxHQUFHLEtBQUssQ0FB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Q0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUM7U0FDSDtJQUNGLENBQUM7SUFFRDs7O09BR0c7SUFDTyxZQUFZLEtBQUksQ0FBQztJQUUzQjs7O09BR0c7SUFDTyxlQUFlLENBQUMsUUFBdUIsSUFBRyxDQUFDO0lBRTNDLFlBQVksS0FBSSxDQUFDOztBQTlRcEIsNkJBQWEsR0FBRyxDQUFDLENBQUM7O1lBUnpCLFNBQVMsU0FBQztnQkFDVixRQUFRLEVBQUUsYUFBYTtnQkFDdkIsUUFBUSxFQUFFLFdBQVc7Z0JBQ3JCLFNBQVMsRUFBRTtvQkFDVixhQUFhO2lCQUNiO2FBQ0Q7Ozs7WUE1QkEsVUFBVTtZQUVWLGdCQUFnQjtZQU1SLGFBQWE7WUFFYixZQUFZOzs7b0JBd0JuQixLQUFLO3dCQUlMLEtBQUs7c0JBS0wsS0FBSzsyQkFTTCxLQUFLO3dCQUlMLEtBQUs7cUJBSUwsS0FBSzsyQkFJTCxLQUFLO2tCQUlMLEtBQUs7MkJBSUwsS0FBSzttQkFJTCxLQUFLO3FCQUVMLEtBQUssWUFBSSxXQUFXLFNBQUMsb0JBQW9CO3VCQUl6QyxLQUFLOzBCQUlMLEtBQUs7c0JBUUwsTUFBTTtxQkFJTixNQUFNOzJCQUlOLE1BQU07bUJBRU4sV0FBVyxTQUFDLFdBQVc7dUJBQ3ZCLFdBQVcsU0FBQyxvQkFBb0I7dUJBQ2hDLFdBQVcsU0FBQyxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuXHREaXJlY3RpdmUsXG5cdElucHV0LFxuXHRPdXRwdXQsXG5cdEV2ZW50RW1pdHRlcixcblx0T25Jbml0LFxuXHRPbkRlc3Ryb3ksXG5cdEVsZW1lbnRSZWYsXG5cdFRlbXBsYXRlUmVmLFxuXHRWaWV3Q29udGFpbmVyUmVmLFxuXHRPbkNoYW5nZXMsXG5cdEhvc3RCaW5kaW5nLFxuXHRTaW1wbGVDaGFuZ2VzLFxuXHRDb21wb25lbnRSZWZcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tIFwiLi9kaWFsb2cuc2VydmljZVwiO1xuaW1wb3J0IHsgQ2xvc2VNZXRhLCBDbG9zZVJlYXNvbnMsIERpYWxvZ0NvbmZpZyB9IGZyb20gXCIuL2RpYWxvZy1jb25maWcuaW50ZXJmYWNlXCI7XG5pbXBvcnQgeyBFdmVudFNlcnZpY2UgfSBmcm9tIFwiY2FyYm9uLWNvbXBvbmVudHMtYW5ndWxhci91dGlsc1wiO1xuaW1wb3J0IHsgRGlhbG9nIH0gZnJvbSBcIi4vZGlhbG9nLmNvbXBvbmVudFwiO1xuXG4vKipcbiAqIEEgZ2VuZXJpYyBkaXJlY3RpdmUgdGhhdCBjYW4gYmUgaW5oZXJpdGVkIGZyb20gdG8gY3JlYXRlIGRpYWxvZ3MgKGZvciBleGFtcGxlLCBhIHRvb2x0aXAgb3IgcG9wb3ZlcilcbiAqXG4gKiBUaGlzIGNsYXNzIGNvbnRhaW5zIHRoZSByZWxldmFudCBpbml0aWFsaXphdGlvbiBjb2RlLCBzcGVjaWZpYyB0ZW1wbGF0ZXMsIG9wdGlvbnMsIGFuZCBhZGRpdGlvbmFsIGlucHV0c1xuICogc2hvdWxkIGJlIHNwZWNpZmllZCBpbiB0aGUgZGVyaXZlZCBjbGFzcy5cbiAqXG4gKiBOT1RFOiBBbGwgY2hpbGQgY2xhc3NlcyBzaG91bGQgYWRkIGBEaWFsb2dTZXJ2aWNlYCBhcyBhIHByb3ZpZGVyLCBvdGhlcndpc2UgdGhleSB3aWxsIGxvc2UgY29udGV4dCB0aGF0XG4gKiB0aGUgc2VydmljZSByZWxpZXMgb24uXG4gKi9cbkBEaXJlY3RpdmUoe1xuXHRzZWxlY3RvcjogXCJbaWJtRGlhbG9nXVwiLFxuXHRleHBvcnRBczogXCJpYm1EaWFsb2dcIixcblx0cHJvdmlkZXJzOiBbXG5cdFx0RGlhbG9nU2VydmljZVxuXHRdXG59KVxuZXhwb3J0IGNsYXNzIERpYWxvZ0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xuXHRzdGF0aWMgZGlhbG9nQ291bnRlciA9IDA7XG5cdC8qKlxuXHQgKiBUaXRsZSBmb3IgdGhlIGRpYWxvZ1xuXHQgKi9cblx0QElucHV0KCkgdGl0bGUgPSBcIlwiO1xuXHQvKipcblx0ICogRGlhbG9nIGJvZHkgY29udGVudC5cblx0ICovXG5cdEBJbnB1dCgpIGlibURpYWxvZzogc3RyaW5nIHwgVGVtcGxhdGVSZWY8YW55Pjtcblx0LyoqXG5cdCAqIERlZmluZXMgaG93IHRoZSBEaWFsb2cgaXMgdHJpZ2dlcmVkLihIb3ZlciBhbmQgY2xpY2sgYmVoYXZlIHRoZSBzYW1lIG9uIG1vYmlsZSAtIGJvdGggcmVzcG9uZCB0byBhIHNpbmdsZSB0YXApLlxuXHQgKiBEbyBub3QgYWRkIGZvY3VzYWJsZSBlbGVtZW50cyBpZiB0cmlnZ2VyIGlzIGBob3ZlcmAgb3IgYG1vdXNlZW50ZXJgLlxuXHQgKi9cblx0QElucHV0KCkgdHJpZ2dlcjogXCJjbGlja1wiIHwgXCJob3ZlclwiIHwgXCJtb3VzZWVudGVyXCIgPSBcImNsaWNrXCI7XG5cdC8qKlxuXHQgKiBEZWZpbmVzIGhvdyB0aGUgRGlhbG9nIGNsb3NlIGV2ZW50IGlzIHRyaWdnZXJlZC5cblx0ICpcblx0ICogW1NlZSBoZXJlXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRWxlbWVudC9tb3VzZWxlYXZlX2V2ZW50KVxuXHQgKiBmb3IgbW9yZSBvbiB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGBtb3VzZWxlYXZlYCBhbmQgYG1vdXNlb3V0YC5cblx0ICpcblx0ICogRGVmYXVsdHMgdG8gYGNsaWNrYCB3aGVuIGB0cmlnZ2VyYCBpcyBzZXQgdG8gYGNsaWNrYC5cblx0ICovXG5cdEBJbnB1dCgpIGNsb3NlVHJpZ2dlcjogXCJtb3VzZW91dFwiIHwgXCJtb3VzZWxlYXZlXCIgPSBcIm1vdXNlbGVhdmVcIjtcblx0LyoqXG5cdCAqIFBsYWNlbWVudCBvZiB0aGUgZGlhbG9nLCB1c3VhbGx5IHJlbGF0aXZlIHRvIHRoZSBlbGVtZW50IHRoZSBkaXJlY3RpdmUgaXMgb24uXG5cdCAqL1xuXHRASW5wdXQoKSBwbGFjZW1lbnQgPSBcImxlZnRcIjtcblx0LyoqXG5cdCAqIFRoaXMgc3BlY2lmaWVzIGFueSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBvZmZzZXQgZm9yIHRoZSBwb3NpdGlvbiBvZiB0aGUgZGlhbG9nXG5cdCAqL1xuXHRASW5wdXQoKSBvZmZzZXQ6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIgfTtcblx0LyoqXG5cdCAqIENsYXNzZXMgdG8gYWRkIHRvIHRoZSBkaWFsb2cgY29udGFpbmVyXG5cdCAqL1xuXHRASW5wdXQoKSB3cmFwcGVyQ2xhc3M6IHN0cmluZztcblx0LyoqXG5cdCAqIFNwYWNpbmcgYmV0d2VlbiB0aGUgZGlhbG9nIGFuZCBpdCdzIHRyaWdnZXJpbmcgZWxlbWVudFxuXHQgKi9cblx0QElucHV0KCkgZ2FwID0gMDtcblx0LyoqXG5cdCAqIFNldCB0byBgdHJ1ZWAgdG8gb3BlbiB0aGUgZGlhbG9nIG5leHQgdG8gdGhlIHRyaWdnZXJpbmcgY29tcG9uZW50XG5cdCAqL1xuXHRASW5wdXQoKSBhcHBlbmRJbmxpbmUgPSBmYWxzZTtcblx0LyoqXG5cdCAqIE9wdGlvbmFsIGRhdGEgZm9yIHRlbXBsYXRlc1xuXHQgKi9cblx0QElucHV0KCkgZGF0YSA9IHt9O1xuXG5cdEBJbnB1dCgpIEBIb3N0QmluZGluZyhcImF0dHIuYXJpYS1leHBhbmRlZFwiKSBpc09wZW4gPSBmYWxzZTtcblx0LyoqXG5cdCAqIFRoaXMgcHJldmVudHMgdGhlIGRpYWxvZyBmcm9tIGJlaW5nIHRvZ2dsZWRcblx0ICovXG5cdEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XG5cdC8qKlxuXHQgKiBUaGlzIGlucHV0IGFsbG93cyBleHBsaWNpdCBjb250cm9sIG92ZXIgaG93IHRoZSBkaWFsb2cgc2hvdWxkIGNsb3NlXG5cdCAqL1xuXHRASW5wdXQoKSBzaG91bGRDbG9zZTogKG1ldGE6IENsb3NlTWV0YSkgPT4gYm9vbGVhbjtcblx0LyoqXG5cdCAqIENvbmZpZyBvYmplY3QgcGFzc2VkIHRvIHRoZSByZW5kZXJlZCBjb21wb25lbnRcblx0ICovXG5cdGRpYWxvZ0NvbmZpZzogRGlhbG9nQ29uZmlnO1xuXHQvKipcblx0ICogRW1pdHMgYW4gZXZlbnQgd2hlbiB0aGUgZGlhbG9nIGlzIGNsb3NlZFxuXHQgKi9cblx0QE91dHB1dCgpIG9uQ2xvc2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXHQvKipcblx0ICogRW1pdHMgYW4gZXZlbnQgd2hlbiB0aGUgZGlhbG9nIGlzIG9wZW5lZFxuXHQgKi9cblx0QE91dHB1dCgpIG9uT3BlbjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cdC8qKlxuXHQgKiBFbWl0cyBhbiBldmVudCB3aGVuIHRoZSBzdGF0ZSBvZiBgaXNPcGVuYCBjaGFuZ2VzLiBBbGxvd3MgYGlzT3BlbmAgdG8gYmUgZG91YmxlIGJvdW5kXG5cdCAqL1xuXHRAT3V0cHV0KCkgaXNPcGVuQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG5cdEBIb3N0QmluZGluZyhcImF0dHIucm9sZVwiKSByb2xlID0gXCJidXR0b25cIjtcblx0QEhvc3RCaW5kaW5nKFwiYXR0ci5hcmlhLWhhc3BvcHVwXCIpIGhhc1BvcHVwID0gdHJ1ZTtcblx0QEhvc3RCaW5kaW5nKFwiYXR0ci5hcmlhLW93bnNcIikgZ2V0IGFyaWFPd25zKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIHRoaXMuaXNPcGVuID8gdGhpcy5kaWFsb2dDb25maWcuY29tcElEIDogbnVsbDtcblx0fVxuXG5cdC8qKlxuXHQgKiBLZWVwcyBhIHJlZmVyZW5jZSB0byB0aGUgY3VycmVudGx5IG9wZW5lZCBkaWFsb2dcblx0ICovXG5cdHByb3RlY3RlZCBkaWFsb2dSZWY6IENvbXBvbmVudFJlZjxEaWFsb2c+O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIERpYWxvZ0RpcmVjdGl2ZS5cblx0ICogQHBhcmFtIGVsZW1lbnRSZWZcblx0ICogQHBhcmFtIHZpZXdDb250YWluZXJSZWZcblx0ICogQHBhcmFtIGRpYWxvZ1NlcnZpY2Vcblx0ICogQHBhcmFtIGV2ZW50U2VydmljZVxuXHQgKi9cblx0Y29uc3RydWN0b3IoXG5cdFx0cHJvdGVjdGVkIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG5cdFx0cHJvdGVjdGVkIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXG5cdFx0cHJvdGVjdGVkIGRpYWxvZ1NlcnZpY2U6IERpYWxvZ1NlcnZpY2UsXG5cdFx0cHJvdGVjdGVkIGV2ZW50U2VydmljZTogRXZlbnRTZXJ2aWNlXG5cdCkge31cblxuXHRuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG5cdFx0Ly8gc2V0IHRoZSBjb25maWcgb2JqZWN0ICh0aGlzIGNhbiBbYW5kIHNob3VsZCFdIGJlIGFkZGVkIHRvIGluIGNoaWxkIGNsYXNzZXMgZGVwZW5kaW5nIG9uIHdoYXQgdGhleSBuZWVkKVxuXHRcdHRoaXMuZGlhbG9nQ29uZmlnID0ge1xuXHRcdFx0dGl0bGU6IHRoaXMudGl0bGUsXG5cdFx0XHRjb250ZW50OiB0aGlzLmlibURpYWxvZyxcblx0XHRcdHBsYWNlbWVudDogdGhpcy5wbGFjZW1lbnQsXG5cdFx0XHRwYXJlbnRSZWY6IHRoaXMuZWxlbWVudFJlZixcblx0XHRcdGdhcDogdGhpcy5nYXAsXG5cdFx0XHR0cmlnZ2VyOiB0aGlzLnRyaWdnZXIsXG5cdFx0XHRjbG9zZVRyaWdnZXI6IHRoaXMuY2xvc2VUcmlnZ2VyLFxuXHRcdFx0c2hvdWxkQ2xvc2U6IHRoaXMuc2hvdWxkQ2xvc2UgfHwgKCgpID0+IHRydWUpLFxuXHRcdFx0YXBwZW5kSW5saW5lOiB0aGlzLmFwcGVuZElubGluZSxcblx0XHRcdHdyYXBwZXJDbGFzczogdGhpcy53cmFwcGVyQ2xhc3MsXG5cdFx0XHRkYXRhOiB0aGlzLmRhdGEsXG5cdFx0XHRvZmZzZXQ6IHRoaXMub2Zmc2V0LFxuXHRcdFx0ZGlzYWJsZWQ6IHRoaXMuZGlzYWJsZWRcblx0XHR9O1xuXG5cdFx0aWYgKGNoYW5nZXMuaXNPcGVuKSB7XG5cdFx0XHRpZiAoY2hhbmdlcy5pc09wZW4uY3VycmVudFZhbHVlKSB7XG5cdFx0XHRcdHRoaXMub3BlbigpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5jbG9zZSh7XG5cdFx0XHRcdFx0cmVhc29uOiBDbG9zZVJlYXNvbnMucHJvZ3JhbW1hdGljXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFJ1biBhbnkgY29kZSBhIGNoaWxkIGNsYXNzIG1heSBuZWVkLlxuXHRcdHRoaXMub25EaWFsb2dDaGFuZ2VzKGNoYW5nZXMpO1xuXHRcdHRoaXMudXBkYXRlQ29uZmlnKCk7XG5cdH1cblxuXHQvKipcblx0ICogU2V0cyB0aGUgY29uZmlnIG9iamVjdCBhbmQgYmluZHMgZXZlbnRzIGZvciBob3ZlcmluZyBvciBjbGlja2luZyBiZWZvcmVcblx0ICogcnVubmluZyBjb2RlIGZyb20gY2hpbGQgY2xhc3MuXG5cdCAqL1xuXHRuZ09uSW5pdCgpIHtcblx0XHQvLyBmaXggZm9yIHNhZmFyaSBoaWphY2tpbmcgY2xpY2tzXG5cdFx0dGhpcy5kaWFsb2dTZXJ2aWNlLnNpbmdsZXRvbkNsaWNrTGlzdGVuKCk7XG5cblx0XHRjb25zdCBlbGVtZW50ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG5cblx0XHR0aGlzLmV2ZW50U2VydmljZS5vbihlbGVtZW50LCBcImtleWRvd25cIiwgKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XG5cdFx0XHQvLyBcIkVzY1wiIGlzIGFuIElFIHNwZWNpZmljIHZhbHVlXG5cdFx0XHRpZiAoZXZlbnQudGFyZ2V0ID09PSB0aGlzLmRpYWxvZ0NvbmZpZy5wYXJlbnRSZWYubmF0aXZlRWxlbWVudCAmJlxuXHRcdFx0XHQoZXZlbnQua2V5ID09PSBcIlRhYlwiIHx8IGV2ZW50LmtleSA9PT0gXCJUYWJcIiAmJiBldmVudC5zaGlmdEtleSkgfHxcblx0XHRcdFx0ZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiIHx8IGV2ZW50LmtleSA9PT0gXCJFc2NcIikge1xuXHRcdFx0XHR0aGlzLmNsb3NlKHtcblx0XHRcdFx0XHRyZWFzb246IENsb3NlUmVhc29ucy5pbnRlcmFjdGlvbixcblx0XHRcdFx0XHR0YXJnZXQ6IGV2ZW50LnRhcmdldFxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIGJpbmQgZXZlbnRzIGZvciBob3ZlcmluZyBvciBjbGlja2luZyB0aGUgaG9zdFxuXHRcdGlmICh0aGlzLnRyaWdnZXIgPT09IFwiaG92ZXJcIiB8fCB0aGlzLnRyaWdnZXIgPT09IFwibW91c2VlbnRlclwiKSB7XG5cdFx0XHR0aGlzLmV2ZW50U2VydmljZS5vbihlbGVtZW50LCBcIm1vdXNlZW50ZXJcIiwgdGhpcy5vcGVuLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5ldmVudFNlcnZpY2Uub24oZWxlbWVudCwgdGhpcy5jbG9zZVRyaWdnZXIsIChldmVudCkgPT4ge1xuXHRcdFx0XHR0aGlzLmNsb3NlKHtcblx0XHRcdFx0XHRyZWFzb246IENsb3NlUmVhc29ucy5pbnRlcmFjdGlvbixcblx0XHRcdFx0XHR0YXJnZXQ6IGV2ZW50LnRhcmdldFxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5ldmVudFNlcnZpY2Uub24oZWxlbWVudCwgXCJmb2N1c1wiLCB0aGlzLm9wZW4uYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLmV2ZW50U2VydmljZS5vbihlbGVtZW50LCBcImJsdXJcIiwgKGV2ZW50KSA9PiB7XG5cdFx0XHRcdHRoaXMuY2xvc2Uoe1xuXHRcdFx0XHRcdHJlYXNvbjogQ2xvc2VSZWFzb25zLmludGVyYWN0aW9uLFxuXHRcdFx0XHRcdHRhcmdldDogZXZlbnQudGFyZ2V0XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuZXZlbnRTZXJ2aWNlLm9uKGVsZW1lbnQsIFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG5cdFx0XHRcdHRoaXMudG9nZ2xlKHtcblx0XHRcdFx0XHRyZWFzb246IENsb3NlUmVhc29ucy5pbnRlcmFjdGlvbixcblx0XHRcdFx0XHR0YXJnZXQ6IGV2ZW50LnRhcmdldFxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5ldmVudFNlcnZpY2Uub24oZWxlbWVudCwgXCJrZXlkb3duXCIsIChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xuXHRcdFx0XHQvLyBcIlNwYWNlYmFyXCIgaXMgYW4gSUUgc3BlY2lmaWMgdmFsdWVcblx0XHRcdFx0aWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiIHx8IGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIlNwYWNlYmFyXCIpIHtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRcdHRoaXMub3BlbigpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHREaWFsb2dEaXJlY3RpdmUuZGlhbG9nQ291bnRlcisrO1xuXHRcdHRoaXMuZGlhbG9nQ29uZmlnLmNvbXBJRCA9IFwiZGlhbG9nLVwiICsgRGlhbG9nRGlyZWN0aXZlLmRpYWxvZ0NvdW50ZXI7XG5cblx0XHQvLyBydW4gYW55IGNvZGUgYSBjaGlsZCBjbGFzcyBtYXkgbmVlZFxuXHRcdHRoaXMub25EaWFsb2dJbml0KCk7XG5cdFx0dGhpcy51cGRhdGVDb25maWcoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBXaGVuIHRoZSBob3N0IGRpZXMsIGtpbGwgdGhlIHBvcG92ZXIuXG5cdCAqIC0gVXNlZnVsIGZvciB1c2UgaW4gYSBtb2RhbCBvciBzaW1pbGFyLlxuXHQgKi9cblx0bmdPbkRlc3Ryb3koKSB7XG5cdFx0dGhpcy5jbG9zZSh7XG5cdFx0XHRyZWFzb246IENsb3NlUmVhc29ucy5kZXN0cm95ZWRcblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBIZWxwZXIgbWV0aG9kIHRvIGNhbGwgZGlhbG9nU2VydmljZSAnb3BlbicuXG5cdCAqIC0gRW5mb3JjZSBhY2Nlc3NpYmlsaXR5IGJ5IHVwZGF0aW5nIGFuIGFyaWEgYXR0ciBmb3IgbmF0aXZlRWxlbWVudC5cblx0ICovXG5cdG9wZW4oKSB7XG5cdFx0Ly8gZG9uJ3QgYWxsb3cgZGlhbG9ncyB0byBiZSBvcGVuZWQgaWYgdGhleSdyZSBhbHJlYWR5IG9wZW5cblx0XHRpZiAodGhpcy5kaWFsb2dSZWYgfHwgdGhpcy5kaXNhYmxlZCkgeyByZXR1cm47IH1cblxuXHRcdC8vIGFjdHVhbGx5IG9wZW4gdGhlIGRpYWxvZywgZW1pdCBldmVudHMsIGFuZCBzZXQgdGhlIG9wZW4gc3RhdGVcblx0XHR0aGlzLmRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nU2VydmljZS5vcGVuKHRoaXMudmlld0NvbnRhaW5lclJlZiwgdGhpcy5kaWFsb2dDb25maWcpO1xuXHRcdHRoaXMuaXNPcGVuID0gdHJ1ZTtcblx0XHR0aGlzLm9uT3Blbi5lbWl0KCk7XG5cdFx0dGhpcy5pc09wZW5DaGFuZ2UuZW1pdCh0cnVlKTtcblxuXHRcdC8vIEhhbmRsZXMgZW1pdHRpbmcgYWxsIHRoZSBjbG9zZSBldmVudHMgdG8gY2xlYW4gZXZlcnl0aGluZyB1cFxuXHRcdC8vIEFsc28gZW5mb3JjZSBhY2Nlc3NpYmlsaXR5IG9uIGNsb3NlIGJ5IHVwZGF0aW5nIGFuIGFyaWEgYXR0ciBvbiB0aGUgbmF0aXZlRWxlbWVudC5cblx0XHR0aGlzLmRpYWxvZ1JlZi5pbnN0YW5jZS5jbG9zZS5zdWJzY3JpYmUoKG1ldGE6IENsb3NlTWV0YSkgPT4ge1xuXHRcdFx0aWYgKCF0aGlzLmRpYWxvZ1JlZikgeyByZXR1cm47IH1cblx0XHRcdGlmICh0aGlzLmRpYWxvZ0NvbmZpZy5zaG91bGRDbG9zZSAmJiB0aGlzLmRpYWxvZ0NvbmZpZy5zaG91bGRDbG9zZShtZXRhKSkge1xuXHRcdFx0XHQvLyBjbG9zZSB0aGUgZGlhbG9nLCBlbWl0IGV2ZW50cywgYW5kIGNsZWFyIG91dCB0aGUgb3BlbiBzdGF0ZXNcblx0XHRcdFx0dGhpcy5kaWFsb2dTZXJ2aWNlLmNsb3NlKHRoaXMuZGlhbG9nUmVmKTtcblx0XHRcdFx0dGhpcy5kaWFsb2dSZWYgPSBudWxsO1xuXHRcdFx0XHR0aGlzLmlzT3BlbiA9IGZhbHNlO1xuXHRcdFx0XHR0aGlzLm9uQ2xvc2UuZW1pdCgpO1xuXHRcdFx0XHR0aGlzLmlzT3BlbkNoYW5nZS5lbWl0KGZhbHNlKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiB0aGlzLmRpYWxvZ1JlZjtcblx0fVxuXG5cdC8qKlxuXHQgKiBIZWxwZXIgbWV0aG9kIHRvIHRvZ2dsZSB0aGUgb3BlbiBzdGF0ZSBvZiB0aGUgZGlhbG9nXG5cdCAqL1xuXHR0b2dnbGUobWV0YTogQ2xvc2VNZXRhID0geyByZWFzb246IENsb3NlUmVhc29ucy5pbnRlcmFjdGlvbiB9KSB7XG5cdFx0aWYgKCF0aGlzLmlzT3Blbikge1xuXHRcdFx0dGhpcy5vcGVuKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuY2xvc2UobWV0YSk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEhlbHBlciBtZXRob2QgdG8gY2xvc2UgdGhlIGRpYWxvZ1JlZi5cblx0ICovXG5cdGNsb3NlKG1ldGE6IENsb3NlTWV0YSA9IHsgcmVhc29uOiBDbG9zZVJlYXNvbnMuaW50ZXJhY3Rpb24gfSkge1xuXHRcdGlmICh0aGlzLmRpYWxvZ1JlZikge1xuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdHRoaXMuZGlhbG9nUmVmLmluc3RhbmNlLmRvQ2xvc2UobWV0YSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogRW1wdHkgbWV0aG9kIGZvciBjaGlsZCBjbGFzc2VzIHRvIG92ZXJyaWRlIGFuZCBzcGVjaWZ5IGFkZGl0aW9uYWwgaW5pdCBzdGVwcy5cblx0ICogUnVuIGFmdGVyIERpYWxvZ0RpcmVjdGl2ZSBjb21wbGV0ZXMgaXQncyBuZ09uSW5pdC5cblx0ICovXG5cdHByb3RlY3RlZCBvbkRpYWxvZ0luaXQoKSB7fVxuXG5cdC8qKlxuXHQgKiBFbXB0eSBtZXRob2QgZm9yIGNoaWxkIHRvIG92ZXJyaWRlIGFuZCBzcGVjaWZ5IGFkZGl0aW9uYWwgb24gY2hhbmdlcyBzdGVwcy5cblx0ICogcnVuIGFmdGVyIERpYWxvZ0RpcmVjdGl2ZSBjb21wbGV0ZXMgaXQncyBuZ09uQ2hhbmdlcy5cblx0ICovXG5cdHByb3RlY3RlZCBvbkRpYWxvZ0NoYW5nZXMoX2NoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHt9XG5cblx0cHJvdGVjdGVkIHVwZGF0ZUNvbmZpZygpIHt9XG59XG4iXX0=