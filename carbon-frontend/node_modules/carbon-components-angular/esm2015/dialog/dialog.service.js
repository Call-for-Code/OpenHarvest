/**
 *
 * carbon-angular v0.0.0 | dialog.service.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Injector, ComponentFactoryResolver, Injectable } from "@angular/core";
import { CloseReasons } from "./dialog-config.interface";
import { PlaceholderService } from "carbon-components-angular/placeholder";
import { tabbableSelector } from "carbon-components-angular/common";
/**
 * `Dialog` object to be injected into other components.
 */
export class DialogService {
    /**
     * Creates an instance of `DialogService`.
     */
    constructor(componentFactoryResolver, injector, placeholderService) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.placeholderService = placeholderService;
    }
    /**
     * Closes all known `Dialog`s. Does not focus any previous elements, since we can't know which would be correct
     */
    static closeAll() {
        DialogService.dialogRefs.forEach(ref => ref.instance.doClose({
            reason: CloseReasons.programmatic
        }));
        DialogService.dialogRefs.clear();
    }
    /**
     * Set the context for the service. For example, the `component` property can be used to set the
     * default component that should be created by the service, for a given instance of the service.
     * @param options `{ component: any }` where `component` is a component that extends `dialog.component`
     */
    setContext(options) {
        this.componentFactory = this.componentFactoryResolver.resolveComponentFactory(options.component);
    }
    /**
     * If `dialogRef` is defined, the Dialog is already open. If
     * `dialogRef` is undefined, we create the `Dialog` component and reference to it.
     * A subscription is created to track if the `Dialog` should close.
     *
     * @param viewContainer a `ViewContainerRef` to instantiate the component against.
     * May be `null` if an `ibm-placeholder` exists and `dialogConfig.appendInline` is false
     * @param dialogConfig the `DialogConfig` for the component
     */
    open(viewContainer, dialogConfig, component) {
        let componentFactory = this.componentFactory;
        if (component) {
            componentFactory = this.componentFactoryResolver.resolveComponentFactory(component);
        }
        let dialogRef;
        if (dialogConfig.appendInline) {
            // add our component to the view
            dialogRef = viewContainer.createComponent(componentFactory, 0, this.injector);
        }
        else if (!this.placeholderService.hasPlaceholderRef()) {
            dialogRef = viewContainer.createComponent(componentFactory, 0, this.injector);
            if (dialogRef) {
                setTimeout(() => {
                    window.document.querySelector("body").appendChild(dialogRef.location.nativeElement);
                });
            }
        }
        else {
            dialogRef = this.placeholderService.createComponent(componentFactory, this.injector);
        }
        // keep track of all initialized dialogs
        DialogService.dialogRefs.add(dialogRef);
        // initialize some extra options
        dialogConfig["previouslyFocusedElement"] = document.activeElement;
        dialogRef.instance.dialogConfig = dialogConfig;
        dialogRef.instance.elementRef.nativeElement.focus();
        return dialogRef;
    }
    /**
     * On close of `Dialog` item, sets focus back to previous item, unsets
     * the current `dialogRef` item. Unsubscribes to the event of `Dialog` close.
     *
     * @param dialogRef the dialogRef to close
     */
    close(dialogRef) {
        // to handle the case where we have a null `this.dialogRef`
        if (!dialogRef) {
            return;
        }
        const elementToFocus = dialogRef.instance.dialogConfig["previouslyFocusedElement"];
        dialogRef.destroy();
        // update the globally tracked dialogRefs
        if (DialogService.dialogRefs.has(dialogRef)) {
            DialogService.dialogRefs.delete(dialogRef);
        }
        // Keeps the focus on the dialog trigger if there are no focusable elements. Change focus to previously focused element
        // if there are focusable elements in the dialog.
        if (!dialogRef.location.nativeElement.querySelectorAll(tabbableSelector)) {
            elementToFocus.focus();
        }
    }
    /**
     * Closes all known `Dialog`s. Does not focus any previous elements, since we can't know which would be correct
     *
     * @deprecated since v4. Use the static `DialogService.closeAll` instead
     */
    closeAll() {
        DialogService.closeAll();
    }
    /**
     * Fix for safari hijacking clicks.
     *
     * Runs on `ngOnInit` of every dialog. Ensures we don't have multiple listeners
     * because having many of them could degrade performance in certain cases (and is
     * not necessary for our use case)
     *
     * This is an internally used function, can change at any point (even get removed)
     * and changes to it won't be considered a breaking change. Use at your own risk.
     */
    singletonClickListen() {
        if (!DialogService.listeningForBodyClicks) {
            document.body.firstElementChild.addEventListener("click", () => null, true);
            DialogService.listeningForBodyClicks = true;
        }
    }
}
/**
 * Used in `singletonClickListen`, don't count on its existence and values.
 */
DialogService.listeningForBodyClicks = false;
/**
 * A set of all known dialog components
 */
DialogService.dialogRefs = new Set();
DialogService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DialogService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: PlaceholderService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9jYXJib24tY29tcG9uZW50cy1hbmd1bGFyL2RpYWxvZy8iLCJzb3VyY2VzIjpbImRpYWxvZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTixRQUFRLEVBR1Isd0JBQXdCLEVBQ3hCLFVBQVUsRUFFVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFnQixNQUFNLDJCQUEyQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBRTNFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBRXBFOztHQUVHO0FBRUgsTUFBTSxPQUFPLGFBQWE7SUEwQnpCOztPQUVHO0lBQ0gsWUFDVyx3QkFBa0QsRUFDbEQsUUFBa0IsRUFDbEIsa0JBQXNDO1FBRnRDLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO0lBQzlDLENBQUM7SUF0Qko7O09BRUc7SUFDSSxNQUFNLENBQUMsUUFBUTtRQUNyQixhQUFhLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDO1lBQzVELE1BQU0sRUFBRSxZQUFZLENBQUMsWUFBWTtTQUNqQyxDQUFDLENBQUMsQ0FBQztRQUNKLGFBQWEsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDbEMsQ0FBQztJQWdCRDs7OztPQUlHO0lBQ0gsVUFBVSxDQUFDLE9BQTJCO1FBQ3JDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsdUJBQXVCLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ2xHLENBQUM7SUFFRDs7Ozs7Ozs7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QUFFaEQ7O0dBRUc7QUFDYyx3QkFBVSxHQUFHLElBQUksR0FBRyxFQUF3QixDQUFDOztZQVY5RCxVQUFVOzs7O1lBWlYsd0JBQXdCO1lBSHhCLFFBQVE7WUFRQSxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuXHRJbmplY3Rvcixcblx0Q29tcG9uZW50UmVmLFxuXHRDb21wb25lbnRGYWN0b3J5LFxuXHRDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG5cdEluamVjdGFibGUsXG5cdFZpZXdDb250YWluZXJSZWZcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IENsb3NlUmVhc29ucywgRGlhbG9nQ29uZmlnIH0gZnJvbSBcIi4vZGlhbG9nLWNvbmZpZy5pbnRlcmZhY2VcIjtcbmltcG9ydCB7IFBsYWNlaG9sZGVyU2VydmljZSB9IGZyb20gXCJjYXJib24tY29tcG9uZW50cy1hbmd1bGFyL3BsYWNlaG9sZGVyXCI7XG5pbXBvcnQgeyBEaWFsb2cgfSBmcm9tIFwiLi9kaWFsb2cuY29tcG9uZW50XCI7XG5pbXBvcnQgeyB0YWJiYWJsZVNlbGVjdG9yIH0gZnJvbSBcImNhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvY29tbW9uXCI7XG5cbi8qKlxuICogYERpYWxvZ2Agb2JqZWN0IHRvIGJlIGluamVjdGVkIGludG8gb3RoZXIgY29tcG9uZW50cy5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERpYWxvZ1NlcnZpY2Uge1xuXHQvKipcblx0ICogVXNlZCBpbiBgc2luZ2xldG9uQ2xpY2tMaXN0ZW5gLCBkb24ndCBjb3VudCBvbiBpdHMgZXhpc3RlbmNlIGFuZCB2YWx1ZXMuXG5cdCAqL1xuXHRwcm90ZWN0ZWQgc3RhdGljIGxpc3RlbmluZ0ZvckJvZHlDbGlja3MgPSBmYWxzZTtcblxuXHQvKipcblx0ICogQSBzZXQgb2YgYWxsIGtub3duIGRpYWxvZyBjb21wb25lbnRzXG5cdCAqL1xuXHRwcm90ZWN0ZWQgc3RhdGljIGRpYWxvZ1JlZnMgPSBuZXcgU2V0PENvbXBvbmVudFJlZjxEaWFsb2c+PigpO1xuXG5cdC8qKlxuXHQgKiBDbG9zZXMgYWxsIGtub3duIGBEaWFsb2dgcy4gRG9lcyBub3QgZm9jdXMgYW55IHByZXZpb3VzIGVsZW1lbnRzLCBzaW5jZSB3ZSBjYW4ndCBrbm93IHdoaWNoIHdvdWxkIGJlIGNvcnJlY3Rcblx0ICovXG5cdHB1YmxpYyBzdGF0aWMgY2xvc2VBbGwoKSB7XG5cdFx0RGlhbG9nU2VydmljZS5kaWFsb2dSZWZzLmZvckVhY2gocmVmID0+IHJlZi5pbnN0YW5jZS5kb0Nsb3NlKHtcblx0XHRcdHJlYXNvbjogQ2xvc2VSZWFzb25zLnByb2dyYW1tYXRpY1xuXHRcdH0pKTtcblx0XHREaWFsb2dTZXJ2aWNlLmRpYWxvZ1JlZnMuY2xlYXIoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBUaGUgZGVmYXVsdCBjb21wb25lbnQgZmFjdG9yeSB0byB1c2Ugd2hlbiBjcmVhdGluZyBkaWFsb2dzXG5cdCAqL1xuXHRwdWJsaWMgY29tcG9uZW50RmFjdG9yeTogQ29tcG9uZW50RmFjdG9yeTxhbnk+O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBEaWFsb2dTZXJ2aWNlYC5cblx0ICovXG5cdGNvbnN0cnVjdG9yKFxuXHRcdHByb3RlY3RlZCBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcblx0XHRwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yLFxuXHRcdHByb3RlY3RlZCBwbGFjZWhvbGRlclNlcnZpY2U6IFBsYWNlaG9sZGVyU2VydmljZVxuXHQpIHt9XG5cblx0LyoqXG5cdCAqIFNldCB0aGUgY29udGV4dCBmb3IgdGhlIHNlcnZpY2UuIEZvciBleGFtcGxlLCB0aGUgYGNvbXBvbmVudGAgcHJvcGVydHkgY2FuIGJlIHVzZWQgdG8gc2V0IHRoZVxuXHQgKiBkZWZhdWx0IGNvbXBvbmVudCB0aGF0IHNob3VsZCBiZSBjcmVhdGVkIGJ5IHRoZSBzZXJ2aWNlLCBmb3IgYSBnaXZlbiBpbnN0YW5jZSBvZiB0aGUgc2VydmljZS5cblx0ICogQHBhcmFtIG9wdGlvbnMgYHsgY29tcG9uZW50OiBhbnkgfWAgd2hlcmUgYGNvbXBvbmVudGAgaXMgYSBjb21wb25lbnQgdGhhdCBleHRlbmRzIGBkaWFsb2cuY29tcG9uZW50YFxuXHQgKi9cblx0c2V0Q29udGV4dChvcHRpb25zOiB7IGNvbXBvbmVudDogYW55IH0pIHtcblx0XHR0aGlzLmNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShvcHRpb25zLmNvbXBvbmVudCk7XG5cdH1cblxuXHQvKipcblx0ICogSWYgYGRpYWxvZ1JlZmAgaXMgZGVmaW5lZCwgdGhlIERpYWxvZyBpcyBhbHJlYWR5IG9wZW4uIElmXG5cdCAqIGBkaWFsb2dSZWZgIGlzIHVuZGVmaW5lZCwgd2UgY3JlYXRlIHRoZSBgRGlhbG9nYCBjb21wb25lbnQgYW5kIHJlZmVyZW5jZSB0byBpdC5cblx0ICogQSBzdWJzY3JpcHRpb24gaXMgY3JlYXRlZCB0byB0cmFjayBpZiB0aGUgYERpYWxvZ2Agc2hvdWxkIGNsb3NlLlxuXHQgKlxuXHQgKiBAcGFyYW0gdmlld0NvbnRhaW5lciBhIGBWaWV3Q29udGFpbmVyUmVmYCB0byBpbnN0YW50aWF0ZSB0aGUgY29tcG9uZW50IGFnYWluc3QuXG5cdCAqIE1heSBiZSBgbnVsbGAgaWYgYW4gYGlibS1wbGFjZWhvbGRlcmAgZXhpc3RzIGFuZCBgZGlhbG9nQ29uZmlnLmFwcGVuZElubGluZWAgaXMgZmFsc2Vcblx0ICogQHBhcmFtIGRpYWxvZ0NvbmZpZyB0aGUgYERpYWxvZ0NvbmZpZ2AgZm9yIHRoZSBjb21wb25lbnRcblx0ICovXG5cdG9wZW4odmlld0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZiwgZGlhbG9nQ29uZmlnOiBEaWFsb2dDb25maWcsIGNvbXBvbmVudD86IGFueSkge1xuXHRcdGxldCBjb21wb25lbnRGYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5O1xuXHRcdGlmIChjb21wb25lbnQpIHtcblx0XHRcdGNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShjb21wb25lbnQpO1xuXHRcdH1cblxuXHRcdGxldCBkaWFsb2dSZWY7XG5cdFx0aWYgKGRpYWxvZ0NvbmZpZy5hcHBlbmRJbmxpbmUpIHtcblx0XHRcdC8vIGFkZCBvdXIgY29tcG9uZW50IHRvIHRoZSB2aWV3XG5cdFx0XHRkaWFsb2dSZWYgPSB2aWV3Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnRGYWN0b3J5LCAwLCB0aGlzLmluamVjdG9yKTtcblx0XHR9IGVsc2UgaWYgKCF0aGlzLnBsYWNlaG9sZGVyU2VydmljZS5oYXNQbGFjZWhvbGRlclJlZigpKSB7XG5cdFx0XHRkaWFsb2dSZWYgPSB2aWV3Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnRGYWN0b3J5LCAwLCB0aGlzLmluamVjdG9yKTtcblx0XHRcdGlmIChkaWFsb2dSZWYpIHtcblx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdFx0d2luZG93LmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJib2R5XCIpLmFwcGVuZENoaWxkKGRpYWxvZ1JlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGRpYWxvZ1JlZiA9IHRoaXMucGxhY2Vob2xkZXJTZXJ2aWNlLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnRGYWN0b3J5LCB0aGlzLmluamVjdG9yKTtcblx0XHR9XG5cblx0XHQvLyBrZWVwIHRyYWNrIG9mIGFsbCBpbml0aWFsaXplZCBkaWFsb2dzXG5cdFx0RGlhbG9nU2VydmljZS5kaWFsb2dSZWZzLmFkZChkaWFsb2dSZWYpO1xuXG5cdFx0Ly8gaW5pdGlhbGl6ZSBzb21lIGV4dHJhIG9wdGlvbnNcblx0XHRkaWFsb2dDb25maWdbXCJwcmV2aW91c2x5Rm9jdXNlZEVsZW1lbnRcIl0gPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXHRcdGRpYWxvZ1JlZi5pbnN0YW5jZS5kaWFsb2dDb25maWcgPSBkaWFsb2dDb25maWc7XG5cblx0XHRkaWFsb2dSZWYuaW5zdGFuY2UuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG5cblx0XHRyZXR1cm4gZGlhbG9nUmVmIGFzIENvbXBvbmVudFJlZjxEaWFsb2c+O1xuXHR9XG5cblx0LyoqXG5cdCAqIE9uIGNsb3NlIG9mIGBEaWFsb2dgIGl0ZW0sIHNldHMgZm9jdXMgYmFjayB0byBwcmV2aW91cyBpdGVtLCB1bnNldHNcblx0ICogdGhlIGN1cnJlbnQgYGRpYWxvZ1JlZmAgaXRlbS4gVW5zdWJzY3JpYmVzIHRvIHRoZSBldmVudCBvZiBgRGlhbG9nYCBjbG9zZS5cblx0ICpcblx0ICogQHBhcmFtIGRpYWxvZ1JlZiB0aGUgZGlhbG9nUmVmIHRvIGNsb3NlXG5cdCAqL1xuXHRjbG9zZShkaWFsb2dSZWY6IENvbXBvbmVudFJlZjxEaWFsb2c+KSB7XG5cdFx0Ly8gdG8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHdlIGhhdmUgYSBudWxsIGB0aGlzLmRpYWxvZ1JlZmBcblx0XHRpZiAoIWRpYWxvZ1JlZikgeyByZXR1cm47IH1cblxuXHRcdGNvbnN0IGVsZW1lbnRUb0ZvY3VzID0gZGlhbG9nUmVmLmluc3RhbmNlLmRpYWxvZ0NvbmZpZ1tcInByZXZpb3VzbHlGb2N1c2VkRWxlbWVudFwiXTtcblxuXHRcdGRpYWxvZ1JlZi5kZXN0cm95KCk7XG5cblx0XHQvLyB1cGRhdGUgdGhlIGdsb2JhbGx5IHRyYWNrZWQgZGlhbG9nUmVmc1xuXHRcdGlmIChEaWFsb2dTZXJ2aWNlLmRpYWxvZ1JlZnMuaGFzKGRpYWxvZ1JlZikpIHtcblx0XHRcdERpYWxvZ1NlcnZpY2UuZGlhbG9nUmVmcy5kZWxldGUoZGlhbG9nUmVmKTtcblx0XHR9XG5cblx0XHQvLyBLZWVwcyB0aGUgZm9jdXMgb24gdGhlIGRpYWxvZyB0cmlnZ2VyIGlmIHRoZXJlIGFyZSBubyBmb2N1c2FibGUgZWxlbWVudHMuIENoYW5nZSBmb2N1cyB0byBwcmV2aW91c2x5IGZvY3VzZWQgZWxlbWVudFxuXHRcdC8vIGlmIHRoZXJlIGFyZSBmb2N1c2FibGUgZWxlbWVudHMgaW4gdGhlIGRpYWxvZy5cblx0XHRpZiAoIWRpYWxvZ1JlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGFiYmFibGVTZWxlY3RvcikpIHtcblx0XHRcdGVsZW1lbnRUb0ZvY3VzLmZvY3VzKCk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIENsb3NlcyBhbGwga25vd24gYERpYWxvZ2BzLiBEb2VzIG5vdCBmb2N1cyBhbnkgcHJldmlvdXMgZWxlbWVudHMsIHNpbmNlIHdlIGNhbid0IGtub3cgd2hpY2ggd291bGQgYmUgY29ycmVjdFxuXHQgKlxuXHQgKiBAZGVwcmVjYXRlZCBzaW5jZSB2NC4gVXNlIHRoZSBzdGF0aWMgYERpYWxvZ1NlcnZpY2UuY2xvc2VBbGxgIGluc3RlYWRcblx0ICovXG5cdGNsb3NlQWxsKCkge1xuXHRcdERpYWxvZ1NlcnZpY2UuY2xvc2VBbGwoKTtcblx0fVxuXHQvKipcblx0ICogRml4IGZvciBzYWZhcmkgaGlqYWNraW5nIGNsaWNrcy5cblx0ICpcblx0ICogUnVucyBvbiBgbmdPbkluaXRgIG9mIGV2ZXJ5IGRpYWxvZy4gRW5zdXJlcyB3ZSBkb24ndCBoYXZlIG11bHRpcGxlIGxpc3RlbmVyc1xuXHQgKiBiZWNhdXNlIGhhdmluZyBtYW55IG9mIHRoZW0gY291bGQgZGVncmFkZSBwZXJmb3JtYW5jZSBpbiBjZXJ0YWluIGNhc2VzIChhbmQgaXNcblx0ICogbm90IG5lY2Vzc2FyeSBmb3Igb3VyIHVzZSBjYXNlKVxuXHQgKlxuXHQgKiBUaGlzIGlzIGFuIGludGVybmFsbHkgdXNlZCBmdW5jdGlvbiwgY2FuIGNoYW5nZSBhdCBhbnkgcG9pbnQgKGV2ZW4gZ2V0IHJlbW92ZWQpXG5cdCAqIGFuZCBjaGFuZ2VzIHRvIGl0IHdvbid0IGJlIGNvbnNpZGVyZWQgYSBicmVha2luZyBjaGFuZ2UuIFVzZSBhdCB5b3VyIG93biByaXNrLlxuXHQgKi9cblx0c2luZ2xldG9uQ2xpY2tMaXN0ZW4oKSB7XG5cdFx0aWYgKCFEaWFsb2dTZXJ2aWNlLmxpc3RlbmluZ0ZvckJvZHlDbGlja3MpIHtcblx0XHRcdGRvY3VtZW50LmJvZHkuZmlyc3RFbGVtZW50Q2hpbGQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG51bGwsIHRydWUpO1xuXHRcdFx0RGlhbG9nU2VydmljZS5saXN0ZW5pbmdGb3JCb2R5Q2xpY2tzID0gdHJ1ZTtcblx0XHR9XG5cdH1cbn1cbiJdfQ==