/**
 *
 * carbon-angular v0.0.0 | code-snippet.component.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Component, Input, HostBinding, ViewChild, HostListener } from "@angular/core";
import { I18n } from "carbon-components-angular/i18n";
export var SnippetType;
(function (SnippetType) {
    SnippetType["single"] = "single";
    SnippetType["multi"] = "multi";
    SnippetType["inline"] = "inline";
})(SnippetType || (SnippetType = {}));
/**
 * [See demo](../../?path=/story/code-snippet--basic)
 *
 * ```html
 * <ibm-code-snippet>Code</ibm-code-snippet>
 * ```
 *
 * <example-url>../../iframe.html?id=code-snippet--basic</example-url>
 */
export class CodeSnippet {
    /**
     * Creates an instance of CodeSnippet.
     */
    constructor(i18n) {
        this.i18n = i18n;
        /**
         * It can be `"single"`, `"multi"` or `"inline"`
         *
         */
        this.display = SnippetType.single;
        this.translations = this.i18n.get().CODE_SNIPPET;
        /**
         * Set to `"light"` to apply the light style on the code snippet.
         */
        this.theme = "dark";
        /**
         * Text displayed in the tooltip when user clicks button to copy code.
         *
         */
        this.feedbackText = this.translations.COPIED;
        /**
         * Time in miliseconds to keep the feedback tooltip displayed.
         *
         */
        this.feedbackTimeout = 2000;
        this.expanded = false;
        this.skeleton = false;
        this.snippetClass = true;
        this.showFeedback = false;
        this.hasExpandButton = null;
        CodeSnippet.codeSnippetCount++;
    }
    get snippetSingleClass() {
        return this.display === SnippetType.single;
    }
    get snippetMultiClass() {
        return this.display === SnippetType.multi;
    }
    get snippetInlineClass() {
        return this.display === SnippetType.inline;
    }
    get snippetInlineLightClass() {
        return this.display === SnippetType.inline && this.theme === "light";
    }
    get btnCopyClass() {
        return this.display === SnippetType.inline;
    }
    get displayStyle() {
        return this.display !== SnippetType.inline ? "block" : null;
    }
    get attrType() {
        return this.display === SnippetType.inline ? "button" : null;
    }
    get shouldShowExpandButton() {
        // Checks if `hasExpand` button has been initialized in `AfterViewInit` before detecting whether or not to
        // show the expand button when the code displayed in the component changes during the life of the component.
        // This is to avoid the `ExpressionChangedAfterItHasBeenCheckedError`.
        if (this.hasExpandButton === null) {
            return this.hasExpandButton;
        }
        return this.canExpand();
    }
    toggleSnippetExpansion() {
        this.expanded = !this.expanded;
    }
    /**
     * Copies the code from the `<code>` block to clipboard.
     *
     */
    copyCode() {
        // create invisible, uneditable textarea with our code in it
        const textarea = document.createElement("textarea");
        textarea.value = this.code.nativeElement.innerText || this.code.nativeElement.textContent;
        textarea.setAttribute("readonly", "");
        textarea.style.position = "absolute";
        textarea.style.right = "-99999px";
        document.body.appendChild(textarea);
        // save user selection
        const selected = document.getSelection().rangeCount ? document.getSelection().getRangeAt(0) : null;
        // copy to clipboard
        textarea.select();
        document.execCommand("copy");
        // remove textarea
        document.body.removeChild(textarea);
        // restore user selection
        if (selected) {
            document.getSelection().removeAllRanges();
            document.getSelection().addRange(selected);
        }
    }
    onCopyButtonClicked() {
        this.copyCode();
        this.showFeedback = true;
        setTimeout(() => {
            this.showFeedback = false;
        }, this.feedbackTimeout);
    }
    ngAfterViewInit() {
        setTimeout(() => {
            if (this.canExpand()) {
                this.hasExpandButton = true;
            }
            else {
                this.hasExpandButton = false;
            }
        });
    }
    /**
     * Inline code snippet acts as button and makes the whole component clickable.
     *
     * This handles clicks in that case.
     */
    hostClick() {
        if (this.display !== SnippetType.inline) {
            return;
        }
        this.onCopyButtonClicked();
    }
    canExpand() {
        return (this.code && this.code.nativeElement.getBoundingClientRect().height > 255) && this.display === "multi";
    }
}
/**
 * Variable used for creating unique ids for code-snippet components.
 */
CodeSnippet.codeSnippetCount = 0;
CodeSnippet.decorators = [
    { type: Component, args: [{
                selector: "ibm-code-snippet",
                template: `
		<ng-container *ngIf="display === 'inline'; else notInline">
			<ng-container *ngTemplateOutlet="codeTemplate"></ng-container>
			<ng-container *ngTemplateOutlet="feedbackTemplate"></ng-container>
		</ng-container>

		<ng-template #notInline>
			<div class="bx--snippet-container" [attr.aria-label]="translations.CODE_SNIPPET_TEXT">
				<ng-container *ngIf="skeleton">
					<span *ngIf="display === 'single'; else multiSkeleton"></span>
					<ng-template #multiSkeleton>
						<span></span>
						<span></span>
						<span></span>
					</ng-template>
				</ng-container>
				<pre *ngIf="!skeleton"><ng-container *ngTemplateOutlet="codeTemplate"></ng-container></pre>
			</div>
			<button
				*ngIf="!skeleton"
				class="bx--snippet-button"
				[attr.aria-label]="translations.COPY_CODE"
				(click)="onCopyButtonClicked()"
				tabindex="0">
				<svg ibmIcon="copy" size="16" class="bx--snippet__icon"></svg>
				<ng-container *ngTemplateOutlet="feedbackTemplate"></ng-container>
			</button>
			<button
				*ngIf="shouldShowExpandButton"
				class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand"
				(click)="toggleSnippetExpansion()"
				type="button">
				<span class="bx--snippet-btn--text">{{expanded ? translations.SHOW_LESS : translations.SHOW_MORE}}</span>
				<svg ibmIcon="chevron--down" size="16" class="bx--icon-chevron--down" [ariaLabel]="translations.SHOW_MORE_ICON"></svg>
			</button>
		</ng-template>

		<ng-template #codeTemplate>
			<code #code><ng-content></ng-content></code>
		</ng-template>

		<ng-template #feedbackTemplate>
			<div
			class="bx--btn--copy__feedback"
			[ngClass]="{
				'bx--btn--copy__feedback--displayed': showFeedback
			}"
			[attr.data-feedback]="feedbackText">
			</div>
		</ng-template>
	`
            }] }
];
/** @nocollapse */
CodeSnippet.ctorParameters = () => [
    { type: I18n }
];
CodeSnippet.propDecorators = {
    display: [{ type: Input }],
    translations: [{ type: Input }],
    theme: [{ type: Input }],
    feedbackText: [{ type: Input }],
    feedbackTimeout: [{ type: Input }],
    expanded: [{ type: HostBinding, args: ["class.bx--snippet--expand",] }, { type: Input }],
    skeleton: [{ type: HostBinding, args: ["class.bx--skeleton",] }, { type: Input }],
    snippetClass: [{ type: HostBinding, args: ["class.bx--snippet",] }],
    snippetSingleClass: [{ type: HostBinding, args: ["class.bx--snippet--single",] }],
    snippetMultiClass: [{ type: HostBinding, args: ["class.bx--snippet--multi",] }],
    snippetInlineClass: [{ type: HostBinding, args: ["class.bx--snippet--inline",] }],
    snippetInlineLightClass: [{ type: HostBinding, args: ["class.bx--snippet--light",] }],
    btnCopyClass: [{ type: HostBinding, args: ["class.bx--btn--copy",] }],
    displayStyle: [{ type: HostBinding, args: ["style.display",] }],
    attrType: [{ type: HostBinding, args: ["attr.type",] }],
    code: [{ type: ViewChild, args: ["code", { static: false },] }],
    hostClick: [{ type: HostListener, args: ["click",] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS1zbmlwcGV0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvY29kZS1zbmlwcGV0LyIsInNvdXJjZXMiOlsiY29kZS1zbmlwcGV0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ04sU0FBUyxFQUNULEtBQUssRUFDTCxXQUFXLEVBQ1gsU0FBUyxFQUNULFlBQVksRUFFWixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFdEQsTUFBTSxDQUFOLElBQVksV0FJWDtBQUpELFdBQVksV0FBVztJQUN0QixnQ0FBaUIsQ0FBQTtJQUNqQiw4QkFBZSxDQUFBO0lBQ2YsZ0NBQWlCLENBQUE7QUFDbEIsQ0FBQyxFQUpXLFdBQVcsS0FBWCxXQUFXLFFBSXRCO0FBRUQ7Ozs7Ozs7O0dBUUc7QUF1REgsTUFBTSxPQUFPLFdBQVc7SUEwRXZCOztPQUVHO0lBQ0gsWUFBc0IsSUFBVTtRQUFWLFNBQUksR0FBSixJQUFJLENBQU07UUF2RWhDOzs7V0FHRztRQUNNLFlBQU8sR0FBZ0IsV0FBVyxDQUFDLE1BQU0sQ0FBQztRQUMxQyxpQkFBWSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDO1FBRXJEOztXQUVHO1FBQ00sVUFBSyxHQUFxQixNQUFNLENBQUM7UUFFMUM7OztXQUdHO1FBQ00saUJBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQztRQUVqRDs7O1dBR0c7UUFDTSxvQkFBZSxHQUFHLElBQUksQ0FBQztRQUVtQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFM0IsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFxQ3RELGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBRXJCLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FB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QUFLO3VCQUVMLFdBQVcsU0FBQywyQkFBMkIsY0FBRyxLQUFLO3VCQUMvQyxXQUFXLFNBQUMsb0JBQW9CLGNBQUcsS0FBSzsyQkFFeEMsV0FBVyxTQUFDLG1CQUFtQjtpQ0FDL0IsV0FBVyxTQUFDLDJCQUEyQjtnQ0FHdkMsV0FBVyxTQUFDLDBCQUEwQjtpQ0FHdEMsV0FBVyxTQUFDLDJCQUEyQjtzQ0FHdkMsV0FBVyxTQUFDLDBCQUEwQjsyQkFHdEMsV0FBVyxTQUFDLHFCQUFxQjsyQkFJakMsV0FBVyxTQUFDLGVBQWU7dUJBRzNCLFdBQVcsU0FBQyxXQUFXO21CQUt2QixTQUFTLFNBQUMsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTt3QkFrRm5DLFlBQVksU0FBQyxPQUFPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcblx0Q29tcG9uZW50LFxuXHRJbnB1dCxcblx0SG9zdEJpbmRpbmcsXG5cdFZpZXdDaGlsZCxcblx0SG9zdExpc3RlbmVyLFxuXHRBZnRlclZpZXdJbml0XG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5cbmltcG9ydCB7IEkxOG4gfSBmcm9tIFwiY2FyYm9uLWNvbXBvbmVudHMtYW5ndWxhci9pMThuXCI7XG5cbmV4cG9ydCBlbnVtIFNuaXBwZXRUeXBlIHtcblx0c2luZ2xlID0gXCJzaW5nbGVcIixcblx0bXVsdGkgPSBcIm11bHRpXCIsXG5cdGlubGluZSA9IFwiaW5saW5lXCJcbn1cblxuLyoqXG4gKiBbU2VlIGRlbW9dKC4uLy4uLz9wYXRoPS9zdG9yeS9jb2RlLXNuaXBwZXQtLWJhc2ljKVxuICpcbiAqIGBgYGh0bWxcbiAqIDxpYm0tY29kZS1zbmlwcGV0PkNvZGU8L2libS1jb2RlLXNuaXBwZXQ+XG4gKiBgYGBcbiAqXG4gKiA8ZXhhbXBsZS11cmw+Li4vLi4vaWZyYW1lLmh0bWw/aWQ9Y29kZS1zbmlwcGV0LS1iYXNpYzwvZXhhbXBsZS11cmw+XG4gKi9cbkBDb21wb25lbnQoe1xuXHRzZWxlY3RvcjogXCJpYm0tY29kZS1zbmlwcGV0XCIsXG5cdHRlbXBsYXRlOiBgXG5cdFx0PG5nLWNvbnRhaW5lciAqbmdJZj1cImRpc3BsYXkgPT09ICdpbmxpbmUnOyBlbHNlIG5vdElubGluZVwiPlxuXHRcdFx0PG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImNvZGVUZW1wbGF0ZVwiPjwvbmctY29udGFpbmVyPlxuXHRcdFx0PG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImZlZWRiYWNrVGVtcGxhdGVcIj48L25nLWNvbnRhaW5lcj5cblx0XHQ8L25nLWNvbnRhaW5lcj5cblxuXHRcdDxuZy10ZW1wbGF0ZSAjbm90SW5saW5lPlxuXHRcdFx0PGRpdiBjbGFzcz1cImJ4LS1zbmlwcGV0LWNvbnRhaW5lclwiIFthdHRyLmFyaWEtbGFiZWxdPVwidHJhbnNsYXRpb25zLkNPREVfU05JUFBFVF9URVhUXCI+XG5cdFx0XHRcdDxuZy1jb250YWluZXIgKm5nSWY9XCJza2VsZXRvblwiPlxuXHRcdFx0XHRcdDxzcGFuICpuZ0lmPVwiZGlzcGxheSA9PT0gJ3NpbmdsZSc7IGVsc2UgbXVsdGlTa2VsZXRvblwiPjwvc3Bhbj5cblx0XHRcdFx0XHQ8bmctdGVtcGxhdGUgI211bHRpU2tlbGV0b24+XG5cdFx0XHRcdFx0XHQ8c3Bhbj48L3NwYW4+XG5cdFx0XHRcdFx0XHQ8c3Bhbj48L3NwYW4+XG5cdFx0XHRcdFx0XHQ8c3Bhbj48L3NwYW4+XG5cdFx0XHRcdFx0PC9uZy10ZW1wbGF0ZT5cblx0XHRcdFx0PC9uZy1jb250YWluZXI+XG5cdFx0XHRcdDxwcmUgKm5nSWY9XCIhc2tlbGV0b25cIj48bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiY29kZVRlbXBsYXRlXCI+PC9uZy1jb250YWluZXI+PC9wcmU+XG5cdFx0XHQ8L2Rpdj5cblx0XHRcdDxidXR0b25cblx0XHRcdFx0Km5nSWY9XCIhc2tlbGV0b25cIlxuXHRcdFx0XHRjbGFzcz1cImJ4LS1zbmlwcGV0LWJ1dHRvblwiXG5cdFx0XHRcdFthdHRyLmFyaWEtbGFiZWxdPVwidHJhbnNsYXRpb25zLkNPUFlfQ09ERVwiXG5cdFx0XHRcdChjbGljayk9XCJvbkNvcHlCdXR0b25DbGlja2VkKClcIlxuXHRcdFx0XHR0YWJpbmRleD1cIjBcIj5cblx0XHRcdFx0PHN2ZyBpYm1JY29uPVwiY29weVwiIHNpemU9XCIxNlwiIGNsYXNzPVwiYngtLXNuaXBwZXRfX2ljb25cIj48L3N2Zz5cblx0XHRcdFx0PG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImZlZWRiYWNrVGVtcGxhdGVcIj48L25nLWNvbnRhaW5lcj5cblx0XHRcdDwvYnV0dG9uPlxuXHRcdFx0PGJ1dHRvblxuXHRcdFx0XHQqbmdJZj1cInNob3VsZFNob3dFeHBhbmRCdXR0b25cIlxuXHRcdFx0XHRjbGFzcz1cImJ4LS1idG4gYngtLWJ0bi0tZ2hvc3QgYngtLWJ0bi0tc20gYngtLXNuaXBwZXQtYnRuLS1leHBhbmRcIlxuXHRcdFx0XHQoY2xpY2spPVwidG9nZ2xlU25pcHBldEV4cGFuc2lvbigpXCJcblx0XHRcdFx0dHlwZT1cImJ1dHRvblwiPlxuXHRcdFx0XHQ8c3BhbiBjbGFzcz1cImJ4LS1zbmlwcGV0LWJ0bi0tdGV4dFwiPnt7ZXhwYW5kZWQgPyB0cmFuc2xhdGlvbnMuU0hPV19MRVNTIDogdHJhbnNsYXRpb25zLlNIT1dfTU9SRX19PC9zcGFuPlxuXHRcdFx0XHQ8c3ZnIGlibUljb249XCJjaGV2cm9uLS1kb3duXCIgc2l6ZT1cIjE2XCIgY2xhc3M9XCJieC0taWNvbi1jaGV2cm9uLS1kb3duXCIgW2FyaWFMYWJlbF09XCJ0cmFuc2xhdGlvbnMuU0hPV19NT1JFX0lDT05cIj48L3N2Zz5cblx0XHRcdDwvYnV0dG9uPlxuXHRcdDwvbmctdGVtcGxhdGU+XG5cblx0XHQ8bmctdGVtcGxhdGUgI2NvZGVUZW1wbGF0ZT5cblx0XHRcdDxjb2RlICNjb2RlPjxuZy1jb250ZW50PjwvbmctY29udGVudD48L2NvZGU+XG5cdFx0PC9uZy10ZW1wbGF0ZT5cblxuXHRcdDxuZy10ZW1wbGF0ZSAjZmVlZGJhY2tUZW1wbGF0ZT5cblx0XHRcdDxkaXZcblx0XHRcdGNsYXNzPVwiYngtLWJ0bi0tY29weV9fZmVlZGJhY2tcIlxuXHRcdFx0W25nQ2xhc3NdPVwie1xuXHRcdFx0XHQnYngtLWJ0bi0tY29weV9fZmVlZGJhY2stLWRpc3BsYXllZCc6IHNob3dGZWVkYmFja1xuXHRcdFx0fVwiXG5cdFx0XHRbYXR0ci5kYXRhLWZlZWRiYWNrXT1cImZlZWRiYWNrVGV4dFwiPlxuXHRcdFx0PC9kaXY+XG5cdFx0PC9uZy10ZW1wbGF0ZT5cblx0YFxufSlcbmV4cG9ydCBjbGFzcyBDb2RlU25pcHBldCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuXHQvKipcblx0ICogVmFyaWFibGUgdXNlZCBmb3IgY3JlYXRpbmcgdW5pcXVlIGlkcyBmb3IgY29kZS1zbmlwcGV0IGNvbXBvbmVudHMuXG5cdCAqL1xuXHRzdGF0aWMgY29kZVNuaXBwZXRDb3VudCA9IDA7XG5cblx0LyoqXG5cdCAqIEl0IGNhbiBiZSBgXCJzaW5nbGVcImAsIGBcIm11bHRpXCJgIG9yIGBcImlubGluZVwiYFxuXHQgKlxuXHQgKi9cblx0QElucHV0KCkgZGlzcGxheTogU25pcHBldFR5cGUgPSBTbmlwcGV0VHlwZS5zaW5nbGU7XG5cdEBJbnB1dCgpIHRyYW5zbGF0aW9ucyA9IHRoaXMuaTE4bi5nZXQoKS5DT0RFX1NOSVBQRVQ7XG5cblx0LyoqXG5cdCAqIFNldCB0byBgXCJsaWdodFwiYCB0byBhcHBseSB0aGUgbGlnaHQgc3R5bGUgb24gdGhlIGNvZGUgc25pcHBldC5cblx0ICovXG5cdEBJbnB1dCgpIHRoZW1lOiBcImxpZ2h0XCIgfCBcImRhcmtcIiA9IFwiZGFya1wiO1xuXG5cdC8qKlxuXHQgKiBUZXh0IGRpc3BsYXllZCBpbiB0aGUgdG9vbHRpcCB3aGVuIHVzZXIgY2xpY2tzIGJ1dHRvbiB0byBjb3B5IGNvZGUuXG5cdCAqXG5cdCAqL1xuXHRASW5wdXQoKSBmZWVkYmFja1RleHQgPSB0aGlzLnRyYW5zbGF0aW9ucy5DT1BJRUQ7XG5cblx0LyoqXG5cdCAqIFRpbWUgaW4gbWlsaXNlY29uZHMgdG8ga2VlcCB0aGUgZmVlZGJhY2sgdG9vbHRpcCBkaXNwbGF5ZWQuXG5cdCAqXG5cdCAqL1xuXHRASW5wdXQoKSBmZWVkYmFja1RpbWVvdXQgPSAyMDAwO1xuXG5cdEBIb3N0QmluZGluZyhcImNsYXNzLmJ4LS1zbmlwcGV0LS1leHBhbmRcIikgQElucHV0KCkgZXhwYW5kZWQgPSBmYWxzZTtcblx0QEhvc3RCaW5kaW5nKFwiY2xhc3MuYngtLXNrZWxldG9uXCIpIEBJbnB1dCgpIHNrZWxldG9uID0gZmFsc2U7XG5cblx0QEhvc3RCaW5kaW5nKFwiY2xhc3MuYngtLXNuaXBwZXRcIikgc25pcHBldENsYXNzID0gdHJ1ZTtcblx0QEhvc3RCaW5kaW5nKFwiY2xhc3MuYngtLXNuaXBwZXQtLXNpbmdsZVwiKSBnZXQgc25pcHBldFNpbmdsZUNsYXNzKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXkgPT09IFNuaXBwZXRUeXBlLnNpbmdsZTtcblx0fVxuXHRASG9zdEJpbmRpbmcoXCJjbGFzcy5ieC0tc25pcHBldC0tbXVsdGlcIikgZ2V0IHNuaXBwZXRNdWx0aUNsYXNzKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXkgPT09IFNuaXBwZXRUeXBlLm11bHRpO1xuXHR9XG5cdEBIb3N0QmluZGluZyhcImNsYXNzLmJ4LS1zbmlwcGV0LS1pbmxpbmVcIikgZ2V0IHNuaXBwZXRJbmxpbmVDbGFzcygpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5ID09PSBTbmlwcGV0VHlwZS5pbmxpbmU7XG5cdH1cblx0QEhvc3RCaW5kaW5nKFwiY2xhc3MuYngtLXNuaXBwZXQtLWxpZ2h0XCIpIGdldCBzbmlwcGV0SW5saW5lTGlnaHRDbGFzcygpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5ID09PSBTbmlwcGV0VHlwZS5pbmxpbmUgJiYgdGhpcy50aGVtZSA9PT0gXCJsaWdodFwiO1xuXHR9XG5cdEBIb3N0QmluZGluZyhcImNsYXNzLmJ4LS1idG4tLWNvcHlcIikgZ2V0IGJ0bkNvcHlDbGFzcygpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5ID09PSBTbmlwcGV0VHlwZS5pbmxpbmU7XG5cdH1cblxuXHRASG9zdEJpbmRpbmcoXCJzdHlsZS5kaXNwbGF5XCIpIGdldCBkaXNwbGF5U3R5bGUoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheSAhPT0gU25pcHBldFR5cGUuaW5saW5lID8gXCJibG9ja1wiIDogbnVsbDtcblx0fVxuXHRASG9zdEJpbmRpbmcoXCJhdHRyLnR5cGVcIikgZ2V0IGF0dHJUeXBlKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXkgPT09IFNuaXBwZXRUeXBlLmlubGluZSA/IFwiYnV0dG9uXCIgOiBudWxsO1xuXHR9XG5cblx0Ly8gQHRzLWlnbm9yZVxuXHRAVmlld0NoaWxkKFwiY29kZVwiLCB7IHN0YXRpYzogZmFsc2UgfSkgY29kZTtcblxuXHRnZXQgc2hvdWxkU2hvd0V4cGFuZEJ1dHRvbigpIHtcblx0XHQvLyBDaGVja3MgaWYgYGhhc0V4cGFuZGAgYnV0dG9uIGhhcyBiZWVuIGluaXRpYWxpemVkIGluIGBBZnRlclZpZXdJbml0YCBiZWZvcmUgZGV0ZWN0aW5nIHdoZXRoZXIgb3Igbm90IHRvXG5cdFx0Ly8gc2hvdyB0aGUgZXhwYW5kIGJ1dHRvbiB3aGVuIHRoZSBjb2RlIGRpc3BsYXllZCBpbiB0aGUgY29tcG9uZW50IGNoYW5nZXMgZHVyaW5nIHRoZSBsaWZlIG9mIHRoZSBjb21wb25lbnQuXG5cdFx0Ly8gVGhpcyBpcyB0byBhdm9pZCB0aGUgYEV4cHJlc3Npb25DaGFuZ2VkQWZ0ZXJJdEhhc0JlZW5DaGVja2VkRXJyb3JgLlxuXHRcdGlmICh0aGlzLmhhc0V4cGFuZEJ1dHRvbiA9PT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuaGFzRXhwYW5kQnV0dG9uO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5jYW5FeHBhbmQoKTtcblx0fVxuXG5cdHNob3dGZWVkYmFjayA9IGZhbHNlO1xuXG5cdGhhc0V4cGFuZEJ1dHRvbiA9IG51bGw7XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgQ29kZVNuaXBwZXQuXG5cdCAqL1xuXHRjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaTE4bjogSTE4bikge1xuXHRcdENvZGVTbmlwcGV0LmNvZGVTbmlwcGV0Q291bnQrKztcblx0fVxuXG5cdHRvZ2dsZVNuaXBwZXRFeHBhbnNpb24oKSB7XG5cdFx0dGhpcy5leHBhbmRlZCA9ICF0aGlzLmV4cGFuZGVkO1xuXHR9XG5cblx0LyoqXG5cdCAqIENvcGllcyB0aGUgY29kZSBmcm9tIHRoZSBgPGNvZGU+YCBibG9jayB0byBjbGlwYm9hcmQuXG5cdCAqXG5cdCAqL1xuXHRjb3B5Q29kZSgpIHtcblx0XHQvLyBjcmVhdGUgaW52aXNpYmxlLCB1bmVkaXRhYmxlIHRleHRhcmVhIHdpdGggb3VyIGNvZGUgaW4gaXRcblx0XHRjb25zdCB0ZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZXh0YXJlYVwiKTtcblx0XHR0ZXh0YXJlYS52YWx1ZSA9IHRoaXMuY29kZS5uYXRpdmVFbGVtZW50LmlubmVyVGV4dCB8fCB0aGlzLmNvZGUubmF0aXZlRWxlbWVudC50ZXh0Q29udGVudDtcblx0XHR0ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoXCJyZWFkb25seVwiLCBcIlwiKTtcblx0XHR0ZXh0YXJlYS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblx0XHR0ZXh0YXJlYS5zdHlsZS5yaWdodCA9IFwiLTk5OTk5cHhcIjtcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRleHRhcmVhKTtcblxuXHRcdC8vIHNhdmUgdXNlciBzZWxlY3Rpb25cblx0XHRjb25zdCBzZWxlY3RlZCA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpLnJhbmdlQ291bnQgPyBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKS5nZXRSYW5nZUF0KDApIDogbnVsbDtcblxuXHRcdC8vIGNvcHkgdG8gY2xpcGJvYXJkXG5cdFx0dGV4dGFyZWEuc2VsZWN0KCk7XG5cdFx0ZG9jdW1lbnQuZXhlY0NvbW1hbmQoXCJjb3B5XCIpO1xuXG5cdFx0Ly8gcmVtb3ZlIHRleHRhcmVhXG5cdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXh0YXJlYSk7XG5cblx0XHQvLyByZXN0b3JlIHVzZXIgc2VsZWN0aW9uXG5cdFx0aWYgKHNlbGVjdGVkKSB7XG5cdFx0XHRkb2N1bWVudC5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcblx0XHRcdGRvY3VtZW50LmdldFNlbGVjdGlvbigpLmFkZFJhbmdlKHNlbGVjdGVkKTtcblx0XHR9XG5cdH1cblxuXHRvbkNvcHlCdXR0b25DbGlja2VkKCkge1xuXHRcdHRoaXMuY29weUNvZGUoKTtcblxuXHRcdHRoaXMuc2hvd0ZlZWRiYWNrID0gdHJ1ZTtcblxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0dGhpcy5zaG93RmVlZGJhY2sgPSBmYWxzZTtcblx0XHR9LCB0aGlzLmZlZWRiYWNrVGltZW91dCk7XG5cdH1cblxuXHRuZ0FmdGVyVmlld0luaXQoKSB7XG5cdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRpZiAodGhpcy5jYW5FeHBhbmQoKSkge1xuXHRcdFx0XHR0aGlzLmhhc0V4cGFuZEJ1dHRvbiA9IHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmhhc0V4cGFuZEJ1dHRvbiA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIElubGluZSBjb2RlIHNuaXBwZXQgYWN0cyBhcyBidXR0b24gYW5kIG1ha2VzIHRoZSB3aG9sZSBjb21wb25lbnQgY2xpY2thYmxlLlxuXHQgKlxuXHQgKiBUaGlzIGhhbmRsZXMgY2xpY2tzIGluIHRoYXQgY2FzZS5cblx0ICovXG5cdEBIb3N0TGlzdGVuZXIoXCJjbGlja1wiKVxuXHRob3N0Q2xpY2soKSB7XG5cdFx0aWYgKHRoaXMuZGlzcGxheSAhPT0gU25pcHBldFR5cGUuaW5saW5lKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0dGhpcy5vbkNvcHlCdXR0b25DbGlja2VkKCk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgY2FuRXhwYW5kKCkge1xuXHRcdHJldHVybiAodGhpcy5jb2RlICYmIHRoaXMuY29kZS5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCA+IDI1NSkgJiYgdGhpcy5kaXNwbGF5ID09PSBcIm11bHRpXCI7XG5cdH1cbn1cbiJdfQ==