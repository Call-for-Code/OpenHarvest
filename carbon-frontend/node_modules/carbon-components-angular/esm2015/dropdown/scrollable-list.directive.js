/**
 *
 * carbon-angular v0.0.0 | scrollable-list.directive.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Input, Directive, ElementRef, HostListener } from "@angular/core";
export class ScrollableList {
    constructor(elementRef) {
        this.elementRef = elementRef;
        /**
         * Optional target list to scroll
         */
        this.nScrollableList = null;
        /**
         * Enables or disables scrolling for the whole directive
         */
        this.scrollEnabled = true;
        /**
         * How many lines to scroll by each time `wheel` fires
         * Defaults to 10 - based on testing this isn't too fast or slow on any platform
         */
        this.scrollBy = 10;
        this.canScrollUp = false;
        this.canScrollDown = false;
        this.list = this.elementRef.nativeElement;
    }
    ngOnChanges(changes) {
        if (changes.scrollEnabled) {
            if (changes.scrollEnabled.currentValue) {
                this.list.style.overflow = "hidden";
                this.scrollUpTarget.style.display = "flex";
                this.scrollDownTarget.style.display = "flex";
                this.canScrollUp = true;
                this.canScrollDown = true;
                this.updateScrollHeight();
                this.checkScrollArrows();
                setTimeout(() => {
                    this.checkScrollArrows();
                });
            }
            else {
                this.scrollUpTarget.style.display = "none";
                this.scrollDownTarget.style.display = "none";
                this.canScrollUp = false;
                this.canScrollDown = false;
                this.list.style.height = null;
                this.list.style.overflow = null;
                clearInterval(this.hoverScrollInterval);
            }
        }
    }
    ngAfterViewInit() {
        if (this.nScrollableList) {
            this.list = this.elementRef.nativeElement.querySelector(this.nScrollableList);
        }
        this.scrollUpTarget.addEventListener("mouseover", () => this.onHoverUp(true));
        this.scrollUpTarget.addEventListener("mouseout", () => this.onHoverUp(false));
        this.scrollDownTarget.addEventListener("mouseover", () => this.onHoverDown(true));
        this.scrollDownTarget.addEventListener("mouseout", () => this.onHoverDown(false));
    }
    updateScrollHeight() {
        if (this.scrollEnabled) {
            const container = this.elementRef.nativeElement.parentElement;
            const containerRect = container.getBoundingClientRect();
            const innerHeightDiff = this.list.getBoundingClientRect().top - containerRect.top;
            const outerHeightDiff = containerRect.height - (containerRect.bottom - window.innerHeight);
            // 40 gives us some padding between the bottom of the list,
            // the bottom of the window, and the scroll down button
            const height = outerHeightDiff - innerHeightDiff - 40;
            this.list.style.height = `${height}px`;
        }
    }
    checkScrollArrows() {
        const scrollUpHeight = this.scrollUpTarget.offsetHeight;
        const scrollDownHeight = this.scrollDownTarget.offsetHeight;
        if (this.list.scrollTop === 0) {
            if (this.canScrollUp) {
                this.list.style.height = `${parseInt(this.list.style.height, 10) + scrollUpHeight}px`;
            }
            this.scrollUpTarget.style.display = "none";
            this.canScrollUp = false;
        }
        else if (this.list.scrollTop === this.list.scrollTopMax) {
            if (this.canScrollDown) {
                this.list.style.height = `${parseInt(this.list.style.height, 10) + scrollDownHeight}px`;
            }
            this.scrollDownTarget.style.display = "none";
            this.canScrollDown = false;
        }
        else {
            if (!this.canScrollUp) {
                this.list.style.height = `${parseInt(this.list.style.height, 10) - scrollUpHeight}px`;
            }
            if (!this.canScrollDown) {
                this.list.style.height = `${parseInt(this.list.style.height, 10) - scrollDownHeight}px`;
            }
            this.scrollUpTarget.style.display = "flex";
            this.scrollDownTarget.style.display = "flex";
            this.canScrollUp = true;
            this.canScrollDown = true;
        }
    }
    onWheel(event) {
        if (event.deltaY < 0) {
            this.list.scrollTop -= this.scrollBy;
        }
        else {
            this.list.scrollTop += this.scrollBy;
        }
        // only prevent the parent/window from scrolling if we can scroll
        if (!(this.list.scrollTop === this.list.scrollTopMax || this.list.scrollTop === 0)) {
            event.preventDefault();
            event.stopPropagation();
        }
        this.checkScrollArrows();
    }
    onTouchStart(event) {
        if (event.touches[0]) {
            this.lastTouch = event.touches[0].clientY;
        }
    }
    onTouchMove(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.touches[0]) {
            const touch = event.touches[0];
            this.list.scrollTop += this.lastTouch - touch.clientY;
            this.lastTouch = touch.clientY;
            this.checkScrollArrows();
        }
    }
    hoverScrollBy(hovering, amount) {
        if (hovering) {
            this.hoverScrollInterval = setInterval(() => {
                this.list.scrollTop += amount;
                this.checkScrollArrows();
            }, 1);
        }
        else {
            clearInterval(this.hoverScrollInterval);
        }
    }
    onHoverUp(hovering) {
        // how many px/lines to scroll by on hover
        // 3 is just a random number that felt good
        // 1 and 2 are too slow, 4 works but it might be a tad fast
        this.hoverScrollBy(hovering, -3);
    }
    onHoverDown(hovering) {
        this.hoverScrollBy(hovering, 3);
    }
    onKeyDown(event) {
        if (event.key === "ArrowDown" || event.key === "ArrowUp") {
            this.checkScrollArrows();
        }
    }
}
ScrollableList.decorators = [
    { type: Directive, args: [{
                selector: "[ibmScrollableList]",
                exportAs: "scrollable-list"
            },] }
];
/** @nocollapse */
ScrollableList.ctorParameters = () => [
    { type: ElementRef }
];
ScrollableList.propDecorators = {
    nScrollableList: [{ type: Input }],
    scrollEnabled: [{ type: Input }],
    scrollUpTarget: [{ type: Input }],
    scrollDownTarget: [{ type: Input }],
    scrollBy: [{ type: Input }],
    onWheel: [{ type: HostListener, args: ["wheel", ["$event"],] }],
    onTouchStart: [{ type: HostListener, args: ["touchstart", ["$event"],] }],
    onTouchMove: [{ type: HostListener, args: ["touchmove", ["$event"],] }],
    onKeyDown: [{ type: HostListener, args: ["keydown", ["$event"],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsYWJsZS1saXN0LmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvZHJvcGRvd24vIiwic291cmNlcyI6WyJzY3JvbGxhYmxlLWxpc3QuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTixLQUFLLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBSVosTUFBTSxlQUFlLENBQUM7QUFNdkIsTUFBTSxPQUFPLGNBQWM7SUErQjFCLFlBQXNCLFVBQXNCO1FBQXRCLGVBQVUsR0FBVixVQUFVLENBQVk7UUE5QjVDOztXQUVHO1FBQ00sb0JBQWUsR0FBVyxJQUFJLENBQUM7UUFDeEM7O1dBRUc7UUFDTSxrQkFBYSxHQUFHLElBQUksQ0FBQztRQVM5Qjs7O1dBR0c7UUFDTSxhQUFRLEdBQUcsRUFBRSxDQUFDO1FBTWIsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFDcEIsa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFDdEIsU0FBSSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDO0lBRUEsQ0FBQztJQUVoRCxXQUFXLENBQUMsT0FBc0I7UUFDakMsSUFBSSxPQUFPLENBQUMsYUFBYSxFQUFFO1lBQzFCLElBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxZQUFZLEVBQUU7Z0JBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7Z0JBQzNDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztnQkFDN0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7Z0JBQ3hCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO2dCQUMxQixJQUFJLENBQUMsa0JBQWtCLEVB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QUMvQixRQUFRLEVBQUUsaUJBQWlCO2FBQzNCOzs7O1lBVkEsVUFBVTs7OzhCQWVULEtBQUs7NEJBSUwsS0FBSzs2QkFJTCxLQUFLOytCQUlMLEtBQUs7dUJBS0wsS0FBSztzQkF5RkwsWUFBWSxTQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQzsyQkFlaEMsWUFBWSxTQUFDLFlBQVksRUFBRSxDQUFDLFFBQVEsQ0FBQzswQkFPckMsWUFBWSxTQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQzt3QkFrQ3BDLFlBQVksU0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuXHRJbnB1dCxcblx0RGlyZWN0aXZlLFxuXHRFbGVtZW50UmVmLFxuXHRIb3N0TGlzdGVuZXIsXG5cdE9uQ2hhbmdlcyxcblx0U2ltcGxlQ2hhbmdlcyxcblx0QWZ0ZXJWaWV3SW5pdFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5ARGlyZWN0aXZlKHtcblx0c2VsZWN0b3I6IFwiW2libVNjcm9sbGFibGVMaXN0XVwiLFxuXHRleHBvcnRBczogXCJzY3JvbGxhYmxlLWxpc3RcIlxufSlcbmV4cG9ydCBjbGFzcyBTY3JvbGxhYmxlTGlzdCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XG5cdC8qKlxuXHQgKiBPcHRpb25hbCB0YXJnZXQgbGlzdCB0byBzY3JvbGxcblx0ICovXG5cdEBJbnB1dCgpIG5TY3JvbGxhYmxlTGlzdDogc3RyaW5nID0gbnVsbDtcblx0LyoqXG5cdCAqIEVuYWJsZXMgb3IgZGlzYWJsZXMgc2Nyb2xsaW5nIGZvciB0aGUgd2hvbGUgZGlyZWN0aXZlXG5cdCAqL1xuXHRASW5wdXQoKSBzY3JvbGxFbmFibGVkID0gdHJ1ZTtcblx0LyoqXG5cdCAqIFNldHMgdGhlIHRhcmdldCB1c2VkIGZvciBob3ZlciBzY3JvbGxpbmcgdXBcblx0ICovXG5cdEBJbnB1dCgpIHNjcm9sbFVwVGFyZ2V0OiBIVE1MRWxlbWVudDtcblx0LyoqXG5cdCAqIFNldHMgdGhlIHRhcmdldCB1c2VkIGZvciBob3ZlciBzY3JvbGxpbmcgZG93blxuXHQgKi9cblx0QElucHV0KCkgc2Nyb2xsRG93blRhcmdldDogSFRNTEVsZW1lbnQ7XG5cdC8qKlxuXHQgKiBIb3cgbWFueSBsaW5lcyB0byBzY3JvbGwgYnkgZWFjaCB0aW1lIGB3aGVlbGAgZmlyZXNcblx0ICogRGVmYXVsdHMgdG8gMTAgLSBiYXNlZCBvbiB0ZXN0aW5nIHRoaXMgaXNuJ3QgdG9vIGZhc3Qgb3Igc2xvdyBvbiBhbnkgcGxhdGZvcm1cblx0ICovXG5cdEBJbnB1dCgpIHNjcm9sbEJ5ID0gMTA7XG5cblx0Ly8ga2VlcHMgdHJhY2sgb2YgdGhlIHNldEludGVydmFsIGZvciBob3ZlciBzY3JvbGxpbmdcblx0cHJvdGVjdGVkIGhvdmVyU2Nyb2xsSW50ZXJ2YWw7XG5cdC8vIHRyYWNrcyB0aGUgbGFzdCB0b3VjaCBldmVudFxuXHRwcm90ZWN0ZWQgbGFzdFRvdWNoO1xuXHRwcm90ZWN0ZWQgY2FuU2Nyb2xsVXAgPSBmYWxzZTtcblx0cHJvdGVjdGVkIGNhblNjcm9sbERvd24gPSBmYWxzZTtcblx0cHJvdGVjdGVkIGxpc3QgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcblxuXHRjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgZWxlbWVudFJlZjogRWxlbWVudFJlZikge31cblxuXHRuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG5cdFx0aWYgKGNoYW5nZXMuc2Nyb2xsRW5hYmxlZCkge1xuXHRcdFx0aWYgKGNoYW5nZXMuc2Nyb2xsRW5hYmxlZC5jdXJyZW50VmFsdWUpIHtcblx0XHRcdFx0dGhpcy5saXN0LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblx0XHRcdFx0dGhpcy5zY3JvbGxVcFRhcmdldC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cdFx0XHRcdHRoaXMuc2Nyb2xsRG93blRhcmdldC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cdFx0XHRcdHRoaXMuY2FuU2Nyb2xsVXAgPSB0cnVlO1xuXHRcdFx0XHR0aGlzLmNhblNjcm9sbERvd24gPSB0cnVlO1xuXHRcdFx0XHR0aGlzLnVwZGF0ZVNjcm9sbEhlaWdodCgpO1xuXHRcdFx0XHR0aGlzLmNoZWNrU2Nyb2xsQXJyb3dzKCk7XG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMuY2hlY2tTY3JvbGxBcnJvd3MoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnNjcm9sbFVwVGFyZ2V0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblx0XHRcdFx0dGhpcy5zY3JvbGxEb3duVGFyZ2V0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblx0XHRcdFx0dGhpcy5jYW5TY3JvbGxVcCA9IGZhbHNlO1xuXHRcdFx0XHR0aGlzLmNhblNjcm9sbERvd24gPSBmYWxzZTtcblx0XHRcdFx0dGhpcy5saXN0LnN0eWxlLmhlaWdodCA9IG51bGw7XG5cdFx0XHRcdHRoaXMubGlzdC5zdHlsZS5vdmVyZmxvdyA9IG51bGw7XG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwodGhpcy5ob3ZlclNjcm9sbEludGVydmFsKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRuZ0FmdGVyVmlld0luaXQoKSB7XG5cdFx0aWYgKHRoaXMublNjcm9sbGFibGVMaXN0KSB7XG5cdFx0XHR0aGlzLmxpc3QgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKHRoaXMublNjcm9sbGFibGVMaXN0KTtcblx0XHR9XG5cdFx0dGhpcy5zY3JvbGxVcFRhcmdldC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsICgpID0+IHRoaXMub25Ib3ZlclVwKHRydWUpKTtcblx0XHR0aGlzLnNjcm9sbFVwVGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCAoKSA9PiB0aGlzLm9uSG92ZXJVcChmYWxzZSkpO1xuXHRcdHRoaXMuc2Nyb2xsRG93blRhcmdldC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsICgpID0+IHRoaXMub25Ib3ZlckRvd24odHJ1ZSkpO1xuXHRcdHRoaXMuc2Nyb2xsRG93blRhcmdldC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgKCkgPT4gdGhpcy5vbkhvdmVyRG93bihmYWxzZSkpO1xuXHR9XG5cblx0cHVibGljIHVwZGF0ZVNjcm9sbEhlaWdodCgpIHtcblx0XHRpZiAodGhpcy5zY3JvbGxFbmFibGVkKSB7XG5cdFx0XHRjb25zdCBjb250YWluZXIgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50O1xuXHRcdFx0Y29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblx0XHRcdGNvbnN0IGlubmVySGVpZ2h0RGlmZiA9IHRoaXMubGlzdC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgLSBjb250YWluZXJSZWN0LnRvcDtcblx0XHRcdGNvbnN0IG91dGVySGVpZ2h0RGlmZiA9IGNvbnRhaW5lclJlY3QuaGVpZ2h0IC0gKGNvbnRhaW5lclJlY3QuYm90dG9tIC0gd2luZG93LmlubmVySGVpZ2h0KTtcblx0XHRcdC8vIDQwIGdpdmVzIHVzIHNvbWUgcGFkZGluZyBiZXR3ZWVuIHRoZSBib3R0b20gb2YgdGhlIGxpc3QsXG5cdFx0XHQvLyB0aGUgYm90dG9tIG9mIHRoZSB3aW5kb3csIGFuZCB0aGUgc2Nyb2xsIGRvd24gYnV0dG9uXG5cdFx0XHRjb25zdCBoZWlnaHQgPSBvdXRlckhlaWdodERpZmYgLSBpbm5lckhlaWdodERpZmYgLSA0MDtcblx0XHRcdHRoaXMubGlzdC5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHR9cHhgO1xuXHRcdH1cblx0fVxuXG5cdHByb3RlY3RlZCBjaGVja1Njcm9sbEFycm93cygpIHtcblx0XHRjb25zdCBzY3JvbGxVcEhlaWdodCA9IHRoaXMuc2Nyb2xsVXBUYXJnZXQub2Zmc2V0SGVpZ2h0O1xuXHRcdGNvbnN0IHNjcm9sbERvd25IZWlnaHQgPSB0aGlzLnNjcm9sbERvd25UYXJnZXQub2Zmc2V0SGVpZ2h0O1xuXHRcdGlmICh0aGlzLmxpc3Quc2Nyb2xsVG9wID09PSAwKSB7XG5cdFx0XHRpZiAodGhpcy5jYW5TY3JvbGxVcCkge1xuXHRcdFx0XHR0aGlzLmxpc3Quc3R5bGUuaGVpZ2h0ID0gYCR7cGFyc2VJbnQodGhpcy5saXN0LnN0eWxlLmhlaWdodCwgMTApICsgc2Nyb2xsVXBIZWlnaHR9cHhgO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5zY3JvbGxVcFRhcmdldC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cdFx0XHR0aGlzLmNhblNjcm9sbFVwID0gZmFsc2U7XG5cdFx0fSBlbHNlIGlmICh0aGlzLmxpc3Quc2Nyb2xsVG9wID09PSB0aGlzLmxpc3Quc2Nyb2xsVG9wTWF4KSB7XG5cdFx0XHRpZiAodGhpcy5jYW5TY3JvbGxEb3duKSB7XG5cdFx0XHRcdHRoaXMubGlzdC5zdHlsZS5oZWlnaHQgPSBgJHtwYXJzZUludCh0aGlzLmxpc3Quc3R5bGUuaGVpZ2h0LCAxMCkgKyBzY3JvbGxEb3duSGVpZ2h0fXB4YDtcblx0XHRcdH1cblx0XHRcdHRoaXMuc2Nyb2xsRG93blRhcmdldC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cdFx0XHR0aGlzLmNhblNjcm9sbERvd24gPSBmYWxzZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKCF0aGlzLmNhblNjcm9sbFVwKSB7XG5cdFx0XHRcdHRoaXMubGlzdC5zdHlsZS5oZWlnaHQgPSBgJHtwYXJzZUludCh0aGlzLmxpc3Quc3R5bGUuaGVpZ2h0LCAxMCkgLSBzY3JvbGxVcEhlaWdodH1weGA7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIXRoaXMuY2FuU2Nyb2xsRG93bikge1xuXHRcdFx0XHR0aGlzLmxpc3Quc3R5bGUuaGVpZ2h0ID0gYCR7cGFyc2VJbnQodGhpcy5saXN0LnN0eWxlLmhlaWdodCwgMTApIC0gc2Nyb2xsRG93bkhlaWdodH1weGA7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnNjcm9sbFVwVGFyZ2V0LnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblx0XHRcdHRoaXMuc2Nyb2xsRG93blRhcmdldC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cdFx0XHR0aGlzLmNhblNjcm9sbFVwID0gdHJ1ZTtcblx0XHRcdHRoaXMuY2FuU2Nyb2xsRG93biA9IHRydWU7XG5cdFx0fVxuXHR9XG5cblx0QEhvc3RMaXN0ZW5lcihcIndoZWVsXCIsIFtcIiRldmVudFwiXSlcblx0cHJvdGVjdGVkIG9uV2hlZWwoZXZlbnQpIHtcblx0XHRpZiAoZXZlbnQuZGVsdGFZIDwgMCkge1xuXHRcdFx0dGhpcy5saXN0LnNjcm9sbFRvcCAtPSB0aGlzLnNjcm9sbEJ5O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmxpc3Quc2Nyb2xsVG9wICs9IHRoaXMuc2Nyb2xsQnk7XG5cdFx0fVxuXHRcdC8vIG9ubHkgcHJldmVudCB0aGUgcGFyZW50L3dpbmRvdyBmcm9tIHNjcm9sbGluZyBpZiB3ZSBjYW4gc2Nyb2xsXG5cdFx0aWYgKCEodGhpcy5saXN0LnNjcm9sbFRvcCA9PT0gdGhpcy5saXN0LnNjcm9sbFRvcE1heCB8fCB0aGlzLmxpc3Quc2Nyb2xsVG9wID09PSAwKSkge1xuXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdH1cblx0XHR0aGlzLmNoZWNrU2Nyb2xsQXJyb3dzKCk7XG5cdH1cblxuXHRASG9zdExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBbXCIkZXZlbnRcIl0pXG5cdHByb3RlY3RlZCBvblRvdWNoU3RhcnQoZXZlbnQpIHtcblx0XHRpZiAoZXZlbnQudG91Y2hlc1swXSkge1xuXHRcdFx0dGhpcy5sYXN0VG91Y2ggPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFk7XG5cdFx0fVxuXHR9XG5cblx0QEhvc3RMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBbXCIkZXZlbnRcIl0pXG5cdHByb3RlY3RlZCBvblRvdWNoTW92ZShldmVudCkge1xuXHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0aWYgKGV2ZW50LnRvdWNoZXNbMF0pIHtcblx0XHRcdGNvbnN0IHRvdWNoID0gZXZlbnQudG91Y2hlc1swXTtcblx0XHRcdHRoaXMubGlzdC5zY3JvbGxUb3AgKz0gdGhpcy5sYXN0VG91Y2ggLSB0b3VjaC5jbGllbnRZO1xuXHRcdFx0dGhpcy5sYXN0VG91Y2ggPSB0b3VjaC5jbGllbnRZO1xuXHRcdFx0dGhpcy5jaGVja1Njcm9sbEFycm93cygpO1xuXHRcdH1cblx0fVxuXG5cdHByb3RlY3RlZCBob3ZlclNjcm9sbEJ5KGhvdmVyaW5nLCBhbW91bnQpIHtcblx0XHRpZiAoaG92ZXJpbmcpIHtcblx0XHRcdHRoaXMuaG92ZXJTY3JvbGxJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdFx0dGhpcy5saXN0LnNjcm9sbFRvcCArPSBhbW91bnQ7XG5cdFx0XHRcdHRoaXMuY2hlY2tTY3JvbGxBcnJvd3MoKTtcblx0XHRcdH0sIDEpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjbGVhckludGVydmFsKHRoaXMuaG92ZXJTY3JvbGxJbnRlcnZhbCk7XG5cdFx0fVxuXHR9XG5cblx0cHJvdGVjdGVkIG9uSG92ZXJVcChob3ZlcmluZykge1xuXHRcdC8vIGhvdyBtYW55IHB4L2xpbmVzIHRvIHNjcm9sbCBieSBvbiBob3ZlclxuXHRcdC8vIDMgaXMganVzdCBhIHJhbmRvbSBudW1iZXIgdGhhdCBmZWx0IGdvb2Rcblx0XHQvLyAxIGFuZCAyIGFyZSB0b28gc2xvdywgNCB3b3JrcyBidXQgaXQgbWlnaHQgYmUgYSB0YWQgZmFzdFxuXHRcdHRoaXMuaG92ZXJTY3JvbGxCeShob3ZlcmluZywgLTMpO1xuXHR9XG5cblx0cHJvdGVjdGVkIG9uSG92ZXJEb3duKGhvdmVyaW5nKSB7XG5cdFx0dGhpcy5ob3ZlclNjcm9sbEJ5KGhvdmVyaW5nLCAzKTtcblx0fVxuXG5cdEBIb3N0TGlzdGVuZXIoXCJrZXlkb3duXCIsIFtcIiRldmVudFwiXSlcblx0cHJvdGVjdGVkIG9uS2V5RG93bihldmVudCkge1xuXHRcdGlmIChldmVudC5rZXkgPT09IFwiQXJyb3dEb3duXCIgfHwgZXZlbnQua2V5ID09PSBcIkFycm93VXBcIikge1xuXHRcdFx0dGhpcy5jaGVja1Njcm9sbEFycm93cygpO1xuXHRcdH1cblx0fVxufVxuIl19