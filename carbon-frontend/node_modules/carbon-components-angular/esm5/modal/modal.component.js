/**
 *
 * carbon-angular v0.0.0 | modal.component.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { ModalService } from "./modal.service";
import { Component, EventEmitter, HostListener, Input, Output, ElementRef, ViewChild } from "@angular/core";
import { cycleTabs, getFocusElementList } from "carbon-components-angular/common";
/**
 * Component to create modals for presenting content.
 *
 * [See demo](../../?path=/story/modal--basic)
 *
 * Using a modal in your application requires `ibm-placeholder` which would generally be
 * placed near the end of your app component template (app.component.ts or app.component.html) as:
 *
```html
<ibm-placeholder></ibm-placeholder>
```
 *
 * A more complete example for `Modal` is given as follows:
 *
 * Example modal definition:
 *
```typescript
@Component({
    selector: "app-sample-modal",
    template: `
                <ibm-modal size="xl" (overlaySelected)="closeModal()">
                    <ibm-modal-header (closeSelect)="closeModal()">Header text</ibm-modal-header>
                        <section class="modal-body">
                            <h1>Sample modal works.</h1>
                            <button class="btn--icon-link" nPopover="Hello there" title="Popover title" placement="right" appendInline="true">
                                <svg ibmIcon="info" size="sm"></ibm-icon>
                            </button>
                            {{modalText}}
                        </section>
                    <ibm-modal-footer><button ibmButton="primary" (click)="closeModal()">Close</button></ibm-modal-footer>
                </ibm-modal>`,
    styleUrls: ["./sample-modal.component.scss"]
})
export class SampleModal extends BaseModal {
    modalText: string;
    constructor(protected injector: Injector) {
        super();
        this.modalText = this.injector.get("modalText");
    }
}
```
 *
 * Example of opening the modal:
 *
```typescript
@Component({
    selector: "app-modal-demo",
    template: `
                <button ibmButton="primary" (click)="openModal('drill')">Drill-down modal</button>
                <ibm-placeholder></ibm-placeholder>`
})
export class ModalDemo {
    openModal() {
        this.modalService.create({component: SampleModal, inputs: {modalText: "Hello universe."}});
    }
}
```
 *
 * <example-url>../../iframe.html?id=modal--basic</example-url>
 */
var Modal = /** @class */ (function () {
    /**
     * Creates an instance of `Modal`.
     */
    function Modal(modalService) {
        this.modalService = modalService;
        /**
         * Classification of the modal.
         */
        this.theme = "default";
        this.ariaLabel = "default";
        /**
         * Controls the visibility of the modal when used directly in a template
         */
        this.open = false;
        /**
         * Specify whether the modal contains scrolling content. This property overrides the automatic
         * detection of the existence of scrolling content. Set this property to `true` to force
         * overflow indicator to show up or to `false` to force overflow indicator to disappear.
         * It is set to `null` by default which indicates not to override automatic detection.
         */
        this.hasScrollingContent = null;
        /**
         * Emits event when click occurs within `n-overlay` element. This is to track click events occurring outside bounds of the `Modal` object.
         */
        this.overlaySelected = new EventEmitter();
        /**
         * To emit the closing event of the modal window.
         */
        this.close = new EventEmitter();
        /**
         * An element should have 'modal-primary-focus' as an attribute to receive initial focus within the `Modal` component.
         */
        this.selectorPrimaryFocus = "[modal-primary-focus]";
    }
    Object.defineProperty(Modal.prototype, "modalLabel", {
        get: function () {
            return this.ariaLabel;
        },
        /**
         * Label for the modal.
         *
         * @deprecated since v4
         */
        set: function (value) {
            this.ariaLabel = value;
        },
        enumerable: true,
        configurable: true
    });
    Modal.prototype.ngOnChanges = function (_a) {
        var _this = this;
        var open = _a.open;
        if (open) {
            if (open.currentValue) {
                // `100` is just enough time to allow the modal
                // to become visible, so that we can set focus
                setTimeout(function () { return _this.focusInitialElement(); }, 100);
            }
            else if (this.trigger) {
                this.trigger.focus();
            }
        }
    };
    /**
     * Set document focus to be on the modal component after it is initialized.
     */
    Modal.prototype.ngAfterViewInit = function () {
        this.focusInitialElement();
    };
    /**
     * Handle keyboard events to close modal and tab through the content within the modal.
     */
    Modal.prototype.handleKeyboardEvent = function (event) {
        switch (event.key) {
            case "Escape": {
                event.stopImmediatePropagation(); // prevents events being fired for multiple modals if more than 2 open
                this.modalService.destroy(); // destroy top (latest) modal
                this.close.emit();
                break;
            }
            case "Tab": {
                cycleTabs(event, this.modal.nativeElement);
                break;
            }
        }
    };
    Object.defineProperty(Modal.prototype, "shouldShowScrollbar", {
        /**
         * This detects whether or not the modal contains scrolling content.
         *
         * To force trigger a detection (ie. on window resize), change or reset the value of the modal content.
         *
         * Use the `hasScrollingContent` input to manually override the overflow indicator.
         */
        get: function () {
            var modalContent = this.modal ? this.modal.nativeElement.querySelector(".bx--modal-content") : null;
            if (modalContent) {
                var modalContentHeight = modalContent.getBoundingClientRect().height;
                var modalContentScrollHeight = modalContent.scrollHeight;
                return modalContentScrollHeight > modalContentHeight;
            }
            else {
                return false;
            }
        },
        enumerable: true,
        configurable: true
    });
    Modal.prototype.focusInitialElement = function () {
        var _this = this;
        var primaryFocusElement = this.modal.nativeElement.querySelector(this.selectorPrimaryFocus);
        if (primaryFocusElement && primaryFocusElement.focus) {
            setTimeout(function () { return primaryFocusElement.focus(); });
        }
        else if (getFocusElementList(this.modal.nativeElement).length > 0) {
            setTimeout(function () { return getFocusElementList(_this.modal.nativeElement)[0].focus(); });
        }
        else {
            setTimeout(function () { return _this.modal.nativeElement.focus(); });
        }
    };
    Modal.decorators = [
        { type: Component, args: [{
                    selector: "ibm-modal",
                    template: "\n\t\t<ibm-overlay\n\t\t\t[theme]=\"theme\"\n\t\t\t[open]=\"open\"\n\t\t\t(overlaySelect)=\"overlaySelected.emit()\">\n\t\t\t<div\n\t\t\t\tclass=\"bx--modal-container\"\n\t\t\t\t[ngClass]=\"{\n\t\t\t\t\t'bx--modal-container--xs': size === 'xs',\n\t\t\t\t\t'bx--modal-container--sm': size === 'sm',\n\t\t\t\t\t'bx--modal-container--lg': size === 'lg'\n\t\t\t\t}\"\n\t\t\t\trole=\"dialog\"\n\t\t\t\taria-modal=\"true\"\n\t\t\t\tstyle=\"z-index:1;\"\n\t\t\t\t[attr.aria-label]=\"ariaLabel\"\n\t\t\t\t#modal>\n\t\t\t\t<ng-content></ng-content>\n\t\t\t\t<div\n\t\t\t\t\t*ngIf=\"hasScrollingContent !== null ? hasScrollingContent : shouldShowScrollbar\"\n\t\t\t\t\tclass=\"bx--modal-content--overflow-indicator\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ibm-overlay>\n\t"
                }] }
    ];
    /** @nocollapse */
    Modal.ctorParameters = function () { return [
        { type: ModalService }
    ]; };
    Modal.propDecorators = {
        size: [{ type: Input }],
        theme: [{ type: Input }],
        modalLabel: [{ type: Input }],
        ariaLabel: [{ type: Input }],
        open: [{ type: Input }],
        trigger: [{ type: Input }],
        hasScrollingContent: [{ type: Input }],
        overlaySelected: [{ type: Output }],
        close: [{ type: Output }],
        modal: [{ type: ViewChild, args: ["modal", { static: true },] }],
        handleKeyboardEvent: [{ type: HostListener, args: ["keydown", ["$event"],] }]
    };
    return Modal;
}());
export { Modal };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vY2FyYm9uLWNvbXBvbmVudHMtYW5ndWxhci9tb2RhbC8iLCJzb3VyY2VzIjpbIm1vZGFsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUVOLFNBQVMsRUFDVCxZQUFZLEVBQ1osWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBQ04sVUFBVSxFQUNWLFNBQVMsRUFHVCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFbEY7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBMkRHO0FBQ0g7SUEwRkM7O09BRUc7SUFDSCxlQUFtQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQTVEN0M7O1dBRUc7UUFDTSxVQUFLLEdBQXlCLFNBQVMsQ0FBQztRQWV4QyxjQUFTLEdBQUcsU0FBUyxDQUFDO1FBRS9COztXQUVHO1FBQ00sU0FBSSxHQUFHLEtBQUssQ0FBQztRQU90Qjs7Ozs7V0FLRztRQUNNLHdCQUFtQixHQUFZLElBQUksQ0FBQztRQUU3Qzs7V0FFRztRQUNPLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUMvQzs7V0FFRztRQUNPLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBT3JDOztXQUVHO1FBQ0gseUJBQW9CLEdBQUcsdUJBQXVCLENBQUM7SUFLQyxDQUFDO0lBbERqRCxzQkFBYSw2QkFBVTthQUl2QjtZQUNDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUN2QixDQUFDO1FBWEQ7Ozs7V0FJRzthQUNILFVBQXdCLEtBQWE7WUFDcEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7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S0FBSzt3QkFJTCxLQUFLOzZCQU9MLEtBQUs7NEJBUUwsS0FBSzt1QkFLTCxLQUFLOzBCQUtMLEtBQUs7c0NBUUwsS0FBSztrQ0FLTCxNQUFNO3dCQUlOLE1BQU07d0JBS04sU0FBUyxTQUFDLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7c0NBa0NuQyxZQUFZLFNBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDOztJQTZDcEMsWUFBQztDQUFBLEFBbEtELElBa0tDO1NBdElZLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNb2RhbFNlcnZpY2UgfSBmcm9tIFwiLi9tb2RhbC5zZXJ2aWNlXCI7XG5pbXBvcnQge1xuXHRBZnRlclZpZXdJbml0LFxuXHRDb21wb25lbnQsXG5cdEV2ZW50RW1pdHRlcixcblx0SG9zdExpc3RlbmVyLFxuXHRJbnB1dCxcblx0T3V0cHV0LFxuXHRFbGVtZW50UmVmLFxuXHRWaWV3Q2hpbGQsXG5cdFNpbXBsZUNoYW5nZXMsXG5cdE9uQ2hhbmdlc1xufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgY3ljbGVUYWJzLCBnZXRGb2N1c0VsZW1lbnRMaXN0IH0gZnJvbSBcImNhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvY29tbW9uXCI7XG5cbi8qKlxuICogQ29tcG9uZW50IHRvIGNyZWF0ZSBtb2RhbHMgZm9yIHByZXNlbnRpbmcgY29udGVudC5cbiAqXG4gKiBbU2VlIGRlbW9dKC4uLy4uLz9wYXRoPS9zdG9yeS9tb2RhbC0tYmFzaWMpXG4gKlxuICogVXNpbmcgYSBtb2RhbCBpbiB5b3VyIGFwcGxpY2F0aW9uIHJlcXVpcmVzIGBpYm0tcGxhY2Vob2xkZXJgIHdoaWNoIHdvdWxkIGdlbmVyYWxseSBiZVxuICogcGxhY2VkIG5lYXIgdGhlIGVuZCBvZiB5b3VyIGFwcCBjb21wb25lbnQgdGVtcGxhdGUgKGFwcC5jb21wb25lbnQudHMgb3IgYXBwLmNvbXBvbmVudC5odG1sKSBhczpcbiAqXG5gYGBodG1sXG48aWJtLXBsYWNlaG9sZGVyPjwvaWJtLXBsYWNlaG9sZGVyPlxuYGBgXG4gKlxuICogQSBtb3JlIGNvbXBsZXRlIGV4YW1wbGUgZm9yIGBNb2RhbGAgaXMgZ2l2ZW4gYXMgZm9sbG93czpcbiAqXG4gKiBFeGFtcGxlIG1vZGFsIGRlZmluaXRpb246XG4gKlxuYGBgdHlwZXNjcmlwdFxuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiBcImFwcC1zYW1wbGUtbW9kYWxcIixcblx0dGVtcGxhdGU6IGBcblx0XHRcdFx0PGlibS1tb2RhbCBzaXplPVwieGxcIiAob3ZlcmxheVNlbGVjdGVkKT1cImNsb3NlTW9kYWwoKVwiPlxuXHRcdFx0XHRcdDxpYm0tbW9kYWwtaGVhZGVyIChjbG9zZVNlbGVjdCk9XCJjbG9zZU1vZGFsKClcIj5IZWFkZXIgdGV4dDwvaWJtLW1vZGFsLWhlYWRlcj5cblx0XHRcdFx0XHRcdDxzZWN0aW9uIGNsYXNzPVwibW9kYWwtYm9keVwiPlxuXHRcdFx0XHRcdFx0XHQ8aDE+U2FtcGxlIG1vZGFsIHdvcmtzLjwvaDE+XG5cdFx0XHRcdFx0XHRcdDxidXR0b24gY2xhc3M9XCJidG4tLWljb24tbGlua1wiIG5Qb3BvdmVyPVwiSGVsbG8gdGhlcmVcIiB0aXRsZT1cIlBvcG92ZXIgdGl0bGVcIiBwbGFjZW1lbnQ9XCJyaWdodFwiIGFwcGVuZElubGluZT1cInRydWVcIj5cblx0XHRcdFx0XHRcdFx0XHQ8c3ZnIGlibUljb249XCJpbmZvXCIgc2l6ZT1cInNtXCI+PC9pYm0taWNvbj5cblx0XHRcdFx0XHRcdFx0PC9idXR0b24+XG5cdFx0XHRcdFx0XHRcdHt7bW9kYWxUZXh0fX1cblx0XHRcdFx0XHRcdDwvc2VjdGlvbj5cblx0XHRcdFx0XHQ8aWJtLW1vZGFsLWZvb3Rlcj48YnV0dG9uIGlibUJ1dHRvbj1cInByaW1hcnlcIiAoY2xpY2spPVwiY2xvc2VNb2RhbCgpXCI+Q2xvc2U8L2J1dHRvbj48L2libS1tb2RhbC1mb290ZXI+XG5cdFx0XHRcdDwvaWJtLW1vZGFsPmAsXG5cdHN0eWxlVXJsczogW1wiLi9zYW1wbGUtbW9kYWwuY29tcG9uZW50LnNjc3NcIl1cbn0pXG5leHBvcnQgY2xhc3MgU2FtcGxlTW9kYWwgZXh0ZW5kcyBCYXNlTW9kYWwge1xuXHRtb2RhbFRleHQ6IHN0cmluZztcblx0Y29uc3RydWN0b3IocHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3Rvcikge1xuXHRcdHN1cGVyKCk7XG5cdFx0dGhpcy5tb2RhbFRleHQgPSB0aGlzLmluamVjdG9yLmdldChcIm1vZGFsVGV4dFwiKTtcblx0fVxufVxuYGBgXG4gKlxuICogRXhhbXBsZSBvZiBvcGVuaW5nIHRoZSBtb2RhbDpcbiAqXG5gYGB0eXBlc2NyaXB0XG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6IFwiYXBwLW1vZGFsLWRlbW9cIixcblx0dGVtcGxhdGU6IGBcblx0XHRcdFx0PGJ1dHRvbiBpYm1CdXR0b249XCJwcmltYXJ5XCIgKGNsaWNrKT1cIm9wZW5Nb2RhbCgnZHJpbGwnKVwiPkRyaWxsLWRvd24gbW9kYWw8L2J1dHRvbj5cblx0XHRcdFx0PGlibS1wbGFjZWhvbGRlcj48L2libS1wbGFjZWhvbGRlcj5gXG59KVxuZXhwb3J0IGNsYXNzIE1vZGFsRGVtbyB7XG5cdG9wZW5Nb2RhbCgpIHtcblx0XHR0aGlzLm1vZGFsU2VydmljZS5jcmVhdGUoe2NvbXBvbmVudDogU2FtcGxlTW9kYWwsIGlucHV0czoge21vZGFsVGV4dDogXCJIZWxsbyB1bml2ZXJzZS5cIn19KTtcblx0fVxufVxuYGBgXG4gKlxuICogPGV4YW1wbGUtdXJsPi4uLy4uL2lmcmFtZS5odG1sP2lkPW1vZGFsLS1iYXNpYzwvZXhhbXBsZS11cmw+XG4gKi9cbkBDb21wb25lbnQoe1xuXHRzZWxlY3RvcjogXCJpYm0tbW9kYWxcIixcblx0dGVtcGxhdGU6IGBcblx0XHQ8aWJtLW92ZXJsYXlcblx0XHRcdFt0aGVtZV09XCJ0aGVtZVwiXG5cdFx0XHRbb3Blbl09XCJvcGVuXCJcblx0XHRcdChvdmVybGF5U2VsZWN0KT1cIm92ZXJsYXlTZWxlY3RlZC5lbWl0KClcIj5cblx0XHRcdDxkaXZcblx0XHRcdFx0Y2xhc3M9XCJieC0tbW9kYWwtY29udGFpbmVyXCJcblx0XHRcdFx0W25nQ2xhc3NdPVwie1xuXHRcdFx0XHRcdCdieC0tbW9kYWwtY29udGFpbmVyLS14cyc6IHNpemUgPT09ICd4cycsXG5cdFx0XHRcdFx0J2J4LS1tb2RhbC1jb250YWluZXItLXNtJzogc2l6ZSA9PT0gJ3NtJyxcblx0XHRcdFx0XHQnYngtLW1vZGFsLWNvbnRhaW5lci0tbGcnOiBzaXplID09PSAnbGcnXG5cdFx0XHRcdH1cIlxuXHRcdFx0XHRyb2xlPVwiZGlhbG9nXCJcblx0XHRcdFx0YXJpYS1tb2RhbD1cInRydWVcIlxuXHRcdFx0XHRzdHlsZT1cInotaW5kZXg6MTtcIlxuXHRcdFx0XHRbYXR0ci5hcmlhLWxhYmVsXT1cImFyaWFMYWJlbFwiXG5cdFx0XHRcdCNtb2RhbD5cblx0XHRcdFx0PG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuXHRcdFx0XHQ8ZGl2XG5cdFx0XHRcdFx0Km5nSWY9XCJoYXNTY3JvbGxpbmdDb250ZW50ICE9PSBudWxsID8gaGFzU2Nyb2xsaW5nQ29udGVudCA6IHNob3VsZFNob3dTY3JvbGxiYXJcIlxuXHRcdFx0XHRcdGNsYXNzPVwiYngtLW1vZGFsLWNvbnRlbnQtLW92ZXJmbG93LWluZGljYXRvclwiPlxuXHRcdFx0XHQ8L2Rpdj5cblx0XHRcdDwvZGl2PlxuXHRcdDwvaWJtLW92ZXJsYXk+XG5cdGBcbn0pXG5leHBvcnQgY2xhc3MgTW9kYWwgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xuXHQvKipcblx0ICogU2l6ZSBvZiB0aGUgbW9kYWwgdG8gZGlzcGxheS5cblx0ICovXG5cdEBJbnB1dCgpIHNpemU6IFwieHNcIiB8IFwic21cIiB8IFwibGdcIjtcblx0LyoqXG5cdCAqIENsYXNzaWZpY2F0aW9uIG9mIHRoZSBtb2RhbC5cblx0ICovXG5cdEBJbnB1dCgpIHRoZW1lOiBcImRlZmF1bHRcIiB8IFwiZGFuZ2VyXCIgPSBcImRlZmF1bHRcIjtcblxuXHQvKipcblx0ICogTGFiZWwgZm9yIHRoZSBtb2RhbC5cblx0ICpcblx0ICogQGRlcHJlY2F0ZWQgc2luY2UgdjRcblx0ICovXG5cdEBJbnB1dCgpIHNldCBtb2RhbExhYmVsKHZhbHVlOiBzdHJpbmcpIHtcblx0XHR0aGlzLmFyaWFMYWJlbCA9IHZhbHVlO1xuXHR9XG5cblx0Z2V0IG1vZGFsTGFiZWwoKSB7XG5cdFx0cmV0dXJuIHRoaXMuYXJpYUxhYmVsO1xuXHR9XG5cblx0QElucHV0KCkgYXJpYUxhYmVsID0gXCJkZWZhdWx0XCI7XG5cblx0LyoqXG5cdCAqIENvbnRyb2xzIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBtb2RhbCB3aGVuIHVzZWQgZGlyZWN0bHkgaW4gYSB0ZW1wbGF0ZVxuXHQgKi9cblx0QElucHV0KCkgb3BlbiA9IGZhbHNlO1xuXG5cdC8qKlxuXHQgKiBUaGUgZWxlbWVudCB0aGF0IHRyaWdnZXJzIHRoZSBtb2RhbCwgd2hpY2ggc2hvdWxkIHJlY2VpdmUgZm9jdXMgd2hlbiB0aGUgbW9kYWwgY2xvc2VzXG5cdCAqL1xuXHRASW5wdXQoKSB0cmlnZ2VyOiBIVE1MRWxlbWVudDtcblxuXHQvKipcblx0ICogU3BlY2lmeSB3aGV0aGVyIHRoZSBtb2RhbCBjb250YWlucyBzY3JvbGxpbmcgY29udGVudC4gVGhpcyBwcm9wZXJ0eSBvdmVycmlkZXMgdGhlIGF1dG9tYXRpY1xuXHQgKiBkZXRlY3Rpb24gb2YgdGhlIGV4aXN0ZW5jZSBvZiBzY3JvbGxpbmcgY29udGVudC4gU2V0IHRoaXMgcHJvcGVydHkgdG8gYHRydWVgIHRvIGZvcmNlXG5cdCAqIG92ZXJmbG93IGluZGljYXRvciB0byBzaG93IHVwIG9yIHRvIGBmYWxzZWAgdG8gZm9yY2Ugb3ZlcmZsb3cgaW5kaWNhdG9yIHRvIGRpc2FwcGVhci5cblx0ICogSXQgaXMgc2V0IHRvIGBudWxsYCBieSBkZWZhdWx0IHdoaWNoIGluZGljYXRlcyBub3QgdG8gb3ZlcnJpZGUgYXV0b21hdGljIGRldGVjdGlvbi5cblx0ICovXG5cdEBJbnB1dCgpIGhhc1Njcm9sbGluZ0NvbnRlbnQ6IGJvb2xlYW4gPSBudWxsO1xuXG5cdC8qKlxuXHQgKiBFbWl0cyBldmVudCB3aGVuIGNsaWNrIG9jY3VycyB3aXRoaW4gYG4tb3ZlcmxheWAgZWxlbWVudC4gVGhpcyBpcyB0byB0cmFjayBjbGljayBldmVudHMgb2NjdXJyaW5nIG91dHNpZGUgYm91bmRzIG9mIHRoZSBgTW9kYWxgIG9iamVjdC5cblx0ICovXG5cdEBPdXRwdXQoKSBvdmVybGF5U2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cdC8qKlxuXHQgKiBUbyBlbWl0IHRoZSBjbG9zaW5nIGV2ZW50IG9mIHRoZSBtb2RhbCB3aW5kb3cuXG5cdCAqL1xuXHRAT3V0cHV0KCkgY2xvc2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cdC8qKlxuXHQgKiBNYWludGFpbnMgYSByZWZlcmVuY2UgdG8gdGhlIHZpZXcgRE9NIGVsZW1lbnQgb2YgdGhlIGBNb2RhbGAuXG5cdCAqL1xuXHQvLyBAdHMtaWdub3JlXG5cdEBWaWV3Q2hpbGQoXCJtb2RhbFwiLCB7IHN0YXRpYzogdHJ1ZSB9KSBtb2RhbDogRWxlbWVudFJlZjtcblxuXHQvKipcblx0ICogQW4gZWxlbWVudCBzaG91bGQgaGF2ZSAnbW9kYWwtcHJpbWFyeS1mb2N1cycgYXMgYW4gYXR0cmlidXRlIHRvIHJlY2VpdmUgaW5pdGlhbCBmb2N1cyB3aXRoaW4gdGhlIGBNb2RhbGAgY29tcG9uZW50LlxuXHQgKi9cblx0c2VsZWN0b3JQcmltYXJ5Rm9jdXMgPSBcIlttb2RhbC1wcmltYXJ5LWZvY3VzXVwiO1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBNb2RhbGAuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcihwdWJsaWMgbW9kYWxTZXJ2aWNlOiBNb2RhbFNlcnZpY2UpIHt9XG5cblx0bmdPbkNoYW5nZXMoeyBvcGVuIH06IFNpbXBsZUNoYW5nZXMpIHtcblx0XHRpZiAob3Blbikge1xuXHRcdFx0aWYgKG9wZW4uY3VycmVudFZhbHVlKSB7XG5cdFx0XHRcdC8vIGAxMDBgIGlzIGp1c3QgZW5vdWdoIHRpbWUgdG8gYWxsb3cgdGhlIG1vZGFsXG5cdFx0XHRcdC8vIHRvIGJlY29tZSB2aXNpYmxlLCBzbyB0aGF0IHdlIGNhbiBzZXQgZm9jdXNcblx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB0aGlzLmZvY3VzSW5pdGlhbEVsZW1lbnQoKSwgMTAwKTtcblx0XHRcdH0gZWxzZSBpZiAodGhpcy50cmlnZ2VyKSB7XG5cdFx0XHRcdHRoaXMudHJpZ2dlci5mb2N1cygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBTZXQgZG9jdW1lbnQgZm9jdXMgdG8gYmUgb24gdGhlIG1vZGFsIGNvbXBvbmVudCBhZnRlciBpdCBpcyBpbml0aWFsaXplZC5cblx0ICovXG5cdG5nQWZ0ZXJWaWV3SW5pdCgpIHtcblx0XHR0aGlzLmZvY3VzSW5pdGlhbEVsZW1lbnQoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBIYW5kbGUga2V5Ym9hcmQgZXZlbnRzIHRvIGNsb3NlIG1vZGFsIGFuZCB0YWIgdGhyb3VnaCB0aGUgY29udGVudCB3aXRoaW4gdGhlIG1vZGFsLlxuXHQgKi9cblx0QEhvc3RMaXN0ZW5lcihcImtleWRvd25cIiwgW1wiJGV2ZW50XCJdKVxuXHRoYW5kbGVLZXlib2FyZEV2ZW50KGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG5cdFx0c3dpdGNoIChldmVudC5rZXkpIHtcblx0XHRcdGNhc2UgXCJFc2NhcGVcIjoge1xuXHRcdFx0XHRldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsgIC8vIHByZXZlbnRzIGV2ZW50cyBiZWluZyBmaXJlZCBmb3IgbXVsdGlwbGUgbW9kYWxzIGlmIG1vcmUgdGhhbiAyIG9wZW5cblx0XHRcdFx0dGhpcy5tb2RhbFNlcnZpY2UuZGVzdHJveSgpOyAgLy8gZGVzdHJveSB0b3AgKGxhdGVzdCkgbW9kYWxcblx0XHRcdFx0dGhpcy5jbG9zZS5lbWl0KCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiVGFiXCI6IHtcblx0XHRcdFx0Y3ljbGVUYWJzKGV2ZW50LCB0aGlzLm1vZGFsLm5hdGl2ZUVsZW1lbnQpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogVGhpcyBkZXRlY3RzIHdoZXRoZXIgb3Igbm90IHRoZSBtb2RhbCBjb250YWlucyBzY3JvbGxpbmcgY29udGVudC5cblx0ICpcblx0ICogVG8gZm9yY2UgdHJpZ2dlciBhIGRldGVjdGlvbiAoaWUuIG9uIHdpbmRvdyByZXNpemUpLCBjaGFuZ2Ugb3IgcmVzZXQgdGhlIHZhbHVlIG9mIHRoZSBtb2RhbCBjb250ZW50LlxuXHQgKlxuXHQgKiBVc2UgdGhlIGBoYXNTY3JvbGxpbmdDb250ZW50YCBpbnB1dCB0byBtYW51YWxseSBvdmVycmlkZSB0aGUgb3ZlcmZsb3cgaW5kaWNhdG9yLlxuXHQgKi9cblx0Z2V0IHNob3VsZFNob3dTY3JvbGxiYXIoKSB7XG5cdFx0Y29uc3QgbW9kYWxDb250ZW50ID0gdGhpcy5tb2RhbCA/IHRoaXMubW9kYWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ4LS1tb2RhbC1jb250ZW50XCIpIDogbnVsbDtcblx0XHRpZiAobW9kYWxDb250ZW50KSB7XG5cdFx0XHRjb25zdCBtb2RhbENvbnRlbnRIZWlnaHQgPSBtb2RhbENvbnRlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuXHRcdFx0Y29uc3QgbW9kYWxDb250ZW50U2Nyb2xsSGVpZ2h0ID0gbW9kYWxDb250ZW50LnNjcm9sbEhlaWdodDtcblx0XHRcdHJldHVybiBtb2RhbENvbnRlbnRTY3JvbGxIZWlnaHQgPiBtb2RhbENvbnRlbnRIZWlnaHQ7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblxuXHRwcm90ZWN0ZWQgZm9jdXNJbml0aWFsRWxlbWVudCgpIHtcblx0XHRjb25zdCBwcmltYXJ5Rm9jdXNFbGVtZW50ID0gdGhpcy5tb2RhbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5zZWxlY3RvclByaW1hcnlGb2N1cyk7XG5cdFx0aWYgKHByaW1hcnlGb2N1c0VsZW1lbnQgJiYgcHJpbWFyeUZvY3VzRWxlbWVudC5mb2N1cykge1xuXHRcdFx0c2V0VGltZW91dCgoKSA9PiBwcmltYXJ5Rm9jdXNFbGVtZW50LmZvY3VzKCkpO1xuXHRcdH0gZWxzZSBpZiAoZ2V0Rm9jdXNFbGVtZW50TGlzdCh0aGlzLm1vZGFsLm5hdGl2ZUVsZW1lbnQpLmxlbmd0aCA+IDApIHtcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4gZ2V0Rm9jdXNFbGVtZW50TGlzdCh0aGlzLm1vZGFsLm5hdGl2ZUVsZW1lbnQpWzBdLmZvY3VzKCkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHRoaXMubW9kYWwubmF0aXZlRWxlbWVudC5mb2N1cygpKTtcblx0XHR9XG5cdH1cbn1cbiJdfQ==