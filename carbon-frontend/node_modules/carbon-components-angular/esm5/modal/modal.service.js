/**
 *
 * carbon-angular v0.0.0 | modal.service.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { ComponentFactoryResolver, Injector } from "@angular/core";
import { Injectable } from "@angular/core";
import { AlertModal } from "./alert-modal.component";
import { PlaceholderService } from "carbon-components-angular/placeholder";
import { tap, delay } from "rxjs/operators";
/**
 * Modal service handles instantiating and destroying modal instances.
 * Uses PlaceholderService to track open instances, and for it's placeholder view reference.
 */
var ModalService = /** @class */ (function () {
    /**
     * Creates an instance of `ModalService`.
     */
    function ModalService(resolver, placeholderService) {
        this.resolver = resolver;
        this.placeholderService = placeholderService;
    }
    /**
     * Creates and renders the modal component that is passed in.
     * `inputs` is an optional parameter of `data` that can be passed to the `Modal` component.
     */
    ModalService.prototype.create = function (data) {
        var _this = this;
        var defaults = { inputs: {} };
        data = Object.assign({}, defaults, data);
        var inputProviders = Object.keys(data.inputs).map(function (inputName) { return ({
            provide: inputName,
            useValue: data.inputs[inputName]
        }); });
        var injector = Injector.create(inputProviders);
        var factory = this.resolver.resolveComponentFactory(data.component);
        var focusedElement = document.activeElement;
        var component = this.placeholderService.createComponent(factory, injector);
        setTimeout(function () {
            component.instance.open = true;
        });
        component["previouslyFocusedElement"] = focusedElement; // used to return focus to previously focused element
        component.instance.close.pipe(
        // trigger the close animation
        tap(function () {
            component.instance.open = false;
        }), 
        // delay closing by an arbitrary amount to allow the animation to finish
        delay(150)).subscribe(function () {
            _this.placeholderService.destroyComponent(component);
            // filter out our component
            ModalService.modalList = ModalService.modalList.filter(function (c) { return c !== component; });
        });
        component.onDestroy(function () {
            focusedElement.focus();
        });
        ModalService.modalList.push(component);
        return component;
    };
    /**
     * Creates and renders a new alert modal component.
     * @param data You can pass in:
     * `type` - "default" | "danger" = "default",
     * `label` - a label shown over the title,
     * `title` - modal's title,
     * `content` - modal's content, could include HTML tags.
     * `buttons` is an array of objects
     * `close` custom close function
     * ```
     * {
     * 		text: "Button text",
     * 		type: "primary" | "secondary" | "tertiary" | "ghost" | "danger" | "danger--primary" = "primary",
     * 		click: clickFunction,
     * }
     * ```
     */
    ModalService.prototype.show = function (data) {
        return this.create({
            component: AlertModal,
            inputs: {
                type: data.type,
                label: data.label,
                title: data.title,
                content: data.content,
                hasScrollingContent: data.hasScrollingContent || null,
                size: data.size,
                buttons: data.buttons || [],
                close: data.close || (function () { })
            }
        });
    };
    /**
     * Destroys the modal on the supplied index.
     * When called without parameters it destroys the most recently created/top most modal.
     */
    ModalService.prototype.destroy = function (index) {
        if (index === void 0) { index = -1; }
        // return if nothing to destroy because it's already destroyed
        if (index >= ModalService.modalList.length || ModalService.modalList.length === 0) {
            return;
        }
        // on negative index destroy the last on the list (top modal)
        if (index < 0) {
            index = ModalService.modalList.length - 1;
        }
        this.placeholderService.destroyComponent(ModalService.modalList[index]);
        ModalService.modalList.splice(index, 1);
    };
    // track all our open modals
    ModalService.modalList = [];
    ModalService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ModalService.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: PlaceholderService }
    ]; };
    return ModalService;
}());
export { ModalService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvbW9kYWwvIiwic291cmNlcyI6WyJtb2RhbC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTix3QkFBd0IsRUFFeEIsUUFBUSxFQUNSLE1BQU0sZUFBZSxDQUFDO0FBR3ZCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRXJELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHNUM7OztHQUdHO0FBQ0g7SUFLQzs7T0FFRztJQUNILHNCQUFtQixRQUFrQyxFQUFTLGtCQUFzQztRQUFqRixhQUFRLEdBQVIsUUFBUSxDQUEwQjtRQUFTLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7SUFBRyxDQUFDO0lBRXhHOzs7T0FHRztJQUNILDZCQUFNLEdBQU4sVUFBVSxJQUFvQztRQUE5QyxpQkF3Q0M7UUF2Q0EsSUFBSSxRQUFRLEdBQUcsRUFBQyxNQUFNLEVBQUUsRUFBRSxFQUFDLENBQUM7UUFDNUIsSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUV6QyxJQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQSxTQUFTLElBQUksT0FBQSxDQUFDO1lBQ2pFLE9BQU8sRUFBRSxTQUFTO1lBQ2xCLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztTQUNoQyxDQUFDLEVBSCtELENBRy9ELENBQUMsQ0FBQztRQUNKLElBQU0sUUFBUSxH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QztJQUN6QyxDQUFDO0lBdkdELDRCQUE0QjtJQUNYLHNCQUFTLEdBQTZCLEVBQUUsQ0FBQzs7Z0JBSDFELFVBQVU7Ozs7Z0JBakJWLHdCQUF3QjtnQkFTaEIsa0JBQWtCOztJQWtIM0IsbUJBQUM7Q0FBQSxBQTFHRCxJQTBHQztTQXpHWSxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcblx0Q29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuXHRDb21wb25lbnRSZWYsXG5cdEluamVjdG9yXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBNb2RhbCB9IGZyb20gXCIuL21vZGFsLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgUmVwbGF5U3ViamVjdCB9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IEFsZXJ0TW9kYWwgfSBmcm9tIFwiLi9hbGVydC1tb2RhbC5jb21wb25lbnRcIjtcbmltcG9ydCB7IEFsZXJ0TW9kYWxEYXRhIH0gZnJvbSBcIi4vYWxlcnQtbW9kYWwuaW50ZXJmYWNlXCI7XG5pbXBvcnQgeyBQbGFjZWhvbGRlclNlcnZpY2UgfSBmcm9tIFwiY2FyYm9uLWNvbXBvbmVudHMtYW5ndWxhci9wbGFjZWhvbGRlclwiO1xuaW1wb3J0IHsgdGFwLCBkZWxheSB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xuXG5cbi8qKlxuICogTW9kYWwgc2VydmljZSBoYW5kbGVzIGluc3RhbnRpYXRpbmcgYW5kIGRlc3Ryb3lpbmcgbW9kYWwgaW5zdGFuY2VzLlxuICogVXNlcyBQbGFjZWhvbGRlclNlcnZpY2UgdG8gdHJhY2sgb3BlbiBpbnN0YW5jZXMsIGFuZCBmb3IgaXQncyBwbGFjZWhvbGRlciB2aWV3IHJlZmVyZW5jZS5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE1vZGFsU2VydmljZSB7XG5cdC8vIHRyYWNrIGFsbCBvdXIgb3BlbiBtb2RhbHNcblx0cHJvdGVjdGVkIHN0YXRpYyBtb2RhbExpc3Q6IEFycmF5PENvbXBvbmVudFJlZjxhbnk+PiA9IFtdO1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBNb2RhbFNlcnZpY2VgLlxuXHQgKi9cblx0Y29uc3RydWN0b3IocHVibGljIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIHB1YmxpYyBwbGFjZWhvbGRlclNlcnZpY2U6IFBsYWNlaG9sZGVyU2VydmljZSkge31cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhbmQgcmVuZGVycyB0aGUgbW9kYWwgY29tcG9uZW50IHRoYXQgaXMgcGFzc2VkIGluLlxuXHQgKiBgaW5wdXRzYCBpcyBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgb2YgYGRhdGFgIHRoYXQgY2FuIGJlIHBhc3NlZCB0byB0aGUgYE1vZGFsYCBjb21wb25lbnQuXG5cdCAqL1xuXHRjcmVhdGU8VD4oZGF0YToge2NvbXBvbmVudDogYW55LCBpbnB1dHM/OiBhbnl9KTogQ29tcG9uZW50UmVmPGFueT4ge1xuXHRcdGxldCBkZWZhdWx0cyA9IHtpbnB1dHM6IHt9fTtcblx0XHRkYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdHMsIGRhdGEpO1xuXG5cdFx0Y29uc3QgaW5wdXRQcm92aWRlcnMgPSBPYmplY3Qua2V5cyhkYXRhLmlucHV0cykubWFwKGlucHV0TmFtZSA9PiAoe1xuXHRcdFx0cHJvdmlkZTogaW5wdXROYW1lLFxuXHRcdFx0dXNlVmFsdWU6IGRhdGEuaW5wdXRzW2lucHV0TmFtZV1cblx0XHR9KSk7XG5cdFx0Y29uc3QgaW5qZWN0b3IgPSBJbmplY3Rvci5jcmVhdGUoaW5wdXRQcm92aWRlcnMpO1xuXHRcdGNvbnN0IGZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGRhdGEuY29tcG9uZW50KTtcblx0XHRsZXQgZm9jdXNlZEVsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuXG5cdFx0bGV0IGNvbXBvbmVudCA9IHRoaXMucGxhY2Vob2xkZXJTZXJ2aWNlLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5LCBpbmplY3Rvcik7XG5cblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdGNvbXBvbmVudC5pbnN0YW5jZS5vcGVuID0gdHJ1ZTtcblx0XHR9KTtcblxuXHRcdGNvbXBvbmVudFtcInByZXZpb3VzbHlGb2N1c2VkRWxlbWVudFwiXSA9IGZvY3VzZWRFbGVtZW50OyAgLy8gdXNlZCB0byByZXR1cm4gZm9jdXMgdG8gcHJldmlvdXNseSBmb2N1c2VkIGVsZW1lbnRcblxuXHRcdGNvbXBvbmVudC5pbnN0YW5jZS5jbG9zZS5waXBlKFxuXHRcdFx0Ly8gdHJpZ2dlciB0aGUgY2xvc2UgYW5pbWF0aW9uXG5cdFx0XHR0YXAoKCkgPT4ge1xuXHRcdFx0XHRjb21wb25lbnQuaW5zdGFuY2Uub3BlbiA9IGZhbHNlO1xuXHRcdFx0fSksXG5cdFx0XHQvLyBkZWxheSBjbG9zaW5nIGJ5IGFuIGFyYml0cmFyeSBhbW91bnQgdG8gYWxsb3cgdGhlIGFuaW1hdGlvbiB0byBmaW5pc2hcblx0XHRcdGRlbGF5KDE1MClcblx0XHQpLnN1YnNjcmliZSgoKSA9PiB7XG5cdFx0XHR0aGlzLnBsYWNlaG9sZGVyU2VydmljZS5kZXN0cm95Q29tcG9uZW50KGNvbXBvbmVudCk7XG5cdFx0XHQvLyBmaWx0ZXIgb3V0IG91ciBjb21wb25lbnRcblx0XHRcdE1vZGFsU2VydmljZS5tb2RhbExpc3QgPSBNb2RhbFNlcnZpY2UubW9kYWxMaXN0LmZpbHRlcihjID0+IGMgIT09IGNvbXBvbmVudCk7XG5cdFx0fSk7XG5cblx0XHRjb21wb25lbnQub25EZXN0cm95KCgpID0+IHtcblx0XHRcdGZvY3VzZWRFbGVtZW50LmZvY3VzKCk7XG5cdFx0fSk7XG5cblx0XHRNb2RhbFNlcnZpY2UubW9kYWxMaXN0LnB1c2goY29tcG9uZW50KTtcblxuXHRcdHJldHVybiBjb21wb25lbnQ7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhbmQgcmVuZGVycyBhIG5ldyBhbGVydCBtb2RhbCBjb21wb25lbnQuXG5cdCAqIEBwYXJhbSBkYXRhIFlvdSBjYW4gcGFzcyBpbjpcblx0ICogYHR5cGVgIC0gXCJkZWZhdWx0XCIgfCBcImRhbmdlclwiID0gXCJkZWZhdWx0XCIsXG5cdCAqIGBsYWJlbGAgLSBhIGxhYmVsIHNob3duIG92ZXIgdGhlIHRpdGxlLFxuXHQgKiBgdGl0bGVgIC0gbW9kYWwncyB0aXRsZSxcblx0ICogYGNvbnRlbnRgIC0gbW9kYWwncyBjb250ZW50LCBjb3VsZCBpbmNsdWRlIEhUTUwgdGFncy5cblx0ICogYGJ1dHRvbnNgIGlzIGFuIGFycmF5IG9mIG9iamVjdHNcblx0ICogYGNsb3NlYCBjdXN0b20gY2xvc2UgZnVuY3Rpb25cblx0ICogYGBgXG5cdCAqIHtcblx0ICogXHRcdHRleHQ6IFwiQnV0dG9uIHRleHRcIixcblx0ICogXHRcdHR5cGU6IFwicHJpbWFyeVwiIHwgXCJzZWNvbmRhcnlcIiB8IFwidGVydGlhcnlcIiB8IFwiZ2hvc3RcIiB8IFwiZGFuZ2VyXCIgfCBcImRhbmdlci0tcHJpbWFyeVwiID0gXCJwcmltYXJ5XCIsXG5cdCAqIFx0XHRjbGljazogY2xpY2tGdW5jdGlvbixcblx0ICogfVxuXHQgKiBgYGBcblx0ICovXG5cdHNob3coZGF0YTogQWxlcnRNb2RhbERhdGEpIHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoe1xuXHRcdFx0Y29tcG9uZW50OiBBbGVydE1vZGFsLFxuXHRcdFx0aW5wdXRzOiB7XG5cdFx0XHRcdHR5cGU6IGRhdGEudHlwZSxcblx0XHRcdFx0bGFiZWw6IGRhdGEubGFiZWwsXG5cdFx0XHRcdHRpdGxlOiBkYXRhLnRpdGxlLFxuXHRcdFx0XHRjb250ZW50OiBkYXRhLmNvbnRlbnQsXG5cdFx0XHRcdGhhc1Njcm9sbGluZ0NvbnRlbnQ6IGRhdGEuaGFzU2Nyb2xsaW5nQ29udGVudCB8fCBudWxsLFxuXHRcdFx0XHRzaXplOiBkYXRhLnNpemUsXG5cdFx0XHRcdGJ1dHRvbnM6IGRhdGEuYnV0dG9ucyB8fCBbXSxcblx0XHRcdFx0Y2xvc2U6IGRhdGEuY2xvc2UgfHwgKCgpID0+IHt9KVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIERlc3Ryb3lzIHRoZSBtb2RhbCBvbiB0aGUgc3VwcGxpZWQgaW5kZXguXG5cdCAqIFdoZW4gY2FsbGVkIHdpdGhvdXQgcGFyYW1ldGVycyBpdCBkZXN0cm95cyB0aGUgbW9zdCByZWNlbnRseSBjcmVhdGVkL3RvcCBtb3N0IG1vZGFsLlxuXHQgKi9cblx0ZGVzdHJveShpbmRleCA9IC0xKSB7XG5cdFx0Ly8gcmV0dXJuIGlmIG5vdGhpbmcgdG8gZGVzdHJveSBiZWNhdXNlIGl0J3MgYWxyZWFkeSBkZXN0cm95ZWRcblx0XHRpZiAoaW5kZXggPj0gTW9kYWxTZXJ2aWNlLm1vZGFsTGlzdC5sZW5ndGggfHwgTW9kYWxTZXJ2aWNlLm1vZGFsTGlzdC5sZW5ndGggPT09IDApIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Ly8gb24gbmVnYXRpdmUgaW5kZXggZGVzdHJveSB0aGUgbGFzdCBvbiB0aGUgbGlzdCAodG9wIG1vZGFsKVxuXHRcdGlmIChpbmRleCA8IDApIHtcblx0XHRcdGluZGV4ID0gTW9kYWxTZXJ2aWNlLm1vZGFsTGlzdC5sZW5ndGggLSAxO1xuXHRcdH1cblxuXHRcdHRoaXMucGxhY2Vob2xkZXJTZXJ2aWNlLmRlc3Ryb3lDb21wb25lbnQoTW9kYWxTZXJ2aWNlLm1vZGFsTGlzdFtpbmRleF0pO1xuXHRcdE1vZGFsU2VydmljZS5tb2RhbExpc3Quc3BsaWNlKGluZGV4LCAxKTtcblx0fVxufVxuXG4iXX0=