/**
 *
 * carbon-angular v0.0.0 | dialog.directive.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Directive, Input, Output, EventEmitter, ElementRef, ViewContainerRef, HostBinding } from "@angular/core";
import { DialogService } from "./dialog.service";
import { CloseReasons } from "./dialog-config.interface";
import { EventService } from "carbon-components-angular/utils";
/**
 * A generic directive that can be inherited from to create dialogs (for example, a tooltip or popover)
 *
 * This class contains the relevant initialization code, specific templates, options, and additional inputs
 * should be specified in the derived class.
 *
 * NOTE: All child classes should add `DialogService` as a provider, otherwise they will lose context that
 * the service relies on.
 */
var DialogDirective = /** @class */ (function () {
    /**
     * Creates an instance of DialogDirective.
     * @param elementRef
     * @param viewContainerRef
     * @param dialogService
     * @param eventService
     */
    function DialogDirective(elementRef, viewContainerRef, dialogService, eventService) {
        this.elementRef = elementRef;
        this.viewContainerRef = viewContainerRef;
        this.dialogService = dialogService;
        this.eventService = eventService;
        /**
         * Title for the dialog
         */
        this.title = "";
        /**
         * Defines how the Dialog is triggered.(Hover and click behave the same on mobile - both respond to a single tap).
         * Do not add focusable elements if trigger is `hover` or `mouseenter`.
         */
        this.trigger = "click";
        /**
         * Defines how the Dialog close event is triggered.
         *
         * [See here](https://developer.mozilla.org/en-US/docs/Web/API/Element/mouseleave_event)
         * for more on the difference between `mouseleave` and `mouseout`.
         *
         * Defaults to `click` when `trigger` is set to `click`.
         */
        this.closeTrigger = "mouseleave";
        /**
         * Placement of the dialog, usually relative to the element the directive is on.
         */
        this.placement = "left";
        /**
         * Spacing between the dialog and it's triggering element
         */
        this.gap = 0;
        /**
         * Set to `true` to open the dialog next to the triggering component
         */
        this.appendInline = false;
        /**
         * Optional data for templates
         */
        this.data = {};
        this.isOpen = false;
        /**
         * This prevents the dialog from being toggled
         */
        this.disabled = false;
        /**
         * Emits an event when the dialog is closed
         */
        this.onClose = new EventEmitter();
        /**
         * Emits an event when the dialog is opened
         */
        this.onOpen = new EventEmitter();
        /**
         * Emits an event when the state of `isOpen` changes. Allows `isOpen` to be double bound
         */
        this.isOpenChange = new EventEmitter();
        this.role = "button";
        this.hasPopup = true;
    }
    Object.defineProperty(DialogDirective.prototype, "ariaOwns", {
        get: function () {
            return this.isOpen ? this.dialogConfig.compID : null;
        },
        enumerable: true,
        configurable: true
    });
    DialogDirective.prototype.ngOnChanges = function (changes) {
        // set the config object (this can [and should!] be added to in child classes depending on what they need)
        this.dialogConfig = {
            title: this.title,
            content: this.ibmDialog,
            placement: this.placement,
            parentRef: this.elementRef,
            gap: this.gap,
            trigger: this.trigger,
            closeTrigger: this.closeTrigger,
            shouldClose: this.shouldClose || (function () { return true; }),
            appendInline: this.appendInline,
            wrapperClass: this.wrapperClass,
            data: this.data,
            offset: this.offset,
            disabled: this.disabled
        };
        if (changes.isOpen) {
            if (changes.isOpen.currentValue) {
                this.open();
            }
            else {
                this.close({
                    reason: CloseReasons.programmatic
                });
            }
        }
        // Run any code a child class may need.
        this.onDialogChanges(changes);
        this.updateConfig();
    };
    /**
     * Sets the config object and binds events for hovering or clicking before
     * running code from child class.
     */
    DialogDirective.prototype.ngOnInit = function () {
        var _this = this;
        // fix for safari hijacking clicks
        this.dialogService.singletonClickListen();
        var element = this.elementRef.nativeElement;
        this.eventService.on(element, "keydown", function (event) {
            // "Esc" is an IE specific value
            if (event.target === _this.dialogConfig.parentRef.nativeElement &&
                (event.key === "Tab" || event.key === "Tab" && event.shiftKey) ||
                event.key === "Escape" || event.key === "Esc") {
                _this.close({
                    reason: CloseReasons.interaction,
                    target: event.target
                });
            }
        });
        // bind events for hovering or clicking the host
        if (this.trigger === "hover" || this.trigger === "mouseenter") {
            this.eventService.on(element, "mouseenter", this.open.bind(this));
            this.eventService.on(element, this.closeTrigger, function (event) {
                _this.close({
                    reason: CloseReasons.interaction,
                    target: event.target
                });
            });
            this.eventService.on(element, "focus", this.open.bind(this));
            this.eventService.on(element, "blur", function (event) {
                _this.close({
                    reason: CloseReasons.interaction,
                    target: event.target
                });
            });
        }
        else {
            this.eventService.on(element, "click", function (event) {
                _this.toggle({
                    reason: CloseReasons.interaction,
                    target: event.target
                });
            });
            this.eventService.on(element, "keydown", function (event) {
                // "Spacebar" is an IE specific value
                if (event.key === "Enter" || event.key === " " || event.key === "Spacebar") {
                    setTimeout(function () {
                        _this.open();
                    });
                }
            });
        }
        DialogDirective.dialogCounter++;
        this.dialogConfig.compID = "dialog-" + DialogDirective.dialogCounter;
        // run any code a child class may need
        this.onDialogInit();
        this.updateConfig();
    };
    /**
     * When the host dies, kill the popover.
     * - Useful for use in a modal or similar.
     */
    DialogDirective.prototype.ngOnDestroy = function () {
        this.close({
            reason: CloseReasons.destroyed
        });
    };
    /**
     * Helper method to call dialogService 'open'.
     * - Enforce accessibility by updating an aria attr for nativeElement.
     */
    DialogDirective.prototype.open = function () {
        var _this = this;
        // don't allow dialogs to be opened if they're already open
        if (this.dialogRef || this.disabled) {
            return;
        }
        // actually open the dialog, emit events, and set the open state
        this.dialogRef = this.dialogService.open(this.viewContainerRef, this.dialogConfig);
        this.isOpen = true;
        this.onOpen.emit();
        this.isOpenChange.emit(true);
        // Handles emitting all the close events to clean everything up
        // Also enforce accessibility on close by updating an aria attr on the nativeElement.
        this.dialogRef.instance.close.subscribe(function (meta) {
            if (!_this.dialogRef) {
                return;
            }
            if (_this.dialogConfig.shouldClose && _this.dialogConfig.shouldClose(meta)) {
                // close the dialog, emit events, and clear out the open states
                _this.dialogService.close(_this.dialogRef);
                _this.dialogRef = null;
                _this.isOpen = false;
                _this.onClose.emit();
                _this.isOpenChange.emit(false);
            }
        });
        return this.dialogRef;
    };
    /**
     * Helper method to toggle the open state of the dialog
     */
    DialogDirective.prototype.toggle = function (meta) {
        if (meta === void 0) { meta = { reason: CloseReasons.interaction }; }
        if (!this.isOpen) {
            this.open();
        }
        else {
            this.close(meta);
        }
    };
    /**
     * Helper method to close the dialogRef.
     */
    DialogDirective.prototype.close = function (meta) {
        var _this = this;
        if (meta === void 0) { meta = { reason: CloseReasons.interaction }; }
        if (this.dialogRef) {
            setTimeout(function () {
                _this.dialogRef.instance.doClose(meta);
            });
        }
    };
    /**
     * Empty method for child classes to override and specify additional init steps.
     * Run after DialogDirective completes it's ngOnInit.
     */
    DialogDirective.prototype.onDialogInit = function () { };
    /**
     * Empty method for child to override and specify additional on changes steps.
     * run after DialogDirective completes it's ngOnChanges.
     */
    DialogDirective.prototype.onDialogChanges = function (_changes) { };
    DialogDirective.prototype.updateConfig = function () { };
    DialogDirective.dialogCounter = 0;
    DialogDirective.decorators = [
        { type: Directive, args: [{
                    selector: "[ibmDialog]",
                    exportAs: "ibmDialog",
                    providers: [
                        DialogService
                    ]
                },] }
    ];
    /** @nocollapse */
    DialogDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ViewContainerRef },
        { type: DialogService },
        { type: EventService }
    ]; };
    DialogDirective.propDecorators = {
        title: [{ type: Input }],
        ibmDialog: [{ type: Input }],
        trigger: [{ type: Input }],
        closeTrigger: [{ type: Input }],
        placement: [{ type: Input }],
        offset: [{ type: Input }],
        wrapperClass: [{ type: Input }],
        gap: [{ type: Input }],
        appendInline: [{ type: Input }],
        data: [{ type: Input }],
        isOpen: [{ type: Input }, { type: HostBinding, args: ["attr.aria-expanded",] }],
        disabled: [{ type: Input }],
        shouldClose: [{ type: Input }],
        onClose: [{ type: Output }],
        onOpen: [{ type: Output }],
        isOpenChange: [{ type: Output }],
        role: [{ type: HostBinding, args: ["attr.role",] }],
        hasPopup: [{ type: HostBinding, args: ["attr.aria-haspopup",] }],
        ariaOwns: [{ type: HostBinding, args: ["attr.aria-owns",] }]
    };
    return DialogDirective;
}());
export { DialogDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvZGlhbG9nLyIsInNvdXJjZXMiOlsiZGlhbG9nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ04sU0FBUyxFQUNULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUdaLFVBQVUsRUFFVixnQkFBZ0IsRUFFaEIsV0FBVyxFQUdYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQWEsWUFBWSxFQUFnQixNQUFNLDJCQUEyQixDQUFDO0FBQ2xGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUcvRDs7Ozs7Ozs7R0FRRztBQUNIO0lBNkZDOzs7Ozs7T0FNRztJQUNILHlCQUNXLFVBQXNCLEVBQ3RCLGdCQUFrQyxFQUNsQyxhQUE0QixFQUM1QixZQUEwQjtRQUgxQixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsaUJBQVksR0FBWixZQUFZLENBQWM7UUEvRnJDOztXQUVHO1FBQ00sVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUtwQjs7O1dBR0c7UUFDTSxZQUFPLEdBQXFDLE9BQU8sQ0FBQztRQUM3RDs7Ozs7OztXQU9HO1FBQ00saUJBQVksR0FBOEIsWUFBWSxDQUFDO1FBQ2hFOztXQUVHO1FBQ00sY0FBUyxHQUFHLE1BQU0sQ0FBQztRQVM1Qjs7V0FFRztRQUNNLFFBQUcsR0FBRyxDQUFDLENBQUM7UUFDakI7O1dBRUc7UUFDTSxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUM5Qjs7V0FFRztRQUNNLFNBQUksR0FBRyxFQUFFLENBQUM7UUFFeUIsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUMzRDs7V0FFRztR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QztnQkFDVixLQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUM7U0FDSDtJQUNGLENBQUM7SUFFRDs7O09BR0c7SUFDTyxzQ0FBWSxHQUF0QixjQUEwQixDQUFDO0lBRTNCOzs7T0FHRztJQUNPLHlDQUFlLEdBQXpCLFVBQTBCLFFBQXVCLElBQUcsQ0FBQztJQUUzQyxzQ0FBWSxHQUF0QixjQUEwQixDQUFDO0lBOVFwQiw2QkFBYSxHQUFHLENBQUMsQ0FBQzs7Z0JBUnpCLFNBQVMsU0FBQztvQkFDVixRQUFRLEVBQUUsYUFBYTtvQkFDdkIsUUFBUSxFQUFFLFdBQVc7b0JBQ3JCLFNBQVMsRUFBRTt3QkFDVixhQUFhO3FCQUNiO2lCQUNEOzs7O2dCQTVCQSxVQUFVO2dCQUVWLGdCQUFnQjtnQkFNUixhQUFhO2dCQUViLFlBQVk7Ozt3QkF3Qm5CLEtBQUs7NEJBSUwsS0FBSzswQkFLTCxLQUFLOytCQVNMLEtBQUs7NEJBSUwsS0FBSzt5QkFJTCxLQUFLOytCQUlMLEtBQUs7c0JBSUwsS0FBSzsrQkFJTCxLQUFLO3VCQUlMLEtBQUs7eUJBRUwsS0FBSyxZQUFJLFdBQVcsU0FBQyxvQkFBb0I7MkJBSXpDLEtBQUs7OEJBSUwsS0FBSzswQkFRTCxNQUFNO3lCQUlOLE1BQU07K0JBSU4sTUFBTTt1QkFFTixXQUFXLFNBQUMsV0FBVzsyQkFDdkIsV0FBVyxTQUFDLG9CQUFvQjsyQkFDaEMsV0FBVyxTQUFDLGdCQUFnQjs7SUFtTTlCLHNCQUFDO0NBQUEsQUF2UkQsSUF1UkM7U0FoUlksZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG5cdERpcmVjdGl2ZSxcblx0SW5wdXQsXG5cdE91dHB1dCxcblx0RXZlbnRFbWl0dGVyLFxuXHRPbkluaXQsXG5cdE9uRGVzdHJveSxcblx0RWxlbWVudFJlZixcblx0VGVtcGxhdGVSZWYsXG5cdFZpZXdDb250YWluZXJSZWYsXG5cdE9uQ2hhbmdlcyxcblx0SG9zdEJpbmRpbmcsXG5cdFNpbXBsZUNoYW5nZXMsXG5cdENvbXBvbmVudFJlZlxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgRGlhbG9nU2VydmljZSB9IGZyb20gXCIuL2RpYWxvZy5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBDbG9zZU1ldGEsIENsb3NlUmVhc29ucywgRGlhbG9nQ29uZmlnIH0gZnJvbSBcIi4vZGlhbG9nLWNvbmZpZy5pbnRlcmZhY2VcIjtcbmltcG9ydCB7IEV2ZW50U2VydmljZSB9IGZyb20gXCJjYXJib24tY29tcG9uZW50cy1hbmd1bGFyL3V0aWxzXCI7XG5pbXBvcnQgeyBEaWFsb2cgfSBmcm9tIFwiLi9kaWFsb2cuY29tcG9uZW50XCI7XG5cbi8qKlxuICogQSBnZW5lcmljIGRpcmVjdGl2ZSB0aGF0IGNhbiBiZSBpbmhlcml0ZWQgZnJvbSB0byBjcmVhdGUgZGlhbG9ncyAoZm9yIGV4YW1wbGUsIGEgdG9vbHRpcCBvciBwb3BvdmVyKVxuICpcbiAqIFRoaXMgY2xhc3MgY29udGFpbnMgdGhlIHJlbGV2YW50IGluaXRpYWxpemF0aW9uIGNvZGUsIHNwZWNpZmljIHRlbXBsYXRlcywgb3B0aW9ucywgYW5kIGFkZGl0aW9uYWwgaW5wdXRzXG4gKiBzaG91bGQgYmUgc3BlY2lmaWVkIGluIHRoZSBkZXJpdmVkIGNsYXNzLlxuICpcbiAqIE5PVEU6IEFsbCBjaGlsZCBjbGFzc2VzIHNob3VsZCBhZGQgYERpYWxvZ1NlcnZpY2VgIGFzIGEgcHJvdmlkZXIsIG90aGVyd2lzZSB0aGV5IHdpbGwgbG9zZSBjb250ZXh0IHRoYXRcbiAqIHRoZSBzZXJ2aWNlIHJlbGllcyBvbi5cbiAqL1xuQERpcmVjdGl2ZSh7XG5cdHNlbGVjdG9yOiBcIltpYm1EaWFsb2ddXCIsXG5cdGV4cG9ydEFzOiBcImlibURpYWxvZ1wiLFxuXHRwcm92aWRlcnM6IFtcblx0XHREaWFsb2dTZXJ2aWNlXG5cdF1cbn0pXG5leHBvcnQgY2xhc3MgRGlhbG9nRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XG5cdHN0YXRpYyBkaWFsb2dDb3VudGVyID0gMDtcblx0LyoqXG5cdCAqIFRpdGxlIGZvciB0aGUgZGlhbG9nXG5cdCAqL1xuXHRASW5wdXQoKSB0aXRsZSA9IFwiXCI7XG5cdC8qKlxuXHQgKiBEaWFsb2cgYm9keSBjb250ZW50LlxuXHQgKi9cblx0QElucHV0KCkgaWJtRGlhbG9nOiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxhbnk+O1xuXHQvKipcblx0ICogRGVmaW5lcyBob3cgdGhlIERpYWxvZyBpcyB0cmlnZ2VyZWQuKEhvdmVyIGFuZCBjbGljayBiZWhhdmUgdGhlIHNhbWUgb24gbW9iaWxlIC0gYm90aCByZXNwb25kIHRvIGEgc2luZ2xlIHRhcCkuXG5cdCAqIERvIG5vdCBhZGQgZm9jdXNhYmxlIGVsZW1lbnRzIGlmIHRyaWdnZXIgaXMgYGhvdmVyYCBvciBgbW91c2VlbnRlcmAuXG5cdCAqL1xuXHRASW5wdXQoKSB0cmlnZ2VyOiBcImNsaWNrXCIgfCBcImhvdmVyXCIgfCBcIm1vdXNlZW50ZXJcIiA9IFwiY2xpY2tcIjtcblx0LyoqXG5cdCAqIERlZmluZXMgaG93IHRoZSBEaWFsb2cgY2xvc2UgZXZlbnQgaXMgdHJpZ2dlcmVkLlxuXHQgKlxuXHQgKiBbU2VlIGhlcmVdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FbGVtZW50L21vdXNlbGVhdmVfZXZlbnQpXG5cdCAqIGZvciBtb3JlIG9uIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gYG1vdXNlbGVhdmVgIGFuZCBgbW91c2VvdXRgLlxuXHQgKlxuXHQgKiBEZWZhdWx0cyB0byBgY2xpY2tgIHdoZW4gYHRyaWdnZXJgIGlzIHNldCB0byBgY2xpY2tgLlxuXHQgKi9cblx0QElucHV0KCkgY2xvc2VUcmlnZ2VyOiBcIm1vdXNlb3V0XCIgfCBcIm1vdXNlbGVhdmVcIiA9IFwibW91c2VsZWF2ZVwiO1xuXHQvKipcblx0ICogUGxhY2VtZW50IG9mIHRoZSBkaWFsb2csIHVzdWFsbHkgcmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQgdGhlIGRpcmVjdGl2ZSBpcyBvbi5cblx0ICovXG5cdEBJbnB1dCgpIHBsYWNlbWVudCA9IFwibGVmdFwiO1xuXHQvKipcblx0ICogVGhpcyBzcGVjaWZpZXMgYW55IHZlcnRpY2FsIGFuZCBob3Jpem9udGFsIG9mZnNldCBmb3IgdGhlIHBvc2l0aW9uIG9mIHRoZSBkaWFsb2dcblx0ICovXG5cdEBJbnB1dCgpIG9mZnNldDogeyB4OiBudW1iZXIsIHk6IG51bWJlciB9O1xuXHQvKipcblx0ICogQ2xhc3NlcyB0byBhZGQgdG8gdGhlIGRpYWxvZyBjb250YWluZXJcblx0ICovXG5cdEBJbnB1dCgpIHdyYXBwZXJDbGFzczogc3RyaW5nO1xuXHQvKipcblx0ICogU3BhY2luZyBiZXR3ZWVuIHRoZSBkaWFsb2cgYW5kIGl0J3MgdHJpZ2dlcmluZyBlbGVtZW50XG5cdCAqL1xuXHRASW5wdXQoKSBnYXAgPSAwO1xuXHQvKipcblx0ICogU2V0IHRvIGB0cnVlYCB0byBvcGVuIHRoZSBkaWFsb2cgbmV4dCB0byB0aGUgdHJpZ2dlcmluZyBjb21wb25lbnRcblx0ICovXG5cdEBJbnB1dCgpIGFwcGVuZElubGluZSA9IGZhbHNlO1xuXHQvKipcblx0ICogT3B0aW9uYWwgZGF0YSBmb3IgdGVtcGxhdGVzXG5cdCAqL1xuXHRASW5wdXQoKSBkYXRhID0ge307XG5cblx0QElucHV0KCkgQEhvc3RCaW5kaW5nKFwiYXR0ci5hcmlhLWV4cGFuZGVkXCIpIGlzT3BlbiA9IGZhbHNlO1xuXHQvKipcblx0ICogVGhpcyBwcmV2ZW50cyB0aGUgZGlhbG9nIGZyb20gYmVpbmcgdG9nZ2xlZFxuXHQgKi9cblx0QElucHV0KCkgZGlzYWJsZWQgPSBmYWxzZTtcblx0LyoqXG5cdCAqIFRoaXMgaW5wdXQgYWxsb3dzIGV4cGxpY2l0IGNvbnRyb2wgb3ZlciBob3cgdGhlIGRpYWxvZyBzaG91bGQgY2xvc2Vcblx0ICovXG5cdEBJbnB1dCgpIHNob3VsZENsb3NlOiAobWV0YTogQ2xvc2VNZXRhKSA9PiBib29sZWFuO1xuXHQvKipcblx0ICogQ29uZmlnIG9iamVjdCBwYXNzZWQgdG8gdGhlIHJlbmRlcmVkIGNvbXBvbmVudFxuXHQgKi9cblx0ZGlhbG9nQ29uZmlnOiBEaWFsb2dDb25maWc7XG5cdC8qKlxuXHQgKiBFbWl0cyBhbiBldmVudCB3aGVuIHRoZSBkaWFsb2cgaXMgY2xvc2VkXG5cdCAqL1xuXHRAT3V0cHV0KCkgb25DbG9zZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cdC8qKlxuXHQgKiBFbWl0cyBhbiBldmVudCB3aGVuIHRoZSBkaWFsb2cgaXMgb3BlbmVkXG5cdCAqL1xuXHRAT3V0cHV0KCkgb25PcGVuOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblx0LyoqXG5cdCAqIEVtaXRzIGFuIGV2ZW50IHdoZW4gdGhlIHN0YXRlIG9mIGBpc09wZW5gIGNoYW5nZXMuIEFsbG93cyBgaXNPcGVuYCB0byBiZSBkb3VibGUgYm91bmRcblx0ICovXG5cdEBPdXRwdXQoKSBpc09wZW5DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cblx0QEhvc3RCaW5kaW5nKFwiYXR0ci5yb2xlXCIpIHJvbGUgPSBcImJ1dHRvblwiO1xuXHRASG9zdEJpbmRpbmcoXCJhdHRyLmFyaWEtaGFzcG9wdXBcIikgaGFzUG9wdXAgPSB0cnVlO1xuXHRASG9zdEJpbmRpbmcoXCJhdHRyLmFyaWEtb3duc1wiKSBnZXQgYXJpYU93bnMoKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gdGhpcy5pc09wZW4gPyB0aGlzLmRpYWxvZ0NvbmZpZy5jb21wSUQgOiBudWxsO1xuXHR9XG5cblx0LyoqXG5cdCAqIEtlZXBzIGEgcmVmZXJlbmNlIHRvIHRoZSBjdXJyZW50bHkgb3BlbmVkIGRpYWxvZ1xuXHQgKi9cblx0cHJvdGVjdGVkIGRpYWxvZ1JlZjogQ29tcG9uZW50UmVmPERpYWxvZz47XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgRGlhbG9nRGlyZWN0aXZlLlxuXHQgKiBAcGFyYW0gZWxlbWVudFJlZlxuXHQgKiBAcGFyYW0gdmlld0NvbnRhaW5lclJlZlxuXHQgKiBAcGFyYW0gZGlhbG9nU2VydmljZVxuXHQgKiBAcGFyYW0gZXZlbnRTZXJ2aWNlXG5cdCAqL1xuXHRjb25zdHJ1Y3Rvcihcblx0XHRwcm90ZWN0ZWQgZWxlbWVudFJlZjogRWxlbWVudFJlZixcblx0XHRwcm90ZWN0ZWQgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZixcblx0XHRwcm90ZWN0ZWQgZGlhbG9nU2VydmljZTogRGlhbG9nU2VydmljZSxcblx0XHRwcm90ZWN0ZWQgZXZlbnRTZXJ2aWNlOiBFdmVudFNlcnZpY2Vcblx0KSB7fVxuXG5cdG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcblx0XHQvLyBzZXQgdGhlIGNvbmZpZyBvYmplY3QgKHRoaXMgY2FuIFthbmQgc2hvdWxkIV0gYmUgYWRkZWQgdG8gaW4gY2hpbGQgY2xhc3NlcyBkZXBlbmRpbmcgb24gd2hhdCB0aGV5IG5lZWQpXG5cdFx0dGhpcy5kaWFsb2dDb25maWcgPSB7XG5cdFx0XHR0aXRsZTogdGhpcy50aXRsZSxcblx0XHRcdGNvbnRlbnQ6IHRoaXMuaWJtRGlhbG9nLFxuXHRcdFx0cGxhY2VtZW50OiB0aGlzLnBsYWNlbWVudCxcblx0XHRcdHBhcmVudFJlZjogdGhpcy5lbGVtZW50UmVmLFxuXHRcdFx0Z2FwOiB0aGlzLmdhcCxcblx0XHRcdHRyaWdnZXI6IHRoaXMudHJpZ2dlcixcblx0XHRcdGNsb3NlVHJpZ2dlcjogdGhpcy5jbG9zZVRyaWdnZXIsXG5cdFx0XHRzaG91bGRDbG9zZTogdGhpcy5zaG91bGRDbG9zZSB8fCAoKCkgPT4gdHJ1ZSksXG5cdFx0XHRhcHBlbmRJbmxpbmU6IHRoaXMuYXBwZW5kSW5saW5lLFxuXHRcdFx0d3JhcHBlckNsYXNzOiB0aGlzLndyYXBwZXJDbGFzcyxcblx0XHRcdGRhdGE6IHRoaXMuZGF0YSxcblx0XHRcdG9mZnNldDogdGhpcy5vZmZzZXQsXG5cdFx0XHRkaXNhYmxlZDogdGhpcy5kaXNhYmxlZFxuXHRcdH07XG5cblx0XHRpZiAoY2hhbmdlcy5pc09wZW4pIHtcblx0XHRcdGlmIChjaGFuZ2VzLmlzT3Blbi5jdXJyZW50VmFsdWUpIHtcblx0XHRcdFx0dGhpcy5vcGVuKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmNsb3NlKHtcblx0XHRcdFx0XHRyZWFzb246IENsb3NlUmVhc29ucy5wcm9ncmFtbWF0aWNcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gUnVuIGFueSBjb2RlIGEgY2hpbGQgY2xhc3MgbWF5IG5lZWQuXG5cdFx0dGhpcy5vbkRpYWxvZ0NoYW5nZXMoY2hhbmdlcyk7XG5cdFx0dGhpcy51cGRhdGVDb25maWcoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTZXRzIHRoZSBjb25maWcgb2JqZWN0IGFuZCBiaW5kcyBldmVudHMgZm9yIGhvdmVyaW5nIG9yIGNsaWNraW5nIGJlZm9yZVxuXHQgKiBydW5uaW5nIGNvZGUgZnJvbSBjaGlsZCBjbGFzcy5cblx0ICovXG5cdG5nT25Jbml0KCkge1xuXHRcdC8vIGZpeCBmb3Igc2FmYXJpIGhpamFja2luZyBjbGlja3Ncblx0XHR0aGlzLmRpYWxvZ1NlcnZpY2Uuc2luZ2xldG9uQ2xpY2tMaXN0ZW4oKTtcblxuXHRcdGNvbnN0IGVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcblxuXHRcdHRoaXMuZXZlbnRTZXJ2aWNlLm9uKGVsZW1lbnQsIFwia2V5ZG93blwiLCAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcblx0XHRcdC8vIFwiRXNjXCIgaXMgYW4gSUUgc3BlY2lmaWMgdmFsdWVcblx0XHRcdGlmIChldmVudC50YXJnZXQgPT09IHRoaXMuZGlhbG9nQ29uZmlnLnBhcmVudFJlZi5uYXRpdmVFbGVtZW50ICYmXG5cdFx0XHRcdChldmVudC5rZXkgPT09IFwiVGFiXCIgfHwgZXZlbnQua2V5ID09PSBcIlRhYlwiICYmIGV2ZW50LnNoaWZ0S2V5KSB8fFxuXHRcdFx0XHRldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgfHwgZXZlbnQua2V5ID09PSBcIkVzY1wiKSB7XG5cdFx0XHRcdHRoaXMuY2xvc2Uoe1xuXHRcdFx0XHRcdHJlYXNvbjogQ2xvc2VSZWFzb25zLmludGVyYWN0aW9uLFxuXHRcdFx0XHRcdHRhcmdldDogZXZlbnQudGFyZ2V0XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gYmluZCBldmVudHMgZm9yIGhvdmVyaW5nIG9yIGNsaWNraW5nIHRoZSBob3N0XG5cdFx0aWYgKHRoaXMudHJpZ2dlciA9PT0gXCJob3ZlclwiIHx8IHRoaXMudHJpZ2dlciA9PT0gXCJtb3VzZWVudGVyXCIpIHtcblx0XHRcdHRoaXMuZXZlbnRTZXJ2aWNlLm9uKGVsZW1lbnQsIFwibW91c2VlbnRlclwiLCB0aGlzLm9wZW4uYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLmV2ZW50U2VydmljZS5vbihlbGVtZW50LCB0aGlzLmNsb3NlVHJpZ2dlciwgKGV2ZW50KSA9PiB7XG5cdFx0XHRcdHRoaXMuY2xvc2Uoe1xuXHRcdFx0XHRcdHJlYXNvbjogQ2xvc2VSZWFzb25zLmludGVyYWN0aW9uLFxuXHRcdFx0XHRcdHRhcmdldDogZXZlbnQudGFyZ2V0XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLmV2ZW50U2VydmljZS5vbihlbGVtZW50LCBcImZvY3VzXCIsIHRoaXMub3Blbi5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuZXZlbnRTZXJ2aWNlLm9uKGVsZW1lbnQsIFwiYmx1clwiLCAoZXZlbnQpID0+IHtcblx0XHRcdFx0dGhpcy5jbG9zZSh7XG5cdFx0XHRcdFx0cmVhc29uOiBDbG9zZVJlYXNvbnMuaW50ZXJhY3Rpb24sXG5cdFx0XHRcdFx0dGFyZ2V0OiBldmVudC50YXJnZXRcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5ldmVudFNlcnZpY2Uub24oZWxlbWVudCwgXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcblx0XHRcdFx0dGhpcy50b2dnbGUoe1xuXHRcdFx0XHRcdHJlYXNvbjogQ2xvc2VSZWFzb25zLmludGVyYWN0aW9uLFxuXHRcdFx0XHRcdHRhcmdldDogZXZlbnQudGFyZ2V0XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLmV2ZW50U2VydmljZS5vbihlbGVtZW50LCBcImtleWRvd25cIiwgKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XG5cdFx0XHRcdC8vIFwiU3BhY2ViYXJcIiBpcyBhbiBJRSBzcGVjaWZpYyB2YWx1ZVxuXHRcdFx0XHRpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIgfHwgZXZlbnQua2V5ID09PSBcIiBcIiB8fCBldmVudC5rZXkgPT09IFwiU3BhY2ViYXJcIikge1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5vcGVuKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdERpYWxvZ0RpcmVjdGl2ZS5kaWFsb2dDb3VudGVyKys7XG5cdFx0dGhpcy5kaWFsb2dDb25maWcuY29tcElEID0gXCJkaWFsb2ctXCIgKyBEaWFsb2dEaXJlY3RpdmUuZGlhbG9nQ291bnRlcjtcblxuXHRcdC8vIHJ1biBhbnkgY29kZSBhIGNoaWxkIGNsYXNzIG1heSBuZWVkXG5cdFx0dGhpcy5vbkRpYWxvZ0luaXQoKTtcblx0XHR0aGlzLnVwZGF0ZUNvbmZpZygpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFdoZW4gdGhlIGhvc3QgZGllcywga2lsbCB0aGUgcG9wb3Zlci5cblx0ICogLSBVc2VmdWwgZm9yIHVzZSBpbiBhIG1vZGFsIG9yIHNpbWlsYXIuXG5cdCAqL1xuXHRuZ09uRGVzdHJveSgpIHtcblx0XHR0aGlzLmNsb3NlKHtcblx0XHRcdHJlYXNvbjogQ2xvc2VSZWFzb25zLmRlc3Ryb3llZFxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIEhlbHBlciBtZXRob2QgdG8gY2FsbCBkaWFsb2dTZXJ2aWNlICdvcGVuJy5cblx0ICogLSBFbmZvcmNlIGFjY2Vzc2liaWxpdHkgYnkgdXBkYXRpbmcgYW4gYXJpYSBhdHRyIGZvciBuYXRpdmVFbGVtZW50LlxuXHQgKi9cblx0b3BlbigpIHtcblx0XHQvLyBkb24ndCBhbGxvdyBkaWFsb2dzIHRvIGJlIG9wZW5lZCBpZiB0aGV5J3JlIGFscmVhZHkgb3BlblxuXHRcdGlmICh0aGlzLmRpYWxvZ1JlZiB8fCB0aGlzLmRpc2FibGVkKSB7IHJldHVybjsgfVxuXG5cdFx0Ly8gYWN0dWFsbHkgb3BlbiB0aGUgZGlhbG9nLCBlbWl0IGV2ZW50cywgYW5kIHNldCB0aGUgb3BlbiBzdGF0ZVxuXHRcdHRoaXMuZGlhbG9nUmVmID0gdGhpcy5kaWFsb2dTZXJ2aWNlLm9wZW4odGhpcy52aWV3Q29udGFpbmVyUmVmLCB0aGlzLmRpYWxvZ0NvbmZpZyk7XG5cdFx0dGhpcy5pc09wZW4gPSB0cnVlO1xuXHRcdHRoaXMub25PcGVuLmVtaXQoKTtcblx0XHR0aGlzLmlzT3BlbkNoYW5nZS5lbWl0KHRydWUpO1xuXG5cdFx0Ly8gSGFuZGxlcyBlbWl0dGluZyBhbGwgdGhlIGNsb3NlIGV2ZW50cyB0byBjbGVhbiBldmVyeXRoaW5nIHVwXG5cdFx0Ly8gQWxzbyBlbmZvcmNlIGFjY2Vzc2liaWxpdHkgb24gY2xvc2UgYnkgdXBkYXRpbmcgYW4gYXJpYSBhdHRyIG9uIHRoZSBuYXRpdmVFbGVtZW50LlxuXHRcdHRoaXMuZGlhbG9nUmVmLmluc3RhbmNlLmNsb3NlLnN1YnNjcmliZSgobWV0YTogQ2xvc2VNZXRhKSA9PiB7XG5cdFx0XHRpZiAoIXRoaXMuZGlhbG9nUmVmKSB7IHJldHVybjsgfVxuXHRcdFx0aWYgKHRoaXMuZGlhbG9nQ29uZmlnLnNob3VsZENsb3NlICYmIHRoaXMuZGlhbG9nQ29uZmlnLnNob3VsZENsb3NlKG1ldGEpKSB7XG5cdFx0XHRcdC8vIGNsb3NlIHRoZSBkaWFsb2csIGVtaXQgZXZlbnRzLCBhbmQgY2xlYXIgb3V0IHRoZSBvcGVuIHN0YXRlc1xuXHRcdFx0XHR0aGlzLmRpYWxvZ1NlcnZpY2UuY2xvc2UodGhpcy5kaWFsb2dSZWYpO1xuXHRcdFx0XHR0aGlzLmRpYWxvZ1JlZiA9IG51bGw7XG5cdFx0XHRcdHRoaXMuaXNPcGVuID0gZmFsc2U7XG5cdFx0XHRcdHRoaXMub25DbG9zZS5lbWl0KCk7XG5cdFx0XHRcdHRoaXMuaXNPcGVuQ2hhbmdlLmVtaXQoZmFsc2UpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHRoaXMuZGlhbG9nUmVmO1xuXHR9XG5cblx0LyoqXG5cdCAqIEhlbHBlciBtZXRob2QgdG8gdG9nZ2xlIHRoZSBvcGVuIHN0YXRlIG9mIHRoZSBkaWFsb2dcblx0ICovXG5cdHRvZ2dsZShtZXRhOiBDbG9zZU1ldGEgPSB7IHJlYXNvbjogQ2xvc2VSZWFzb25zLmludGVyYWN0aW9uIH0pIHtcblx0XHRpZiAoIXRoaXMuaXNPcGVuKSB7XG5cdFx0XHR0aGlzLm9wZW4oKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5jbG9zZShtZXRhKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogSGVscGVyIG1ldGhvZCB0byBjbG9zZSB0aGUgZGlhbG9nUmVmLlxuXHQgKi9cblx0Y2xvc2UobWV0YTogQ2xvc2VNZXRhID0geyByZWFzb246IENsb3NlUmVhc29ucy5pbnRlcmFjdGlvbiB9KSB7XG5cdFx0aWYgKHRoaXMuZGlhbG9nUmVmKSB7XG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0dGhpcy5kaWFsb2dSZWYuaW5zdGFuY2UuZG9DbG9zZShtZXRhKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBFbXB0eSBtZXRob2QgZm9yIGNoaWxkIGNsYXNzZXMgdG8gb3ZlcnJpZGUgYW5kIHNwZWNpZnkgYWRkaXRpb25hbCBpbml0IHN0ZXBzLlxuXHQgKiBSdW4gYWZ0ZXIgRGlhbG9nRGlyZWN0aXZlIGNvbXBsZXRlcyBpdCdzIG5nT25Jbml0LlxuXHQgKi9cblx0cHJvdGVjdGVkIG9uRGlhbG9nSW5pdCgpIHt9XG5cblx0LyoqXG5cdCAqIEVtcHR5IG1ldGhvZCBmb3IgY2hpbGQgdG8gb3ZlcnJpZGUgYW5kIHNwZWNpZnkgYWRkaXRpb25hbCBvbiBjaGFuZ2VzIHN0ZXBzLlxuXHQgKiBydW4gYWZ0ZXIgRGlhbG9nRGlyZWN0aXZlIGNvbXBsZXRlcyBpdCdzIG5nT25DaGFuZ2VzLlxuXHQgKi9cblx0cHJvdGVjdGVkIG9uRGlhbG9nQ2hhbmdlcyhfY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge31cblxuXHRwcm90ZWN0ZWQgdXBkYXRlQ29uZmlnKCkge31cbn1cbiJdfQ==