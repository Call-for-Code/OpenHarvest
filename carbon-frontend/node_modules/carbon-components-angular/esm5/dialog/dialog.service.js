/**
 *
 * carbon-angular v0.0.0 | dialog.service.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Injector, ComponentFactoryResolver, Injectable } from "@angular/core";
import { CloseReasons } from "./dialog-config.interface";
import { PlaceholderService } from "carbon-components-angular/placeholder";
import { tabbableSelector } from "carbon-components-angular/common";
/**
 * `Dialog` object to be injected into other components.
 */
var DialogService = /** @class */ (function () {
    /**
     * Creates an instance of `DialogService`.
     */
    function DialogService(componentFactoryResolver, injector, placeholderService) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.placeholderService = placeholderService;
    }
    /**
     * Closes all known `Dialog`s. Does not focus any previous elements, since we can't know which would be correct
     */
    DialogService.closeAll = function () {
        DialogService.dialogRefs.forEach(function (ref) { return ref.instance.doClose({
            reason: CloseReasons.programmatic
        }); });
        DialogService.dialogRefs.clear();
    };
    /**
     * Set the context for the service. For example, the `component` property can be used to set the
     * default component that should be created by the service, for a given instance of the service.
     * @param options `{ component: any }` where `component` is a component that extends `dialog.component`
     */
    DialogService.prototype.setContext = function (options) {
        this.componentFactory = this.componentFactoryResolver.resolveComponentFactory(options.component);
    };
    /**
     * If `dialogRef` is defined, the Dialog is already open. If
     * `dialogRef` is undefined, we create the `Dialog` component and reference to it.
     * A subscription is created to track if the `Dialog` should close.
     *
     * @param viewContainer a `ViewContainerRef` to instantiate the component against.
     * May be `null` if an `ibm-placeholder` exists and `dialogConfig.appendInline` is false
     * @param dialogConfig the `DialogConfig` for the component
     */
    DialogService.prototype.open = function (viewContainer, dialogConfig, component) {
        var componentFactory = this.componentFactory;
        if (component) {
            componentFactory = this.componentFactoryResolver.resolveComponentFactory(component);
        }
        var dialogRef;
        if (dialogConfig.appendInline) {
            // add our component to the view
            dialogRef = viewContainer.createComponent(componentFactory, 0, this.injector);
        }
        else if (!this.placeholderService.hasPlaceholderRef()) {
            dialogRef = viewContainer.createComponent(componentFactory, 0, this.injector);
            if (dialogRef) {
                setTimeout(function () {
                    window.document.querySelector("body").appendChild(dialogRef.location.nativeElement);
                });
            }
        }
        else {
            dialogRef = this.placeholderService.createComponent(componentFactory, this.injector);
        }
        // keep track of all initialized dialogs
        DialogService.dialogRefs.add(dialogRef);
        // initialize some extra options
        dialogConfig["previouslyFocusedElement"] = document.activeElement;
        dialogRef.instance.dialogConfig = dialogConfig;
        dialogRef.instance.elementRef.nativeElement.focus();
        return dialogRef;
    };
    /**
     * On close of `Dialog` item, sets focus back to previous item, unsets
     * the current `dialogRef` item. Unsubscribes to the event of `Dialog` close.
     *
     * @param dialogRef the dialogRef to close
     */
    DialogService.prototype.close = function (dialogRef) {
        // to handle the case where we have a null `this.dialogRef`
        if (!dialogRef) {
            return;
        }
        var elementToFocus = dialogRef.instance.dialogConfig["previouslyFocusedElement"];
        dialogRef.destroy();
        // update the globally tracked dialogRefs
        if (DialogService.dialogRefs.has(dialogRef)) {
            DialogService.dialogRefs.delete(dialogRef);
        }
        // Keeps the focus on the dialog trigger if there are no focusable elements. Change focus to previously focused element
        // if there are focusable elements in the dialog.
        if (!dialogRef.location.nativeElement.querySelectorAll(tabbableSelector)) {
            elementToFocus.focus();
        }
    };
    /**
     * Closes all known `Dialog`s. Does not focus any previous elements, since we can't know which would be correct
     *
     * @deprecated since v4. Use the static `DialogService.closeAll` instead
     */
    DialogService.prototype.closeAll = function () {
        DialogService.closeAll();
    };
    /**
     * Fix for safari hijacking clicks.
     *
     * Runs on `ngOnInit` of every dialog. Ensures we don't have multiple listeners
     * because having many of them could degrade performance in certain cases (and is
     * not necessary for our use case)
     *
     * This is an internally used function, can change at any point (even get removed)
     * and changes to it won't be considered a breaking change. Use at your own risk.
     */
    DialogService.prototype.singletonClickListen = function () {
        if (!DialogService.listeningForBodyClicks) {
            document.body.firstElementChild.addEventListener("click", function () { return null; }, true);
            DialogService.listeningForBodyClicks = true;
        }
    };
    /**
     * Used in `singletonClickListen`, don't count on its existence and values.
     */
    DialogService.listeningForBodyClicks = false;
    /**
     * A set of all known dialog components
     */
    DialogService.dialogRefs = new Set();
    DialogService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DialogService.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: PlaceholderService }
    ]; };
    return DialogService;
}());
export { DialogService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9jYXJib24tY29tcG9uZW50cy1hbmd1bGFyL2RpYWxvZy8iLCJzb3VyY2VzIjpbImRpYWxvZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTixRQUFRLEVBR1Isd0JBQXdCLEVBQ3hCLFVBQVUsRUFFVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFnQixNQUFNLDJCQUEyQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBRTNFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBRXBFOztHQUVHO0FBQ0g7SUEyQkM7O09BRUc7SUFDSCx1QkFDVyx3QkFBa0QsRUFDbEQsUUFBa0IsRUFDbEIsa0JBQXNDO1FBRnRDLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO0lBQzlDLENBQUM7SUF0Qko7O09BRUc7SUFDVyxzQkFBUSxHQUF0QjtRQUNDLGFBQWEsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7WUFDNUQsTUFBTSxFQUFFLFlBQVksQ0FBQyxZQUFZO1NBQ2pDLENBQUMsRUFGc0MsQ0FFdEMsQ0FBQyxDQUFDO1FBQ0osYUFBYSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBZ0JEOzs7O09BSUc7SUFDSCxrQ0FBVSxHQUFWLFVBQVcsT0FBMkI7UUFDckMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEcsQ0FBQztJQUVEOzs7Ozs7OztP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LEdBQUcsS0FBSyxDQUFDO0lBRWhEOztPQUVHO0lBQ2Msd0JBQVUsR0FBRyxJQUFJLEdBQUcsRUFBd0IsQ0FBQzs7Z0JBVjlELFVBQVU7Ozs7Z0JBWlYsd0JBQXdCO2dCQUh4QixRQUFRO2dCQVFBLGtCQUFrQjs7SUFnSjNCLG9CQUFDO0NBQUEsQUF6SUQsSUF5SUM7U0F4SVksYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG5cdEluamVjdG9yLFxuXHRDb21wb25lbnRSZWYsXG5cdENvbXBvbmVudEZhY3RvcnksXG5cdENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcblx0SW5qZWN0YWJsZSxcblx0Vmlld0NvbnRhaW5lclJlZlxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgQ2xvc2VSZWFzb25zLCBEaWFsb2dDb25maWcgfSBmcm9tIFwiLi9kaWFsb2ctY29uZmlnLmludGVyZmFjZVwiO1xuaW1wb3J0IHsgUGxhY2Vob2xkZXJTZXJ2aWNlIH0gZnJvbSBcImNhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvcGxhY2Vob2xkZXJcIjtcbmltcG9ydCB7IERpYWxvZyB9IGZyb20gXCIuL2RpYWxvZy5jb21wb25lbnRcIjtcbmltcG9ydCB7IHRhYmJhYmxlU2VsZWN0b3IgfSBmcm9tIFwiY2FyYm9uLWNvbXBvbmVudHMtYW5ndWxhci9jb21tb25cIjtcblxuLyoqXG4gKiBgRGlhbG9nYCBvYmplY3QgdG8gYmUgaW5qZWN0ZWQgaW50byBvdGhlciBjb21wb25lbnRzLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGlhbG9nU2VydmljZSB7XG5cdC8qKlxuXHQgKiBVc2VkIGluIGBzaW5nbGV0b25DbGlja0xpc3RlbmAsIGRvbid0IGNvdW50IG9uIGl0cyBleGlzdGVuY2UgYW5kIHZhbHVlcy5cblx0ICovXG5cdHByb3RlY3RlZCBzdGF0aWMgbGlzdGVuaW5nRm9yQm9keUNsaWNrcyA9IGZhbHNlO1xuXG5cdC8qKlxuXHQgKiBBIHNldCBvZiBhbGwga25vd24gZGlhbG9nIGNvbXBvbmVudHNcblx0ICovXG5cdHByb3RlY3RlZCBzdGF0aWMgZGlhbG9nUmVmcyA9IG5ldyBTZXQ8Q29tcG9uZW50UmVmPERpYWxvZz4+KCk7XG5cblx0LyoqXG5cdCAqIENsb3NlcyBhbGwga25vd24gYERpYWxvZ2BzLiBEb2VzIG5vdCBmb2N1cyBhbnkgcHJldmlvdXMgZWxlbWVudHMsIHNpbmNlIHdlIGNhbid0IGtub3cgd2hpY2ggd291bGQgYmUgY29ycmVjdFxuXHQgKi9cblx0cHVibGljIHN0YXRpYyBjbG9zZUFsbCgpIHtcblx0XHREaWFsb2dTZXJ2aWNlLmRpYWxvZ1JlZnMuZm9yRWFjaChyZWYgPT4gcmVmLmluc3RhbmNlLmRvQ2xvc2Uoe1xuXHRcdFx0cmVhc29uOiBDbG9zZVJlYXNvbnMucHJvZ3JhbW1hdGljXG5cdFx0fSkpO1xuXHRcdERpYWxvZ1NlcnZpY2UuZGlhbG9nUmVmcy5jbGVhcigpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRoZSBkZWZhdWx0IGNvbXBvbmVudCBmYWN0b3J5IHRvIHVzZSB3aGVuIGNyZWF0aW5nIGRpYWxvZ3Ncblx0ICovXG5cdHB1YmxpYyBjb21wb25lbnRGYWN0b3J5OiBDb21wb25lbnRGYWN0b3J5PGFueT47XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYERpYWxvZ1NlcnZpY2VgLlxuXHQgKi9cblx0Y29uc3RydWN0b3IoXG5cdFx0cHJvdGVjdGVkIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuXHRcdHByb3RlY3RlZCBpbmplY3RvcjogSW5qZWN0b3IsXG5cdFx0cHJvdGVjdGVkIHBsYWNlaG9sZGVyU2VydmljZTogUGxhY2Vob2xkZXJTZXJ2aWNlXG5cdCkge31cblxuXHQvKipcblx0ICogU2V0IHRoZSBjb250ZXh0IGZvciB0aGUgc2VydmljZS4gRm9yIGV4YW1wbGUsIHRoZSBgY29tcG9uZW50YCBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byBzZXQgdGhlXG5cdCAqIGRlZmF1bHQgY29tcG9uZW50IHRoYXQgc2hvdWxkIGJlIGNyZWF0ZWQgYnkgdGhlIHNlcnZpY2UsIGZvciBhIGdpdmVuIGluc3RhbmNlIG9mIHRoZSBzZXJ2aWNlLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBgeyBjb21wb25lbnQ6IGFueSB9YCB3aGVyZSBgY29tcG9uZW50YCBpcyBhIGNvbXBvbmVudCB0aGF0IGV4dGVuZHMgYGRpYWxvZy5jb21wb25lbnRgXG5cdCAqL1xuXHRzZXRDb250ZXh0KG9wdGlvbnM6IHsgY29tcG9uZW50OiBhbnkgfSkge1xuXHRcdHRoaXMuY29tcG9uZW50RmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KG9wdGlvbnMuY29tcG9uZW50KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBJZiBgZGlhbG9nUmVmYCBpcyBkZWZpbmVkLCB0aGUgRGlhbG9nIGlzIGFscmVhZHkgb3Blbi4gSWZcblx0ICogYGRpYWxvZ1JlZmAgaXMgdW5kZWZpbmVkLCB3ZSBjcmVhdGUgdGhlIGBEaWFsb2dgIGNvbXBvbmVudCBhbmQgcmVmZXJlbmNlIHRvIGl0LlxuXHQgKiBBIHN1YnNjcmlwdGlvbiBpcyBjcmVhdGVkIHRvIHRyYWNrIGlmIHRoZSBgRGlhbG9nYCBzaG91bGQgY2xvc2UuXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3Q29udGFpbmVyIGEgYFZpZXdDb250YWluZXJSZWZgIHRvIGluc3RhbnRpYXRlIHRoZSBjb21wb25lbnQgYWdhaW5zdC5cblx0ICogTWF5IGJlIGBudWxsYCBpZiBhbiBgaWJtLXBsYWNlaG9sZGVyYCBleGlzdHMgYW5kIGBkaWFsb2dDb25maWcuYXBwZW5kSW5saW5lYCBpcyBmYWxzZVxuXHQgKiBAcGFyYW0gZGlhbG9nQ29uZmlnIHRoZSBgRGlhbG9nQ29uZmlnYCBmb3IgdGhlIGNvbXBvbmVudFxuXHQgKi9cblx0b3Blbih2aWV3Q29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmLCBkaWFsb2dDb25maWc6IERpYWxvZ0NvbmZpZywgY29tcG9uZW50PzogYW55KSB7XG5cdFx0bGV0IGNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3Rvcnk7XG5cdFx0aWYgKGNvbXBvbmVudCkge1xuXHRcdFx0Y29tcG9uZW50RmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbXBvbmVudCk7XG5cdFx0fVxuXG5cdFx0bGV0IGRpYWxvZ1JlZjtcblx0XHRpZiAoZGlhbG9nQ29uZmlnLmFwcGVuZElubGluZSkge1xuXHRcdFx0Ly8gYWRkIG91ciBjb21wb25lbnQgdG8gdGhlIHZpZXdcblx0XHRcdGRpYWxvZ1JlZiA9IHZpZXdDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNvbXBvbmVudEZhY3RvcnksIDAsIHRoaXMuaW5qZWN0b3IpO1xuXHRcdH0gZWxzZSBpZiAoIXRoaXMucGxhY2Vob2xkZXJTZXJ2aWNlLmhhc1BsYWNlaG9sZGVyUmVmKCkpIHtcblx0XHRcdGRpYWxvZ1JlZiA9IHZpZXdDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNvbXBvbmVudEZhY3RvcnksIDAsIHRoaXMuaW5qZWN0b3IpO1xuXHRcdFx0aWYgKGRpYWxvZ1JlZikge1xuXHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHR3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIikuYXBwZW5kQ2hpbGQoZGlhbG9nUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0ZGlhbG9nUmVmID0gdGhpcy5wbGFjZWhvbGRlclNlcnZpY2UuY3JlYXRlQ29tcG9uZW50KGNvbXBvbmVudEZhY3RvcnksIHRoaXMuaW5qZWN0b3IpO1xuXHRcdH1cblxuXHRcdC8vIGtlZXAgdHJhY2sgb2YgYWxsIGluaXRpYWxpemVkIGRpYWxvZ3Ncblx0XHREaWFsb2dTZXJ2aWNlLmRpYWxvZ1JlZnMuYWRkKGRpYWxvZ1JlZik7XG5cblx0XHQvLyBpbml0aWFsaXplIHNvbWUgZXh0cmEgb3B0aW9uc1xuXHRcdGRpYWxvZ0NvbmZpZ1tcInByZXZpb3VzbHlGb2N1c2VkRWxlbWVudFwiXSA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG5cdFx0ZGlhbG9nUmVmLmluc3RhbmNlLmRpYWxvZ0NvbmZpZyA9IGRpYWxvZ0NvbmZpZztcblxuXHRcdGRpYWxvZ1JlZi5pbnN0YW5jZS5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblxuXHRcdHJldHVybiBkaWFsb2dSZWYgYXMgQ29tcG9uZW50UmVmPERpYWxvZz47XG5cdH1cblxuXHQvKipcblx0ICogT24gY2xvc2Ugb2YgYERpYWxvZ2AgaXRlbSwgc2V0cyBmb2N1cyBiYWNrIHRvIHByZXZpb3VzIGl0ZW0sIHVuc2V0c1xuXHQgKiB0aGUgY3VycmVudCBgZGlhbG9nUmVmYCBpdGVtLiBVbnN1YnNjcmliZXMgdG8gdGhlIGV2ZW50IG9mIGBEaWFsb2dgIGNsb3NlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGlhbG9nUmVmIHRoZSBkaWFsb2dSZWYgdG8gY2xvc2Vcblx0ICovXG5cdGNsb3NlKGRpYWxvZ1JlZjogQ29tcG9uZW50UmVmPERpYWxvZz4pIHtcblx0XHQvLyB0byBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgd2UgaGF2ZSBhIG51bGwgYHRoaXMuZGlhbG9nUmVmYFxuXHRcdGlmICghZGlhbG9nUmVmKSB7IHJldHVybjsgfVxuXG5cdFx0Y29uc3QgZWxlbWVudFRvRm9jdXMgPSBkaWFsb2dSZWYuaW5zdGFuY2UuZGlhbG9nQ29uZmlnW1wicHJldmlvdXNseUZvY3VzZWRFbGVtZW50XCJdO1xuXG5cdFx0ZGlhbG9nUmVmLmRlc3Ryb3koKTtcblxuXHRcdC8vIHVwZGF0ZSB0aGUgZ2xvYmFsbHkgdHJhY2tlZCBkaWFsb2dSZWZzXG5cdFx0aWYgKERpYWxvZ1NlcnZpY2UuZGlhbG9nUmVmcy5oYXMoZGlhbG9nUmVmKSkge1xuXHRcdFx0RGlhbG9nU2VydmljZS5kaWFsb2dSZWZzLmRlbGV0ZShkaWFsb2dSZWYpO1xuXHRcdH1cblxuXHRcdC8vIEtlZXBzIHRoZSBmb2N1cyBvbiB0aGUgZGlhbG9nIHRyaWdnZXIgaWYgdGhlcmUgYXJlIG5vIGZvY3VzYWJsZSBlbGVtZW50cy4gQ2hhbmdlIGZvY3VzIHRvIHByZXZpb3VzbHkgZm9jdXNlZCBlbGVtZW50XG5cdFx0Ly8gaWYgdGhlcmUgYXJlIGZvY3VzYWJsZSBlbGVtZW50cyBpbiB0aGUgZGlhbG9nLlxuXHRcdGlmICghZGlhbG9nUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0YWJiYWJsZVNlbGVjdG9yKSkge1xuXHRcdFx0ZWxlbWVudFRvRm9jdXMuZm9jdXMoKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQ2xvc2VzIGFsbCBrbm93biBgRGlhbG9nYHMuIERvZXMgbm90IGZvY3VzIGFueSBwcmV2aW91cyBlbGVtZW50cywgc2luY2Ugd2UgY2FuJ3Qga25vdyB3aGljaCB3b3VsZCBiZSBjb3JyZWN0XG5cdCAqXG5cdCAqIEBkZXByZWNhdGVkIHNpbmNlIHY0LiBVc2UgdGhlIHN0YXRpYyBgRGlhbG9nU2VydmljZS5jbG9zZUFsbGAgaW5zdGVhZFxuXHQgKi9cblx0Y2xvc2VBbGwoKSB7XG5cdFx0RGlhbG9nU2VydmljZS5jbG9zZUFsbCgpO1xuXHR9XG5cdC8qKlxuXHQgKiBGaXggZm9yIHNhZmFyaSBoaWphY2tpbmcgY2xpY2tzLlxuXHQgKlxuXHQgKiBSdW5zIG9uIGBuZ09uSW5pdGAgb2YgZXZlcnkgZGlhbG9nLiBFbnN1cmVzIHdlIGRvbid0IGhhdmUgbXVsdGlwbGUgbGlzdGVuZXJzXG5cdCAqIGJlY2F1c2UgaGF2aW5nIG1hbnkgb2YgdGhlbSBjb3VsZCBkZWdyYWRlIHBlcmZvcm1hbmNlIGluIGNlcnRhaW4gY2FzZXMgKGFuZCBpc1xuXHQgKiBub3QgbmVjZXNzYXJ5IGZvciBvdXIgdXNlIGNhc2UpXG5cdCAqXG5cdCAqIFRoaXMgaXMgYW4gaW50ZXJuYWxseSB1c2VkIGZ1bmN0aW9uLCBjYW4gY2hhbmdlIGF0IGFueSBwb2ludCAoZXZlbiBnZXQgcmVtb3ZlZClcblx0ICogYW5kIGNoYW5nZXMgdG8gaXQgd29uJ3QgYmUgY29uc2lkZXJlZCBhIGJyZWFraW5nIGNoYW5nZS4gVXNlIGF0IHlvdXIgb3duIHJpc2suXG5cdCAqL1xuXHRzaW5nbGV0b25DbGlja0xpc3RlbigpIHtcblx0XHRpZiAoIURpYWxvZ1NlcnZpY2UubGlzdGVuaW5nRm9yQm9keUNsaWNrcykge1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5maXJzdEVsZW1lbnRDaGlsZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gbnVsbCwgdHJ1ZSk7XG5cdFx0XHREaWFsb2dTZXJ2aWNlLmxpc3RlbmluZ0ZvckJvZHlDbGlja3MgPSB0cnVlO1xuXHRcdH1cblx0fVxufVxuIl19